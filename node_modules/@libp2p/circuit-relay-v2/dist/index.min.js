(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.Libp2PCircuitRelayV2 = factory()}(typeof self !== 'undefined' ? self : this, function () {
"use strict";var Libp2PCircuitRelayV2=(()=>{var Mu=Object.create;var wn=Object.defineProperty;var Hu=Object.getOwnPropertyDescriptor;var Fu=Object.getOwnPropertyNames;var Ku=Object.getPrototypeOf,qu=Object.prototype.hasOwnProperty;var xn=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports),gt=(r,t)=>{for(var e in t)wn(r,e,{get:t[e],enumerable:!0})},pa=(r,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of Fu(t))!qu.call(r,s)&&s!==e&&wn(r,s,{get:()=>t[s],enumerable:!(n=Hu(t,s))||n.enumerable});return r};var ma=(r,t,e)=>(e=r!=null?Mu(Ku(r)):{},pa(t||!r||!r.__esModule?wn(e,"default",{value:r,enumerable:!0}):e,r)),$u=r=>pa(wn({},"__esModule",{value:!0}),r);var Ec=xn(Lr=>{"use strict";var vd="[object ArrayBuffer]",we=class r{static isArrayBuffer(t){return Object.prototype.toString.call(t)===vd}static toArrayBuffer(t){return this.isArrayBuffer(t)?t:t.byteLength===t.buffer.byteLength||t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:this.toUint8Array(t.buffer).slice(t.byteOffset,t.byteOffset+t.byteLength).buffer}static toUint8Array(t){return this.toView(t,Uint8Array)}static toView(t,e){if(t.constructor===e)return t;if(this.isArrayBuffer(t))return new e(t);if(this.isArrayBufferView(t))return new e(t.buffer,t.byteOffset,t.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(t){return this.isArrayBufferView(t)||this.isArrayBuffer(t)}static isArrayBufferView(t){return ArrayBuffer.isView(t)||t&&this.isArrayBuffer(t.buffer)}static isEqual(t,e){let n=r.toUint8Array(t),s=r.toUint8Array(e);if(n.length!==s.byteLength)return!1;for(let i=0;i<n.length;i++)if(n[i]!==s[i])return!1;return!0}static concat(...t){let e;Array.isArray(t[0])&&!(t[1]instanceof Function)||Array.isArray(t[0])&&t[1]instanceof Function?e=t[0]:t[t.length-1]instanceof Function?e=t.slice(0,t.length-1):e=t;let n=0;for(let o of e)n+=o.byteLength;let s=new Uint8Array(n),i=0;for(let o of e){let a=this.toUint8Array(o);s.set(a,i),i+=a.length}return t[t.length-1]instanceof Function?this.toView(s,t[t.length-1]):s.buffer}},lo="string",Ed=/^[0-9a-f]+$/i,Ad=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,Bd=/^[a-zA-Z0-9-_]+$/,Fn=class{static fromString(t){let e=unescape(encodeURIComponent(t)),n=new Uint8Array(e.length);for(let s=0;s<e.length;s++)n[s]=e.charCodeAt(s);return n.buffer}static toString(t){let e=we.toUint8Array(t),n="";for(let i=0;i<e.length;i++)n+=String.fromCharCode(e[i]);return decodeURIComponent(escape(n))}},Kt=class{static toString(t,e=!1){let n=we.toArrayBuffer(t),s=new DataView(n),i="";for(let o=0;o<n.byteLength;o+=2){let a=s.getUint16(o,e);i+=String.fromCharCode(a)}return i}static fromString(t,e=!1){let n=new ArrayBuffer(t.length*2),s=new DataView(n);for(let i=0;i<t.length;i++)s.setUint16(i*2,t.charCodeAt(i),e);return n}},Kn=class r{static isHex(t){return typeof t===lo&&Ed.test(t)}static isBase64(t){return typeof t===lo&&Ad.test(t)}static isBase64Url(t){return typeof t===lo&&Bd.test(t)}static ToString(t,e="utf8"){let n=we.toUint8Array(t);switch(e.toLowerCase()){case"utf8":return this.ToUtf8String(n);case"binary":return this.ToBinary(n);case"hex":return this.ToHex(n);case"base64":return this.ToBase64(n);case"base64url":return this.ToBase64Url(n);case"utf16le":return Kt.toString(n,!0);case"utf16":case"utf16be":return Kt.toString(n);default:throw new Error(`Unknown type of encoding '${e}'`)}}static FromString(t,e="utf8"){if(!t)return new ArrayBuffer(0);switch(e.toLowerCase()){case"utf8":return this.FromUtf8String(t);case"binary":return this.FromBinary(t);case"hex":return this.FromHex(t);case"base64":return this.FromBase64(t);case"base64url":return this.FromBase64Url(t);case"utf16le":return Kt.fromString(t,!0);case"utf16":case"utf16be":return Kt.fromString(t);default:throw new Error(`Unknown type of encoding '${e}'`)}}static ToBase64(t){let e=we.toUint8Array(t);if(typeof btoa<"u"){let n=this.ToString(e,"binary");return btoa(n)}else return Buffer.from(e).toString("base64")}static FromBase64(t){let e=this.formatString(t);if(!e)return new ArrayBuffer(0);if(!r.isBase64(e))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return typeof atob<"u"?this.FromBinary(atob(e)):new Uint8Array(Buffer.from(e,"base64")).buffer}static FromBase64Url(t){let e=this.formatString(t);if(!e)return new ArrayBuffer(0);if(!r.isBase64Url(e))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(e.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(t){return this.ToBase64(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(t,e=r.DEFAULT_UTF8_ENCODING){switch(e){case"ascii":return this.FromBinary(t);case"utf8":return Fn.fromString(t);case"utf16":case"utf16be":return Kt.fromString(t);case"utf16le":case"usc2":return Kt.fromString(t,!0);default:throw new Error(`Unknown type of encoding '${e}'`)}}static ToUtf8String(t,e=r.DEFAULT_UTF8_ENCODING){switch(e){case"ascii":return this.ToBinary(t);case"utf8":return Fn.toString(t);case"utf16":case"utf16be":return Kt.toString(t);case"utf16le":case"usc2":return Kt.toString(t,!0);default:throw new Error(`Unknown type of encoding '${e}'`)}}static FromBinary(t){let e=t.length,n=new Uint8Array(e);for(let s=0;s<e;s++)n[s]=t.charCodeAt(s);return n.buffer}static ToBinary(t){let e=we.toUint8Array(t),n="";for(let s=0;s<e.length;s++)n+=String.fromCharCode(e[s]);return n}static ToHex(t){let e=we.toUint8Array(t),n="",s=e.length;for(let i=0;i<s;i++){let o=e[i];o<16&&(n+="0"),n+=o.toString(16)}return n}static FromHex(t){let e=this.formatString(t);if(!e)return new ArrayBuffer(0);if(!r.isHex(e))throw new TypeError("Argument 'hexString' is not HEX encoded");e.length%2&&(e=`0${e}`);let n=new Uint8Array(e.length/2);for(let s=0;s<e.length;s=s+2){let i=e.slice(s,s+2);n[s/2]=parseInt(i,16)}return n.buffer}static ToUtf16String(t,e=!1){return Kt.toString(t,e)}static FromUtf16String(t,e=!1){return Kt.fromString(t,e)}static Base64Padding(t){let e=4-t.length%4;if(e<4)for(let n=0;n<e;n++)t+="=";return t}static formatString(t){return t?.replace(/[\n\r\t ]/g,"")||""}};Kn.DEFAULT_UTF8_ENCODING="utf8";function Sd(r,...t){let e=arguments[0];for(let n=1;n<arguments.length;n++){let s=arguments[n];for(let i in s)e[i]=s[i]}return e}function Td(...r){let t=r.map(s=>s.byteLength).reduce((s,i)=>s+i),e=new Uint8Array(t),n=0;return r.map(s=>new Uint8Array(s)).forEach(s=>{for(let i of s)e[n++]=i}),e.buffer}function Id(r,t){if(!(r&&t)||r.byteLength!==t.byteLength)return!1;let e=new Uint8Array(r),n=new Uint8Array(t);for(let s=0;s<r.byteLength;s++)if(e[s]!==n[s])return!1;return!0}Lr.BufferSourceConverter=we;Lr.Convert=Kn;Lr.assign=Sd;Lr.combine=Td;Lr.isEqual=Id});var fu=xn((mx,uu)=>{function jt(r,t){typeof t=="boolean"&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(r)),this._timeouts=r,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}uu.exports=jt;jt.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};jt.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};jt.prototype.retry=function(r){if(this._timeout&&clearTimeout(this._timeout),!r)return!1;var t=new Date().getTime();if(r&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(r),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(r);var e=this._timeouts.shift();if(e===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),e=this._cachedTimeouts.slice(-1);else return!1;var n=this;return this._timer=setTimeout(function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout(function(){n._operationTimeoutCb(n._attempts)},n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)},e),this._options.unref&&this._timer.unref(),!0};jt.prototype.attempt=function(r,t){this._fn=r,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var e=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){e._operationTimeoutCb()},e._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};jt.prototype.try=function(r){console.log("Using RetryOperation.try() is deprecated"),this.attempt(r)};jt.prototype.start=function(r){console.log("Using RetryOperation.start() is deprecated"),this.attempt(r)};jt.prototype.start=jt.prototype.try;jt.prototype.errors=function(){return this._errors};jt.prototype.attempts=function(){return this._attempts};jt.prototype.mainError=function(){if(this._errors.length===0)return null;for(var r={},t=null,e=0,n=0;n<this._errors.length;n++){var s=this._errors[n],i=s.message,o=(r[i]||0)+1;r[i]=o,o>=e&&(t=s,e=o)}return t}});var hu=xn(ur=>{var Dp=fu();ur.operation=function(r){var t=ur.timeouts(r);return new Dp(t,{forever:r&&(r.forever||r.retries===1/0),unref:r&&r.unref,maxRetryTime:r&&r.maxRetryTime})};ur.timeouts=function(r){if(r instanceof Array)return[].concat(r);var t={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var e in r)t[e]=r[e];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],s=0;s<t.retries;s++)n.push(this.createTimeout(s,t));return r&&r.forever&&!n.length&&n.push(this.createTimeout(s,t)),n.sort(function(i,o){return i-o}),n};ur.createTimeout=function(r,t){var e=t.randomize?Math.random()+1:1,n=Math.round(e*Math.max(t.minTimeout,1)*Math.pow(t.factor,r));return n=Math.min(n,t.maxTimeout),n};ur.wrap=function(r,t,e){if(t instanceof Array&&(e=t,t=null),!e){e=[];for(var n in r)typeof r[n]=="function"&&e.push(n)}for(var s=0;s<e.length;s++){var i=e[s],o=r[i];r[i]=function(c){var f=ur.operation(t),u=Array.prototype.slice.call(arguments,1),l=u.pop();u.push(function(h){f.retry(h)||(h&&(arguments[0]=f.mainError()),l.apply(this,arguments))}),f.attempt(function(){c.apply(r,u)})}.bind(r,o),r[i].options=t}}});var pu=xn((yx,du)=>{du.exports=hu()});var i0={};gt(i0,{RELAY_V2_HOP_CODEC:()=>zt,RELAY_V2_STOP_CODEC:()=>lr,circuitRelayServer:()=>bu,circuitRelayTransport:()=>Nu});var ga=Symbol.for("@libp2p/peer-id");var ba=Symbol.for("@libp2p/transport");var ya;(function(r){r[r.FATAL_ALL=0]="FATAL_ALL",r[r.NO_FATAL=1]="NO_FATAL"})(ya||(ya={}));var Re=class r extends Error{code;type;constructor(t="The operation was aborted"){super(t),this.code=r.code,this.type=r.type}static code="ABORT_ERR";static type="aborted"},L=class extends Error{code;props;constructor(t,e,n){super(t),this.code=e,this.name=n?.name??"CodeError",this.props=n??{}}};var Rt=class extends EventTarget{#t=new Map;listenerCount(t){let e=this.#t.get(t);return e==null?0:e.length}addEventListener(t,e,n){super.addEventListener(t,e,n);let s=this.#t.get(t);s==null&&(s=[],this.#t.set(t,s)),s.push({callback:e,once:(n!==!0&&n!==!1&&n?.once)??!1})}removeEventListener(t,e,n){super.removeEventListener(t.toString(),e??null,n);let s=this.#t.get(t);s!=null&&(s=s.filter(({callback:i})=>i!==e),this.#t.set(t,s))}dispatchEvent(t){let e=super.dispatchEvent(t),n=this.#t.get(t.type);return n==null||(n=n.filter(({once:s})=>!s),this.#t.set(t.type,n)),e}safeDispatchEvent(t,e={}){return this.dispatchEvent(new Gu(t,e))}},ci=class extends Event{detail;constructor(t,e){super(t,e),this.detail=e?.detail}},Gu=globalThis.CustomEvent??ci;var vn=(r,...t)=>{try{[...t]}catch{}};var di={};gt(di,{base58btc:()=>dt,base58flickr:()=>Xu});var h0=new Uint8Array(0);function wa(r,t){if(r===t)return!0;if(r.byteLength!==t.byteLength)return!1;for(let e=0;e<r.byteLength;e++)if(r[e]!==t[e])return!1;return!0}function ue(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function xa(r){return new TextEncoder().encode(r)}function va(r){return new TextDecoder().decode(r)}function zu(r,t){if(r.length>=255)throw new TypeError("Alphabet too long");for(var e=new Uint8Array(256),n=0;n<e.length;n++)e[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(e[o]!==255)throw new TypeError(i+" is ambiguous");e[o]=s}var a=r.length,c=r.charAt(0),f=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function l(m){if(m instanceof Uint8Array||(ArrayBuffer.isView(m)?m=new Uint8Array(m.buffer,m.byteOffset,m.byteLength):Array.isArray(m)&&(m=Uint8Array.from(m))),!(m instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(m.length===0)return"";for(var d=0,p=0,y=0,A=m.length;y!==A&&m[y]===0;)y++,d++;for(var w=(A-y)*u+1>>>0,_=new Uint8Array(w);y!==A;){for(var x=m[y],S=0,R=w-1;(x!==0||S<p)&&R!==-1;R--,S++)x+=256*_[R]>>>0,_[R]=x%a>>>0,x=x/a>>>0;if(x!==0)throw new Error("Non-zero carry");p=S,y++}for(var N=w-p;N!==w&&_[N]===0;)N++;for(var z=c.repeat(d);N<w;++N)z+=r.charAt(_[N]);return z}function h(m){if(typeof m!="string")throw new TypeError("Expected String");if(m.length===0)return new Uint8Array;var d=0;if(m[d]!==" "){for(var p=0,y=0;m[d]===c;)p++,d++;for(var A=(m.length-d)*f+1>>>0,w=new Uint8Array(A);m[d];){var _=e[m.charCodeAt(d)];if(_===255)return;for(var x=0,S=A-1;(_!==0||x<y)&&S!==-1;S--,x++)_+=a*w[S]>>>0,w[S]=_%256>>>0,_=_/256>>>0;if(_!==0)throw new Error("Non-zero carry");y=x,d++}if(m[d]!==" "){for(var R=A-y;R!==A&&w[R]===0;)R++;for(var N=new Uint8Array(p+(A-R)),z=p;R!==A;)N[z++]=w[R++];return N}}}function b(m){var d=h(m);if(d)return d;throw new Error(`Non-${t} character`)}return{encode:l,decodeUnsafe:h,decode:b}}var ju=zu,Wu=ju,Aa=Wu;var li=class{name;prefix;baseEncode;constructor(t,e,n){this.name=t,this.prefix=e,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}},ui=class{name;prefix;baseDecode;prefixCodePoint;constructor(t,e,n){if(this.name=t,this.prefix=e,e.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=e.codePointAt(0),this.baseDecode=n}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return Ba(this,t)}},fi=class{decoders;constructor(t){this.decoders=t}or(t){return Ba(this,t)}decode(t){let e=t[0],n=this.decoders[e];if(n!=null)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function Ba(r,t){return new fi({...r.decoders??{[r.prefix]:r},...t.decoders??{[t.prefix]:t}})}var hi=class{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(t,e,n,s){this.name=t,this.prefix=e,this.baseEncode=n,this.baseDecode=s,this.encoder=new li(t,e,n),this.decoder=new ui(t,e,s)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}};function dr({name:r,prefix:t,encode:e,decode:n}){return new hi(r,t,e,n)}function Ne({name:r,prefix:t,alphabet:e}){let{encode:n,decode:s}=Aa(e,r);return dr({prefix:t,name:r,encode:n,decode:i=>ue(s(i))})}function Yu(r,t,e,n){let s={};for(let u=0;u<t.length;++u)s[t[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;let o=new Uint8Array(i*e/8|0),a=0,c=0,f=0;for(let u=0;u<i;++u){let l=s[r[u]];if(l===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<e|l,a+=e,a>=8&&(a-=8,o[f++]=255&c>>a)}if(a>=e||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function Zu(r,t,e){let n=t[t.length-1]==="=",s=(1<<e)-1,i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>e;)o-=e,i+=t[s&a>>o];if(o!==0&&(i+=t[s&a<<e-o]),n)for(;i.length*e&7;)i+="=";return i}function st({name:r,prefix:t,bitsPerChar:e,alphabet:n}){return dr({prefix:t,name:r,encode(s){return Zu(s,n,e)},decode(s){return Yu(s,n,e,r)}})}var dt=Ne({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Xu=Ne({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var pi={};gt(pi,{base10:()=>Ju});var Ju=Ne({prefix:"9",name:"base10",alphabet:"0123456789"});var mi={};gt(mi,{base16:()=>Qu,base16upper:()=>tf});var Qu=st({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),tf=st({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var gi={};gt(gi,{base2:()=>ef});var ef=st({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var yi={};gt(yi,{base256emoji:()=>af});var Sa=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),rf=Sa.reduce((r,t,e)=>(r[e]=t,r),[]),nf=Sa.reduce((r,t,e)=>(r[t.codePointAt(0)]=e,r),[]);function sf(r){return r.reduce((t,e)=>(t+=rf[e],t),"")}function of(r){let t=[];for(let e of r){let n=nf[e.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${e}`);t.push(n)}return new Uint8Array(t)}var af=dr({prefix:"\u{1F680}",name:"base256emoji",encode:sf,decode:of});var bi={};gt(bi,{base32:()=>fe,base32hex:()=>ff,base32hexpad:()=>df,base32hexpadupper:()=>pf,base32hexupper:()=>hf,base32pad:()=>lf,base32padupper:()=>uf,base32upper:()=>cf,base32z:()=>mf});var fe=st({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),cf=st({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),lf=st({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),uf=st({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),ff=st({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),hf=st({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),df=st({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),pf=st({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),mf=st({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var wi={};gt(wi,{base36:()=>gf,base36upper:()=>yf});var gf=Ne({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),yf=Ne({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var vi={};gt(vi,{base64:()=>xi,base64pad:()=>bf,base64url:()=>wf,base64urlpad:()=>xf});var xi=st({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),bf=st({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),wf=st({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),xf=st({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Ei={};gt(Ei,{base8:()=>vf});var vf=st({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Ai={};gt(Ai,{identity:()=>Ef});var Ef=dr({prefix:"\0",name:"identity",encode:r=>va(r),decode:r=>xa(r)});var k0=new TextEncoder,R0=new TextDecoder;var Si={};gt(Si,{identity:()=>_e});var Sf=ka,Ta=128,Tf=127,If=~Tf,kf=Math.pow(2,31);function ka(r,t,e){t=t||[],e=e||0;for(var n=e;r>=kf;)t[e++]=r&255|Ta,r/=128;for(;r&If;)t[e++]=r&255|Ta,r>>>=7;return t[e]=r|0,ka.bytes=e-n+1,t}var Rf=Bi,Nf=128,Ia=127;function Bi(r,n){var e=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw Bi.bytes=0,new RangeError("Could not decode varint");o=r[i++],e+=s<28?(o&Ia)<<s:(o&Ia)*Math.pow(2,s),s+=7}while(o>=Nf);return Bi.bytes=i-n,e}var _f=Math.pow(2,7),Lf=Math.pow(2,14),Cf=Math.pow(2,21),Uf=Math.pow(2,28),Df=Math.pow(2,35),Of=Math.pow(2,42),Pf=Math.pow(2,49),Vf=Math.pow(2,56),Mf=Math.pow(2,63),Hf=function(r){return r<_f?1:r<Lf?2:r<Cf?3:r<Uf?4:r<Df?5:r<Of?6:r<Pf?7:r<Vf?8:r<Mf?9:10},Ff={encode:Sf,decode:Rf,encodingLength:Hf},Kf=Ff,$r=Kf;function Gr(r,t=0){return[$r.decode(r,t),$r.decode.bytes]}function pr(r,t,e=0){return $r.encode(r,t,e),t}function mr(r){return $r.encodingLength(r)}function re(r,t){let e=t.byteLength,n=mr(r),s=n+mr(e),i=new Uint8Array(s+e);return pr(r,i,0),pr(e,i,n),i.set(t,s),new gr(r,e,t,i)}function Ze(r){let t=ue(r),[e,n]=Gr(t),[s,i]=Gr(t.subarray(n)),o=t.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new gr(e,s,o,t)}function Ra(r,t){if(r===t)return!0;{let e=t;return r.code===e.code&&r.size===e.size&&e.bytes instanceof Uint8Array&&wa(r.bytes,e.bytes)}}var gr=class{code;size;digest;bytes;constructor(t,e,n,s){this.code=t,this.size=e,this.digest=n,this.bytes=s}};var Na=0,qf="identity",_a=ue;function $f(r){return re(Na,_a(r))}var _e={code:Na,name:qf,encode:_a,digest:$f};var ki={};gt(ki,{sha256:()=>pt,sha512:()=>Gf});function Ii({name:r,code:t,encode:e}){return new Ti(r,t,e)}var Ti=class{name;code;encode;constructor(t,e,n){this.name=t,this.code=e,this.encode=n}digest(t){if(t instanceof Uint8Array){let e=this.encode(t);return e instanceof Uint8Array?re(this.code,e):e.then(n=>re(this.code,n))}else throw Error("Unknown type, must be binary type")}};function Ca(r){return async t=>new Uint8Array(await crypto.subtle.digest(r,t))}var pt=Ii({name:"sha2-256",code:18,encode:Ca("SHA-256")}),Gf=Ii({name:"sha2-512",code:19,encode:Ca("SHA-512")});function Ua(r,t){let{bytes:e,version:n}=r;switch(n){case 0:return jf(e,Ri(r),t??dt.encoder);default:return Wf(e,Ri(r),t??fe.encoder)}}var Da=new WeakMap;function Ri(r){let t=Da.get(r);if(t==null){let e=new Map;return Da.set(r,e),e}return t}var Ct=class r{code;version;multihash;bytes;"/";constructor(t,e,n,s){this.code=e,this.version=t,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:t,multihash:e}=this;if(t!==zr)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(e.code!==Yf)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return r.createV0(e)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:t,digest:e}=this.multihash,n=re(t,e);return r.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(t){return r.equals(this,t)}static equals(t,e){let n=e;return n!=null&&t.code===n.code&&t.version===n.version&&Ra(t.multihash,n.multihash)}toString(t){return Ua(this,t)}toJSON(){return{"/":Ua(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(t){if(t==null)return null;let e=t;if(e instanceof r)return e;if(e["/"]!=null&&e["/"]===e.bytes||e.asCID===e){let{version:n,code:s,multihash:i,bytes:o}=e;return new r(n,s,i,o??Oa(n,s,i.bytes))}else if(e[Zf]===!0){let{version:n,multihash:s,code:i}=e,o=Ze(s);return r.create(n,i,o)}else return null}static create(t,e,n){if(typeof e!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(t){case 0:{if(e!==zr)throw new Error(`Version 0 CID must use dag-pb (code: ${zr}) block encoding`);return new r(t,e,n,n.bytes)}case 1:{let s=Oa(t,e,n.bytes);return new r(t,e,n,s)}default:throw new Error("Invalid version")}}static createV0(t){return r.create(0,zr,t)}static createV1(t,e){return r.create(1,t,e)}static decode(t){let[e,n]=r.decodeFirst(t);if(n.length!==0)throw new Error("Incorrect length");return e}static decodeFirst(t){let e=r.inspectBytes(t),n=e.size-e.multihashSize,s=ue(t.subarray(n,n+e.multihashSize));if(s.byteLength!==e.multihashSize)throw new Error("Incorrect length");let i=s.subarray(e.multihashSize-e.digestSize),o=new gr(e.multihashCode,e.digestSize,i,s);return[e.version===0?r.createV0(o):r.createV1(e.codec,o),t.subarray(e.size)]}static inspectBytes(t){let e=0,n=()=>{let[l,h]=Gr(t.subarray(e));return e+=h,l},s=n(),i=zr;if(s===18?(s=0,e=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);let o=e,a=n(),c=n(),f=e+c,u=f-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:u,size:f}}static parse(t,e){let[n,s]=zf(t,e),i=r.decode(s);if(i.version===0&&t[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return Ri(i).set(n,t),i}};function zf(r,t){switch(r[0]){case"Q":{let e=t??dt;return[dt.prefix,e.decode(`${dt.prefix}${r}`)]}case dt.prefix:{let e=t??dt;return[dt.prefix,e.decode(r)]}case fe.prefix:{let e=t??fe;return[fe.prefix,e.decode(r)]}default:{if(t==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],t.decode(r)]}}}function jf(r,t,e){let{prefix:n}=e;if(n!==dt.prefix)throw Error(`Cannot string encode V0 in ${e.name} encoding`);let s=t.get(n);if(s==null){let i=e.encode(r).slice(1);return t.set(n,i),i}else return s}function Wf(r,t,e){let{prefix:n}=e,s=t.get(n);if(s==null){let i=e.encode(r);return t.set(n,i),i}else return s}var zr=112,Yf=18;function Oa(r,t,e){let n=mr(r),s=n+mr(t),i=new Uint8Array(s+e.byteLength);return pr(r,i,0),pr(t,i,n),i.set(e,s),i}var Zf=Symbol.for("@ipld/js-cid/CID");var Le={...Ai,...gi,...Ei,...pi,...mi,...bi,...wi,...di,...vi,...yi},Z0={...ki,...Si};function ut(r,t){if(r===t)return!0;if(r.byteLength!==t.byteLength)return!1;for(let e=0;e<r.byteLength;e++)if(r[e]!==t[e])return!1;return!0}var Xf=Symbol.for("nodejs.util.inspect.custom"),Pa=Object.values(Le).map(r=>r.decoder).reduce((r,t)=>r.or(t),Le.identity.decoder),Va=114,Ni=36,_i=37,jr=class{type;multihash;privateKey;publicKey;string;constructor(t){this.type=t.type,this.multihash=t.multihash,this.privateKey=t.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[ga]=!0;toString(){return this.string==null&&(this.string=dt.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return Ct.createV1(Va,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(t){if(t==null)return!1;if(t instanceof Uint8Array)return ut(this.multihash.bytes,t);if(typeof t=="string")return Ce(t).equals(this);if(t?.multihash?.bytes!=null)return ut(this.multihash.bytes,t.multihash.bytes);throw new Error("not valid Id")}[Xf](){return`PeerId(${this.toString()})`}},yr=class extends jr{type="RSA";publicKey;constructor(t){super({...t,type:"RSA"}),this.publicKey=t.publicKey}},br=class extends jr{type="Ed25519";publicKey;constructor(t){super({...t,type:"Ed25519"}),this.publicKey=t.multihash.digest}},wr=class extends jr{type="secp256k1";publicKey;constructor(t){super({...t,type:"secp256k1"}),this.publicKey=t.multihash.digest}};function Ce(r,t){if(t=t??Pa,r.charAt(0)==="1"||r.charAt(0)==="Q"){let e=Ze(dt.decode(`z${r}`));return r.startsWith("12D")?new br({multihash:e}):r.startsWith("16U")?new wr({multihash:e}):new yr({multihash:e})}return Wr(Pa.decode(r))}function Wr(r){try{let t=Ze(r);if(t.code===_e.code){if(t.digest.length===Ni)return new br({multihash:t});if(t.digest.length===_i)return new wr({multihash:t})}if(t.code===pt.code)return new yr({multihash:t})}catch{return Jf(Ct.decode(r))}throw new Error("Supplied PeerID CID is invalid")}function Jf(r){if(r==null||r.multihash==null||r.version==null||r.version===1&&r.code!==Va)throw new Error("Supplied PeerID CID is invalid");let t=r.multihash;if(t.code===pt.code)return new yr({multihash:r.multihash});if(t.code===_e.code){if(t.digest.length===Ni)return new br({multihash:r.multihash});if(t.digest.length===_i)return new wr({multihash:r.multihash})}throw new Error("Supplied PeerID CID is invalid")}async function Ma(r,t){return r.length===Ni?new br({multihash:re(_e.code,r),privateKey:t}):r.length===_i?new wr({multihash:re(_e.code,r),privateKey:t}):new yr({multihash:await pt.digest(r),publicKey:r,privateKey:t})}var ao={};gt(ao,{Ed25519PrivateKey:()=>sr,Ed25519PublicKey:()=>tn,generateKeyPair:()=>bd,generateKeyPairFromSeed:()=>vc,unmarshalEd25519PrivateKey:()=>gd,unmarshalEd25519PublicKey:()=>yd});function Ue(r){return globalThis.Buffer!=null?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r}function he(r=0){return globalThis.Buffer?.alloc!=null?Ue(globalThis.Buffer.alloc(r)):new Uint8Array(r)}function Nt(r=0){return globalThis.Buffer?.allocUnsafe!=null?Ue(globalThis.Buffer.allocUnsafe(r)):new Uint8Array(r)}function St(r,t){if(globalThis.Buffer!=null)return Ue(globalThis.Buffer.concat(r,t));t==null&&(t=r.reduce((s,i)=>s+i.length,0));let e=Nt(t),n=0;for(let s of r)e.set(s,n),n+=s.length;return Ue(e)}function Fa(r,t,e,n){return{name:r,prefix:t,encoder:{name:r,prefix:t,encode:e},decoder:{decode:n}}}var Ha=Fa("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),Li=Fa("ascii","a",r=>{let t="a";for(let e=0;e<r.length;e++)t+=String.fromCharCode(r[e]);return t},r=>{r=r.substring(1);let t=Nt(r.length);for(let e=0;e<r.length;e++)t[e]=r.charCodeAt(e);return t}),Qf={utf8:Ha,"utf-8":Ha,hex:Le.base16,latin1:Li,ascii:Li,binary:Li,...Le},An=Qf;function Q(r,t="utf8"){let e=An[t];if(e==null)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Ue(globalThis.Buffer.from(r,"utf-8")):e.decoder.decode(`${e.prefix}${r}`)}function Ft(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}function xr(r){if(!Number.isSafeInteger(r)||r<0)throw new Error(`Wrong positive integer: ${r}`)}function th(r){return r instanceof Uint8Array||r!=null&&typeof r=="object"&&r.constructor.name==="Uint8Array"}function Ci(r,...t){if(!th(r))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(r.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${r.length}`)}function Bn(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");xr(r.outputLen),xr(r.blockLen)}function vr(r,t=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(t&&r.finished)throw new Error("Hash#digest() has already been called")}function Ka(r,t){Ci(r);let e=t.outputLen;if(r.length<e)throw new Error(`digestInto() expects output buffer of length at least ${e}`)}var Sn=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function qa(r){return r instanceof Uint8Array||r!=null&&typeof r=="object"&&r.constructor.name==="Uint8Array"}var Ar=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),Wt=(r,t)=>r<<32-t|r>>>t,eh=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!eh)throw new Error("Non little-endian hardware is not supported");var rh=async()=>{};async function $a(r,t,e){let n=Date.now();for(let s=0;s<r;s++){e(s);let i=Date.now()-n;i>=0&&i<t||(await rh(),n+=i)}}function Ui(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function De(r){if(typeof r=="string"&&(r=Ui(r)),!qa(r))throw new Error(`expected Uint8Array, got ${typeof r}`);return r}function Tn(...r){let t=0;for(let n=0;n<r.length;n++){let s=r[n];if(!qa(s))throw new Error("Uint8Array expected");t+=s.length}let e=new Uint8Array(t);for(let n=0,s=0;n<r.length;n++){let i=r[n];e.set(i,s),s+=i.length}return e}var Er=class{clone(){return this._cloneInto()}},nh={}.toString;function Ga(r,t){if(t!==void 0&&nh.call(t)!=="[object Object]")throw new Error("Options should be object or undefined");return Object.assign(r,t)}function In(r){let t=n=>r().update(De(n)).digest(),e=r();return t.outputLen=e.outputLen,t.blockLen=e.blockLen,t.create=()=>r(),t}function Br(r=32){if(Sn&&typeof Sn.getRandomValues=="function")return Sn.getRandomValues(new Uint8Array(r));throw new Error("crypto.getRandomValues must be defined")}function sh(r,t,e,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(t,e,n);let s=BigInt(32),i=BigInt(4294967295),o=Number(e>>s&i),a=Number(e&i),c=n?4:0,f=n?0:4;r.setUint32(t+c,o,n),r.setUint32(t+f,a,n)}var Sr=class extends Er{constructor(t,e,n,s){super(),this.blockLen=t,this.outputLen=e,this.padOffset=n,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Ar(this.buffer)}update(t){vr(this);let{view:e,buffer:n,blockLen:s}=this;t=De(t);let i=t.length;for(let o=0;o<i;){let a=Math.min(s-this.pos,i-o);if(a===s){let c=Ar(t);for(;s<=i-o;o+=s)this.process(c,o);continue}n.set(t.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(e,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){vr(this),Ka(t,this),this.finished=!0;let{buffer:e,view:n,blockLen:s,isLE:i}=this,{pos:o}=this;e[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(n,0),o=0);for(let l=o;l<s;l++)e[l]=0;sh(n,s-8,BigInt(this.length*8),i),this.process(n,0);let a=Ar(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let f=c/4,u=this.get();if(f>u.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<f;l++)a.setUint32(4*l,u[l],i)}digest(){let{buffer:t,outputLen:e}=this;this.digestInto(t);let n=t.slice(0,e);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:e,buffer:n,length:s,finished:i,destroyed:o,pos:a}=this;return t.length=s,t.pos=a,t.finished=i,t.destroyed=o,s%e&&t.buffer.set(n),t}};var kn=BigInt(4294967295),Di=BigInt(32);function za(r,t=!1){return t?{h:Number(r&kn),l:Number(r>>Di&kn)}:{h:Number(r>>Di&kn)|0,l:Number(r&kn)|0}}function ih(r,t=!1){let e=new Uint32Array(r.length),n=new Uint32Array(r.length);for(let s=0;s<r.length;s++){let{h:i,l:o}=za(r[s],t);[e[s],n[s]]=[i,o]}return[e,n]}var oh=(r,t)=>BigInt(r>>>0)<<Di|BigInt(t>>>0),ah=(r,t,e)=>r>>>e,ch=(r,t,e)=>r<<32-e|t>>>e,lh=(r,t,e)=>r>>>e|t<<32-e,uh=(r,t,e)=>r<<32-e|t>>>e,fh=(r,t,e)=>r<<64-e|t>>>e-32,hh=(r,t,e)=>r>>>e-32|t<<64-e,dh=(r,t)=>t,ph=(r,t)=>r,mh=(r,t,e)=>r<<e|t>>>32-e,gh=(r,t,e)=>t<<e|r>>>32-e,yh=(r,t,e)=>t<<e-32|r>>>64-e,bh=(r,t,e)=>r<<e-32|t>>>64-e;function wh(r,t,e,n){let s=(t>>>0)+(n>>>0);return{h:r+e+(s/2**32|0)|0,l:s|0}}var xh=(r,t,e)=>(r>>>0)+(t>>>0)+(e>>>0),vh=(r,t,e,n)=>t+e+n+(r/2**32|0)|0,Eh=(r,t,e,n)=>(r>>>0)+(t>>>0)+(e>>>0)+(n>>>0),Ah=(r,t,e,n,s)=>t+e+n+s+(r/2**32|0)|0,Bh=(r,t,e,n,s)=>(r>>>0)+(t>>>0)+(e>>>0)+(n>>>0)+(s>>>0),Sh=(r,t,e,n,s,i)=>t+e+n+s+i+(r/2**32|0)|0;var Th={fromBig:za,split:ih,toBig:oh,shrSH:ah,shrSL:ch,rotrSH:lh,rotrSL:uh,rotrBH:fh,rotrBL:hh,rotr32H:dh,rotr32L:ph,rotlSH:mh,rotlSL:gh,rotlBH:yh,rotlBL:bh,add:wh,add3L:xh,add3H:vh,add4L:Eh,add4H:Ah,add5H:Sh,add5L:Bh},O=Th;var[Ih,kh]=O.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),Oe=new Uint32Array(80),Pe=new Uint32Array(80),Oi=class extends Sr{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){let{Ah:t,Al:e,Bh:n,Bl:s,Ch:i,Cl:o,Dh:a,Dl:c,Eh:f,El:u,Fh:l,Fl:h,Gh:b,Gl:m,Hh:d,Hl:p}=this;return[t,e,n,s,i,o,a,c,f,u,l,h,b,m,d,p]}set(t,e,n,s,i,o,a,c,f,u,l,h,b,m,d,p){this.Ah=t|0,this.Al=e|0,this.Bh=n|0,this.Bl=s|0,this.Ch=i|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=f|0,this.El=u|0,this.Fh=l|0,this.Fl=h|0,this.Gh=b|0,this.Gl=m|0,this.Hh=d|0,this.Hl=p|0}process(t,e){for(let w=0;w<16;w++,e+=4)Oe[w]=t.getUint32(e),Pe[w]=t.getUint32(e+=4);for(let w=16;w<80;w++){let _=Oe[w-15]|0,x=Pe[w-15]|0,S=O.rotrSH(_,x,1)^O.rotrSH(_,x,8)^O.shrSH(_,x,7),R=O.rotrSL(_,x,1)^O.rotrSL(_,x,8)^O.shrSL(_,x,7),N=Oe[w-2]|0,z=Pe[w-2]|0,$=O.rotrSH(N,z,19)^O.rotrBH(N,z,61)^O.shrSH(N,z,6),P=O.rotrSL(N,z,19)^O.rotrBL(N,z,61)^O.shrSL(N,z,6),ct=O.add4L(R,P,Pe[w-7],Pe[w-16]),ot=O.add4H(ct,S,$,Oe[w-7],Oe[w-16]);Oe[w]=ot|0,Pe[w]=ct|0}let{Ah:n,Al:s,Bh:i,Bl:o,Ch:a,Cl:c,Dh:f,Dl:u,Eh:l,El:h,Fh:b,Fl:m,Gh:d,Gl:p,Hh:y,Hl:A}=this;for(let w=0;w<80;w++){let _=O.rotrSH(l,h,14)^O.rotrSH(l,h,18)^O.rotrBH(l,h,41),x=O.rotrSL(l,h,14)^O.rotrSL(l,h,18)^O.rotrBL(l,h,41),S=l&b^~l&d,R=h&m^~h&p,N=O.add5L(A,x,R,kh[w],Pe[w]),z=O.add5H(N,y,_,S,Ih[w],Oe[w]),$=N|0,P=O.rotrSH(n,s,28)^O.rotrBH(n,s,34)^O.rotrBH(n,s,39),ct=O.rotrSL(n,s,28)^O.rotrBL(n,s,34)^O.rotrBL(n,s,39),ot=n&i^n&a^i&a,Ht=s&o^s&c^o&c;y=d|0,A=p|0,d=b|0,p=m|0,b=l|0,m=h|0,{h:l,l:h}=O.add(f|0,u|0,z|0,$|0),f=a|0,u=c|0,a=i|0,c=o|0,i=n|0,o=s|0;let v=O.add3L($,ct,Ht);n=O.add3H(v,z,P,ot),s=v|0}({h:n,l:s}=O.add(this.Ah|0,this.Al|0,n|0,s|0)),{h:i,l:o}=O.add(this.Bh|0,this.Bl|0,i|0,o|0),{h:a,l:c}=O.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:f,l:u}=O.add(this.Dh|0,this.Dl|0,f|0,u|0),{h:l,l:h}=O.add(this.Eh|0,this.El|0,l|0,h|0),{h:b,l:m}=O.add(this.Fh|0,this.Fl|0,b|0,m|0),{h:d,l:p}=O.add(this.Gh|0,this.Gl|0,d|0,p|0),{h:y,l:A}=O.add(this.Hh|0,this.Hl|0,y|0,A|0),this.set(n,s,i,o,a,c,f,u,l,h,b,m,d,p,y,A)}roundClean(){Oe.fill(0),Pe.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};var Tr=In(()=>new Oi);var Nn={};gt(Nn,{bitGet:()=>Dh,bitLen:()=>Uh,bitMask:()=>Yr,bitSet:()=>Oh,bytesToHex:()=>pe,bytesToNumberBE:()=>me,bytesToNumberLE:()=>Ve,concatBytes:()=>ge,createHmacDrbg:()=>Mi,ensureBytes:()=>it,equalBytes:()=>Lh,hexToBytes:()=>Je,hexToNumber:()=>Vi,isBytes:()=>Yt,numberToBytesBE:()=>Me,numberToBytesLE:()=>Qe,numberToHexUnpadded:()=>Za,numberToVarBytesBE:()=>_h,utf8ToBytes:()=>Ch,validateObject:()=>ne});var Ya=BigInt(0),Rn=BigInt(1),Rh=BigInt(2);function Yt(r){return r instanceof Uint8Array||r!=null&&typeof r=="object"&&r.constructor.name==="Uint8Array"}var Nh=Array.from({length:256},(r,t)=>t.toString(16).padStart(2,"0"));function pe(r){if(!Yt(r))throw new Error("Uint8Array expected");let t="";for(let e=0;e<r.length;e++)t+=Nh[r[e]];return t}function Za(r){let t=r.toString(16);return t.length&1?`0${t}`:t}function Vi(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return BigInt(r===""?"0":`0x${r}`)}var de={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function ja(r){if(r>=de._0&&r<=de._9)return r-de._0;if(r>=de._A&&r<=de._F)return r-(de._A-10);if(r>=de._a&&r<=de._f)return r-(de._a-10)}function Je(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);let t=r.length,e=t/2;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(e);for(let s=0,i=0;s<e;s++,i+=2){let o=ja(r.charCodeAt(i)),a=ja(r.charCodeAt(i+1));if(o===void 0||a===void 0){let c=r[i]+r[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}n[s]=o*16+a}return n}function me(r){return Vi(pe(r))}function Ve(r){if(!Yt(r))throw new Error("Uint8Array expected");return Vi(pe(Uint8Array.from(r).reverse()))}function Me(r,t){return Je(r.toString(16).padStart(t*2,"0"))}function Qe(r,t){return Me(r,t).reverse()}function _h(r){return Je(Za(r))}function it(r,t,e){let n;if(typeof t=="string")try{n=Je(t)}catch(i){throw new Error(`${r} must be valid hex string, got "${t}". Cause: ${i}`)}else if(Yt(t))n=Uint8Array.from(t);else throw new Error(`${r} must be hex string or Uint8Array`);let s=n.length;if(typeof e=="number"&&s!==e)throw new Error(`${r} expected ${e} bytes, got ${s}`);return n}function ge(...r){let t=0;for(let s=0;s<r.length;s++){let i=r[s];if(!Yt(i))throw new Error("Uint8Array expected");t+=i.length}let e=new Uint8Array(t),n=0;for(let s=0;s<r.length;s++){let i=r[s];e.set(i,n),n+=i.length}return e}function Lh(r,t){if(r.length!==t.length)return!1;let e=0;for(let n=0;n<r.length;n++)e|=r[n]^t[n];return e===0}function Ch(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function Uh(r){let t;for(t=0;r>Ya;r>>=Rn,t+=1);return t}function Dh(r,t){return r>>BigInt(t)&Rn}var Oh=(r,t,e)=>r|(e?Rn:Ya)<<BigInt(t),Yr=r=>(Rh<<BigInt(r-1))-Rn,Pi=r=>new Uint8Array(r),Wa=r=>Uint8Array.from(r);function Mi(r,t,e){if(typeof r!="number"||r<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof e!="function")throw new Error("hmacFn must be a function");let n=Pi(r),s=Pi(r),i=0,o=()=>{n.fill(1),s.fill(0),i=0},a=(...l)=>e(s,n,...l),c=(l=Pi())=>{s=a(Wa([0]),l),n=a(),l.length!==0&&(s=a(Wa([1]),l),n=a())},f=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let l=0,h=[];for(;l<t;){n=a();let b=n.slice();h.push(b),l+=n.length}return ge(...h)};return(l,h)=>{o(),c(l);let b;for(;!(b=h(f()));)c();return o(),b}}var Ph={bigint:r=>typeof r=="bigint",function:r=>typeof r=="function",boolean:r=>typeof r=="boolean",string:r=>typeof r=="string",stringOrUint8Array:r=>typeof r=="string"||Yt(r),isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,t)=>t.Fp.isValid(r),hash:r=>typeof r=="function"&&Number.isSafeInteger(r.outputLen)};function ne(r,t,e={}){let n=(s,i,o)=>{let a=Ph[i];if(typeof a!="function")throw new Error(`Invalid validator "${i}", expected function`);let c=r[s];if(!(o&&c===void 0)&&!a(c,r))throw new Error(`Invalid param ${String(s)}=${c} (${typeof c}), expected ${i}`)};for(let[s,i]of Object.entries(t))n(s,i,!1);for(let[s,i]of Object.entries(e))n(s,i,!0);return r}var mt=BigInt(0),tt=BigInt(1),tr=BigInt(2),Vh=BigInt(3),Hi=BigInt(4),Xa=BigInt(5),Ja=BigInt(8),Mh=BigInt(9),Hh=BigInt(16);function X(r,t){let e=r%t;return e>=mt?e:t+e}function Fh(r,t,e){if(e<=mt||t<mt)throw new Error("Expected power/modulo > 0");if(e===tt)return mt;let n=tt;for(;t>mt;)t&tt&&(n=n*r%e),r=r*r%e,t>>=tt;return n}function et(r,t,e){let n=r;for(;t-- >mt;)n*=n,n%=e;return n}function _n(r,t){if(r===mt||t<=mt)throw new Error(`invert: expected positive integers, got n=${r} mod=${t}`);let e=X(r,t),n=t,s=mt,i=tt,o=tt,a=mt;for(;e!==mt;){let f=n/e,u=n%e,l=s-o*f,h=i-a*f;n=e,e=u,s=o,i=a,o=l,a=h}if(n!==tt)throw new Error("invert: does not exist");return X(s,t)}function Kh(r){let t=(r-tt)/tr,e,n,s;for(e=r-tt,n=0;e%tr===mt;e/=tr,n++);for(s=tr;s<r&&Fh(s,t,r)!==r-tt;s++);if(n===1){let o=(r+tt)/Hi;return function(c,f){let u=c.pow(f,o);if(!c.eql(c.sqr(u),f))throw new Error("Cannot find square root");return u}}let i=(e+tt)/tr;return function(a,c){if(a.pow(c,t)===a.neg(a.ONE))throw new Error("Cannot find square root");let f=n,u=a.pow(a.mul(a.ONE,s),e),l=a.pow(c,i),h=a.pow(c,e);for(;!a.eql(h,a.ONE);){if(a.eql(h,a.ZERO))return a.ZERO;let b=1;for(let d=a.sqr(h);b<f&&!a.eql(d,a.ONE);b++)d=a.sqr(d);let m=a.pow(u,tt<<BigInt(f-b-1));u=a.sqr(m),l=a.mul(l,m),h=a.mul(h,u),f=b}return l}}function qh(r){if(r%Hi===Vh){let t=(r+tt)/Hi;return function(n,s){let i=n.pow(s,t);if(!n.eql(n.sqr(i),s))throw new Error("Cannot find square root");return i}}if(r%Ja===Xa){let t=(r-Xa)/Ja;return function(n,s){let i=n.mul(s,tr),o=n.pow(i,t),a=n.mul(s,o),c=n.mul(n.mul(a,tr),o),f=n.mul(a,n.sub(c,n.ONE));if(!n.eql(n.sqr(f),s))throw new Error("Cannot find square root");return f}}return r%Hh,Kh(r)}var Qa=(r,t)=>(X(r,t)&tt)===tt,$h=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Fi(r){let t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},e=$h.reduce((n,s)=>(n[s]="function",n),t);return ne(r,e)}function Gh(r,t,e){if(e<mt)throw new Error("Expected power > 0");if(e===mt)return r.ONE;if(e===tt)return t;let n=r.ONE,s=t;for(;e>mt;)e&tt&&(n=r.mul(n,s)),s=r.sqr(s),e>>=tt;return n}function zh(r,t){let e=new Array(t.length),n=t.reduce((i,o,a)=>r.is0(o)?i:(e[a]=i,r.mul(i,o)),r.ONE),s=r.inv(n);return t.reduceRight((i,o,a)=>r.is0(o)?i:(e[a]=r.mul(i,e[a]),r.mul(i,o)),s),e}function Ki(r,t){let e=t!==void 0?t:r.toString(2).length,n=Math.ceil(e/8);return{nBitLength:e,nByteLength:n}}function Ln(r,t,e=!1,n={}){if(r<=mt)throw new Error(`Expected Field ORDER > 0, got ${r}`);let{nBitLength:s,nByteLength:i}=Ki(r,t);if(i>2048)throw new Error("Field lengths over 2048 bytes are not supported");let o=qh(r),a=Object.freeze({ORDER:r,BITS:s,BYTES:i,MASK:Yr(s),ZERO:mt,ONE:tt,create:c=>X(c,r),isValid:c=>{if(typeof c!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof c}`);return mt<=c&&c<r},is0:c=>c===mt,isOdd:c=>(c&tt)===tt,neg:c=>X(-c,r),eql:(c,f)=>c===f,sqr:c=>X(c*c,r),add:(c,f)=>X(c+f,r),sub:(c,f)=>X(c-f,r),mul:(c,f)=>X(c*f,r),pow:(c,f)=>Gh(a,c,f),div:(c,f)=>X(c*_n(f,r),r),sqrN:c=>c*c,addN:(c,f)=>c+f,subN:(c,f)=>c-f,mulN:(c,f)=>c*f,inv:c=>_n(c,r),sqrt:n.sqrt||(c=>o(a,c)),invertBatch:c=>zh(a,c),cmov:(c,f,u)=>u?f:c,toBytes:c=>e?Qe(c,i):Me(c,i),fromBytes:c=>{if(c.length!==i)throw new Error(`Fp.fromBytes: expected ${i}, got ${c.length}`);return e?Ve(c):me(c)}});return Object.freeze(a)}function tc(r,t){if(!r.isOdd)throw new Error("Field doesn't have isOdd");let e=r.sqrt(t);return r.isOdd(e)?r.neg(e):e}function ec(r){if(typeof r!="bigint")throw new Error("field order must be bigint");let t=r.toString(2).length;return Math.ceil(t/8)}function qi(r){let t=ec(r);return t+Math.ceil(t/2)}function rc(r,t,e=!1){let n=r.length,s=ec(t),i=qi(t);if(n<16||n<i||n>1024)throw new Error(`expected ${i}-1024 bytes of input, got ${n}`);let o=e?me(r):Ve(r),a=X(o,t-tt)+tt;return e?Qe(a,s):Me(a,s)}var Wh=BigInt(0),$i=BigInt(1);function Cn(r,t){let e=(s,i)=>{let o=i.negate();return s?o:i},n=s=>{let i=Math.ceil(t/s)+1,o=2**(s-1);return{windows:i,windowSize:o}};return{constTimeNegate:e,unsafeLadder(s,i){let o=r.ZERO,a=s;for(;i>Wh;)i&$i&&(o=o.add(a)),a=a.double(),i>>=$i;return o},precomputeWindow(s,i){let{windows:o,windowSize:a}=n(i),c=[],f=s,u=f;for(let l=0;l<o;l++){u=f,c.push(u);for(let h=1;h<a;h++)u=u.add(f),c.push(u);f=u.double()}return c},wNAF(s,i,o){let{windows:a,windowSize:c}=n(s),f=r.ZERO,u=r.BASE,l=BigInt(2**s-1),h=2**s,b=BigInt(s);for(let m=0;m<a;m++){let d=m*c,p=Number(o&l);o>>=b,p>c&&(p-=h,o+=$i);let y=d,A=d+Math.abs(p)-1,w=m%2!==0,_=p<0;p===0?u=u.add(e(w,i[y])):f=f.add(e(_,i[A]))}return{p:f,f:u}},wNAFCached(s,i,o,a){let c=s._WINDOW_SIZE||1,f=i.get(s);return f||(f=this.precomputeWindow(s,c),c!==1&&i.set(s,a(f))),this.wNAF(c,f,o)}}}function Zr(r){return Fi(r.Fp),ne(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Ki(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}var Zt=BigInt(0),Ut=BigInt(1),Un=BigInt(2),Yh=BigInt(8),Zh={zip215:!0};function Xh(r){let t=Zr(r);return ne(r,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...t})}function Dn(r){let t=Xh(r),{Fp:e,n,prehash:s,hash:i,randomBytes:o,nByteLength:a,h:c}=t,f=Un<<BigInt(a*8)-Ut,u=e.create,l=t.uvRatio||((E,g)=>{try{return{isValid:!0,value:e.sqrt(E*e.inv(g))}}catch{return{isValid:!1,value:Zt}}}),h=t.adjustScalarBytes||(E=>E),b=t.domain||((E,g,I)=>{if(g.length||I)throw new Error("Contexts/pre-hash are not supported");return E}),m=E=>typeof E=="bigint"&&Zt<E,d=(E,g)=>m(E)&&m(g)&&E<g,p=E=>E===Zt||d(E,f);function y(E,g){if(d(E,g))return E;throw new Error(`Expected valid scalar < ${g}, got ${typeof E} ${E}`)}function A(E){return E===Zt?E:y(E,n)}let w=new Map;function _(E){if(!(E instanceof x))throw new Error("ExtendedPoint expected")}class x{constructor(g,I,C,D){if(this.ex=g,this.ey=I,this.ez=C,this.et=D,!p(g))throw new Error("x required");if(!p(I))throw new Error("y required");if(!p(C))throw new Error("z required");if(!p(D))throw new Error("t required")}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(g){if(g instanceof x)throw new Error("extended point not allowed");let{x:I,y:C}=g||{};if(!p(I)||!p(C))throw new Error("invalid affine point");return new x(I,C,Ut,u(I*C))}static normalizeZ(g){let I=e.invertBatch(g.map(C=>C.ez));return g.map((C,D)=>C.toAffine(I[D])).map(x.fromAffine)}_setWindowSize(g){this._WINDOW_SIZE=g,w.delete(this)}assertValidity(){let{a:g,d:I}=t;if(this.is0())throw new Error("bad point: ZERO");let{ex:C,ey:D,ez:M,et:F}=this,Y=u(C*C),q=u(D*D),G=u(M*M),lt=u(G*G),nt=u(Y*g),bt=u(G*u(nt+q)),wt=u(lt+u(I*u(Y*q)));if(bt!==wt)throw new Error("bad point: equation left != right (1)");let ht=u(C*D),vt=u(M*F);if(ht!==vt)throw new Error("bad point: equation left != right (2)")}equals(g){_(g);let{ex:I,ey:C,ez:D}=this,{ex:M,ey:F,ez:Y}=g,q=u(I*Y),G=u(M*D),lt=u(C*Y),nt=u(F*D);return q===G&&lt===nt}is0(){return this.equals(x.ZERO)}negate(){return new x(u(-this.ex),this.ey,this.ez,u(-this.et))}double(){let{a:g}=t,{ex:I,ey:C,ez:D}=this,M=u(I*I),F=u(C*C),Y=u(Un*u(D*D)),q=u(g*M),G=I+C,lt=u(u(G*G)-M-F),nt=q+F,bt=nt-Y,wt=q-F,ht=u(lt*bt),vt=u(nt*wt),le=u(lt*wt),Ye=u(bt*nt);return new x(ht,vt,Ye,le)}add(g){_(g);let{a:I,d:C}=t,{ex:D,ey:M,ez:F,et:Y}=this,{ex:q,ey:G,ez:lt,et:nt}=g;if(I===BigInt(-1)){let aa=u((M-D)*(G+q)),ca=u((M+D)*(G-q)),ai=u(ca-aa);if(ai===Zt)return this.double();let la=u(F*Un*nt),ua=u(Y*Un*lt),fa=ua+la,ha=ca+aa,da=ua-la,Du=u(fa*ai),Ou=u(ha*da),Pu=u(fa*da),Vu=u(ai*ha);return new x(Du,Ou,Vu,Pu)}let bt=u(D*q),wt=u(M*G),ht=u(Y*C*nt),vt=u(F*lt),le=u((D+M)*(q+G)-bt-wt),Ye=vt-ht,qr=vt+ht,oa=u(wt-I*bt),_u=u(le*Ye),Lu=u(qr*oa),Cu=u(le*oa),Uu=u(Ye*qr);return new x(_u,Lu,Uu,Cu)}subtract(g){return this.add(g.negate())}wNAF(g){return N.wNAFCached(this,w,g,x.normalizeZ)}multiply(g){let{p:I,f:C}=this.wNAF(y(g,n));return x.normalizeZ([I,C])[0]}multiplyUnsafe(g){let I=A(g);return I===Zt?R:this.equals(R)||I===Ut?this:this.equals(S)?this.wNAF(I).p:N.unsafeLadder(this,I)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return N.unsafeLadder(this,n).is0()}toAffine(g){let{ex:I,ey:C,ez:D}=this,M=this.is0();g==null&&(g=M?Yh:e.inv(D));let F=u(I*g),Y=u(C*g),q=u(D*g);if(M)return{x:Zt,y:Ut};if(q!==Ut)throw new Error("invZ was invalid");return{x:F,y:Y}}clearCofactor(){let{h:g}=t;return g===Ut?this:this.multiplyUnsafe(g)}static fromHex(g,I=!1){let{d:C,a:D}=t,M=e.BYTES;g=it("pointHex",g,M);let F=g.slice(),Y=g[M-1];F[M-1]=Y&-129;let q=Ve(F);q===Zt||(I?y(q,f):y(q,e.ORDER));let G=u(q*q),lt=u(G-Ut),nt=u(C*G-D),{isValid:bt,value:wt}=l(lt,nt);if(!bt)throw new Error("Point.fromHex: invalid y coordinate");let ht=(wt&Ut)===Ut,vt=(Y&128)!==0;if(!I&&wt===Zt&&vt)throw new Error("Point.fromHex: x=0 and x_0=1");return vt!==ht&&(wt=u(-wt)),x.fromAffine({x:wt,y:q})}static fromPrivateKey(g){return P(g).point}toRawBytes(){let{x:g,y:I}=this.toAffine(),C=Qe(I,e.BYTES);return C[C.length-1]|=g&Ut?128:0,C}toHex(){return pe(this.toRawBytes())}}x.BASE=new x(t.Gx,t.Gy,Ut,u(t.Gx*t.Gy)),x.ZERO=new x(Zt,Ut,Ut,Zt);let{BASE:S,ZERO:R}=x,N=Cn(x,a*8);function z(E){return X(E,n)}function $(E){return z(Ve(E))}function P(E){let g=a;E=it("private key",E,g);let I=it("hashed private key",i(E),2*g),C=h(I.slice(0,g)),D=I.slice(g,2*g),M=$(C),F=S.multiply(M),Y=F.toRawBytes();return{head:C,prefix:D,scalar:M,point:F,pointBytes:Y}}function ct(E){return P(E).pointBytes}function ot(E=new Uint8Array,...g){let I=ge(...g);return $(i(b(I,it("context",E),!!s)))}function Ht(E,g,I={}){E=it("message",E),s&&(E=s(E));let{prefix:C,scalar:D,pointBytes:M}=P(g),F=ot(I.context,C,E),Y=S.multiply(F).toRawBytes(),q=ot(I.context,Y,M,E),G=z(F+q*D);A(G);let lt=ge(Y,Qe(G,e.BYTES));return it("result",lt,a*2)}let v=Zh;function k(E,g,I,C=v){let{context:D,zip215:M}=C,F=e.BYTES;E=it("signature",E,2*F),g=it("message",g),s&&(g=s(g));let Y=Ve(E.slice(F,2*F)),q,G,lt;try{q=x.fromHex(I,M),G=x.fromHex(E.slice(0,F),M),lt=S.multiplyUnsafe(Y)}catch{return!1}if(!M&&q.isSmallOrder())return!1;let nt=ot(D,G.toRawBytes(),q.toRawBytes(),g);return G.add(q.multiplyUnsafe(nt)).subtract(lt).clearCofactor().equals(x.ZERO)}return S._setWindowSize(8),{CURVE:t,getPublicKey:ct,sign:Ht,verify:k,ExtendedPoint:x,utils:{getExtendedPublicKey:P,randomPrivateKey:()=>o(e.BYTES),precompute(E=8,g=x.BASE){return g._setWindowSize(E),g.multiply(BigInt(3)),g}}}}var zi=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),nc=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),zm=BigInt(0),Jh=BigInt(1),Gi=BigInt(2),Qh=BigInt(5),sc=BigInt(10),td=BigInt(20),ed=BigInt(40),ic=BigInt(80);function rd(r){let t=zi,n=r*r%t*r%t,s=et(n,Gi,t)*n%t,i=et(s,Jh,t)*r%t,o=et(i,Qh,t)*i%t,a=et(o,sc,t)*o%t,c=et(a,td,t)*a%t,f=et(c,ed,t)*c%t,u=et(f,ic,t)*f%t,l=et(u,ic,t)*f%t,h=et(l,sc,t)*o%t;return{pow_p_5_8:et(h,Gi,t)*r%t,b2:n}}function nd(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}function sd(r,t){let e=zi,n=X(t*t*t,e),s=X(n*n*t,e),i=rd(r*s).pow_p_5_8,o=X(r*n*i,e),a=X(t*o*o,e),c=o,f=X(o*nc,e),u=a===r,l=a===X(-r,e),h=a===X(-r*nc,e);return u&&(o=c),(l||h)&&(o=f),Qa(o,e)&&(o=X(-o,e)),{isValid:u||l,value:o}}var ye=Ln(zi,void 0,!0),ji={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:ye,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:Tr,randomBytes:Br,adjustScalarBytes:nd,uvRatio:sd},Ir=Dn(ji);function oc(r,t,e){if(t.length>255)throw new Error("Context is too big");return Tn(Ui("SigEd25519 no Ed25519 collisions"),new Uint8Array([e?1:0,t.length]),t,r)}var jm=Dn({...ji,domain:oc}),Wm=Dn({...ji,domain:oc,prehash:Tr});var id=(ye.ORDER+BigInt(3))/BigInt(8),Ym=ye.pow(Gi,id),Zm=ye.sqrt(ye.neg(ye.ONE)),Xm=(ye.ORDER-BigInt(5))/BigInt(8),Jm=BigInt(486662);var Qm=tc(ye,ye.neg(BigInt(486664)));var tg=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),eg=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),rg=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),ng=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952");var sg=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");var kr=32,be=64,On=32;function ac(){let r=Ir.utils.randomPrivateKey(),t=Ir.getPublicKey(r);return{privateKey:fc(r,t),publicKey:t}}function cc(r){if(r.length!==On)throw new TypeError('"seed" must be 32 bytes in length.');if(!(r instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');let t=r,e=Ir.getPublicKey(t);return{privateKey:fc(t,e),publicKey:e}}function lc(r,t){let e=r.subarray(0,On);return Ir.sign(t instanceof Uint8Array?t:t.subarray(),e)}function uc(r,t,e){return Ir.verify(t,e instanceof Uint8Array?e:e.subarray(),r)}function fc(r,t){let e=new Uint8Array(be);for(let n=0;n<On;n++)e[n]=r[n],e[On+n]=t[n];return e}var Tt={get(r=globalThis){let t=r.crypto;if(t==null||t.subtle==null)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return t}};var Wi={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};function hc(r){let t=r?.algorithm??"AES-GCM",e=r?.keyLength??16,n=r?.nonceLength??12,s=r?.digest??"SHA-256",i=r?.saltLength??16,o=r?.iterations??32767,a=Tt.get();e*=8;async function c(l,h){let b=a.getRandomValues(new Uint8Array(i)),m=a.getRandomValues(new Uint8Array(n)),d={name:t,iv:m};typeof h=="string"&&(h=Q(h));let p;if(h.length===0){p=await a.subtle.importKey("jwk",Wi,{name:"AES-GCM"},!0,["encrypt"]);try{let A={name:"PBKDF2",salt:b,iterations:o,hash:{name:s}},w=await a.subtle.importKey("raw",h,{name:"PBKDF2"},!1,["deriveKey"]);p=await a.subtle.deriveKey(A,w,{name:t,length:e},!0,["encrypt"])}catch{p=await a.subtle.importKey("jwk",Wi,{name:"AES-GCM"},!0,["encrypt"])}}else{let A={name:"PBKDF2",salt:b,iterations:o,hash:{name:s}},w=await a.subtle.importKey("raw",h,{name:"PBKDF2"},!1,["deriveKey"]);p=await a.subtle.deriveKey(A,w,{name:t,length:e},!0,["encrypt"])}let y=await a.subtle.encrypt(d,p,l);return St([b,d.iv,new Uint8Array(y)])}async function f(l,h){let b=l.subarray(0,i),m=l.subarray(i,i+n),d=l.subarray(i+n),p={name:t,iv:m};typeof h=="string"&&(h=Q(h));let y;if(h.length===0)try{let w={name:"PBKDF2",salt:b,iterations:o,hash:{name:s}},_=await a.subtle.importKey("raw",h,{name:"PBKDF2"},!1,["deriveKey"]);y=await a.subtle.deriveKey(w,_,{name:t,length:e},!0,["decrypt"])}catch{y=await a.subtle.importKey("jwk",Wi,{name:"AES-GCM"},!0,["decrypt"])}else{let w={name:"PBKDF2",salt:b,iterations:o,hash:{name:s}},_=await a.subtle.importKey("raw",h,{name:"PBKDF2"},!1,["deriveKey"]);y=await a.subtle.deriveKey(w,_,{name:t,length:e},!0,["decrypt"])}let A=await a.subtle.decrypt(p,y,d);return new Uint8Array(A)}return{encrypt:c,decrypt:f}}async function Rr(r,t){let n=await hc().encrypt(r,t);return xi.encode(n)}var Yi=new Float32Array([-0]),He=new Uint8Array(Yi.buffer);function dc(r,t,e){Yi[0]=r,t[e]=He[0],t[e+1]=He[1],t[e+2]=He[2],t[e+3]=He[3]}function pc(r,t){return He[0]=r[t],He[1]=r[t+1],He[2]=r[t+2],He[3]=r[t+3],Yi[0]}var Zi=new Float64Array([-0]),Et=new Uint8Array(Zi.buffer);function mc(r,t,e){Zi[0]=r,t[e]=Et[0],t[e+1]=Et[1],t[e+2]=Et[2],t[e+3]=Et[3],t[e+4]=Et[4],t[e+5]=Et[5],t[e+6]=Et[6],t[e+7]=Et[7]}function gc(r,t){return Et[0]=r[t],Et[1]=r[t+1],Et[2]=r[t+2],Et[3]=r[t+3],Et[4]=r[t+4],Et[5]=r[t+5],Et[6]=r[t+6],Et[7]=r[t+7],Zi[0]}var cd=BigInt(Number.MAX_SAFE_INTEGER),ld=BigInt(Number.MIN_SAFE_INTEGER),_t=class r{lo;hi;constructor(t,e){this.lo=t|0,this.hi=e|0}toNumber(t=!1){if(!t&&this.hi>>>31>0){let e=~this.lo+1>>>0,n=~this.hi>>>0;return e===0&&(n=n+1>>>0),-(e+n*4294967296)}return this.lo+this.hi*4294967296}toBigInt(t=!1){if(t)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){let e=~this.lo+1>>>0,n=~this.hi>>>0;return e===0&&(n=n+1>>>0),-(BigInt(e)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(t=!1){return this.toBigInt(t).toString()}zzEncode(){let t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this}zzDecode(){let t=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this}length(){let t=this.lo,e=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?e===0?t<16384?t<128?1:2:t<2097152?3:4:e<16384?e<128?5:6:e<2097152?7:8:n<128?9:10}static fromBigInt(t){if(t===0n)return er;if(t<cd&&t>ld)return this.fromNumber(Number(t));let e=t<0n;e&&(t=-t);let n=t>>32n,s=t-(n<<32n);return e&&(n=~n|0n,s=~s|0n,++s>yc&&(s=0n,++n>yc&&(n=0n))),new r(Number(s),Number(n))}static fromNumber(t){if(t===0)return er;let e=t<0;e&&(t=-t);let n=t>>>0,s=(t-n)/4294967296>>>0;return e&&(s=~s>>>0,n=~n>>>0,++n>4294967295&&(n=0,++s>4294967295&&(s=0))),new r(n,s)}static from(t){return typeof t=="number"?r.fromNumber(t):typeof t=="bigint"?r.fromBigInt(t):typeof t=="string"?r.fromBigInt(BigInt(t)):t.low!=null||t.high!=null?new r(t.low>>>0,t.high>>>0):er}},er=new _t(0,0);er.toBigInt=function(){return 0n};er.zzEncode=er.zzDecode=function(){return this};er.length=function(){return 1};var yc=4294967296n;function bc(r){let t=0,e=0;for(let n=0;n<r.length;++n)e=r.charCodeAt(n),e<128?t+=1:e<2048?t+=2:(e&64512)===55296&&(r.charCodeAt(n+1)&64512)===56320?(++n,t+=4):t+=3;return t}function wc(r,t,e){if(e-t<1)return"";let s,i=[],o=0,a;for(;t<e;)a=r[t++],a<128?i[o++]=a:a>191&&a<224?i[o++]=(a&31)<<6|r[t++]&63:a>239&&a<365?(a=((a&7)<<18|(r[t++]&63)<<12|(r[t++]&63)<<6|r[t++]&63)-65536,i[o++]=55296+(a>>10),i[o++]=56320+(a&1023)):i[o++]=(a&15)<<12|(r[t++]&63)<<6|r[t++]&63,o>8191&&((s??(s=[])).push(String.fromCharCode.apply(String,i)),o=0);return s!=null?(o>0&&s.push(String.fromCharCode.apply(String,i.slice(0,o))),s.join("")):String.fromCharCode.apply(String,i.slice(0,o))}function Xi(r,t,e){let n=e,s,i;for(let o=0;o<r.length;++o)s=r.charCodeAt(o),s<128?t[e++]=s:s<2048?(t[e++]=s>>6|192,t[e++]=s&63|128):(s&64512)===55296&&((i=r.charCodeAt(o+1))&64512)===56320?(s=65536+((s&1023)<<10)+(i&1023),++o,t[e++]=s>>18|240,t[e++]=s>>12&63|128,t[e++]=s>>6&63|128,t[e++]=s&63|128):(t[e++]=s>>12|224,t[e++]=s>>6&63|128,t[e++]=s&63|128);return e-n}function Xt(r,t){return RangeError(`index out of range: ${r.pos} + ${t??1} > ${r.len}`)}function Pn(r,t){return(r[t-4]|r[t-3]<<8|r[t-2]<<16|r[t-1]<<24)>>>0}var Ji=class{buf;pos;len;_slice=Uint8Array.prototype.subarray;constructor(t){this.buf=t,this.pos=0,this.len=t.length}uint32(){let t=4294967295;if(t=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(t=(t|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return t;if((this.pos+=5)>this.len)throw this.pos=this.len,Xt(this,10);return t}int32(){return this.uint32()|0}sint32(){let t=this.uint32();return t>>>1^-(t&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw Xt(this,4);return Pn(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw Xt(this,4);return Pn(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw Xt(this,4);let t=pc(this.buf,this.pos);return this.pos+=4,t}double(){if(this.pos+8>this.len)throw Xt(this,4);let t=gc(this.buf,this.pos);return this.pos+=8,t}bytes(){let t=this.uint32(),e=this.pos,n=this.pos+t;if(n>this.len)throw Xt(this,t);return this.pos+=t,e===n?new Uint8Array(0):this.buf.subarray(e,n)}string(){let t=this.bytes();return wc(t,0,t.length)}skip(t){if(typeof t=="number"){if(this.pos+t>this.len)throw Xt(this,t);this.pos+=t}else do if(this.pos>=this.len)throw Xt(this);while(this.buf[this.pos++]&128);return this}skipType(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(t=this.uint32()&7)!==4;)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${t} at offset ${this.pos}`)}return this}readLongVarint(){let t=new _t(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(t.lo=(t.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(this.buf[this.pos]&127)<<28)>>>0,t.hi=(t.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return t;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw Xt(this);if(t.lo=(t.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,t}if(this.len-this.pos>4){for(;e<5;++e)if(t.hi=(t.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return t}else for(;e<5;++e){if(this.pos>=this.len)throw Xt(this);if(t.hi=(t.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw Xt(this,8);let t=Pn(this.buf,this.pos+=4),e=Pn(this.buf,this.pos+=4);return new _t(t,e)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){return this.readLongVarint().toNumber(!0)}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}};function Qi(r){return new Ji(r instanceof Uint8Array?r:r.subarray())}function Dt(r,t){let e=Qi(r);return t.decode(e)}function to(r){let t=r??8192,e=t>>>1,n,s=t;return function(o){if(o<1||o>e)return Nt(o);s+o>t&&(n=Nt(t),s=0);let a=n.subarray(s,s+=o);return s&7&&(s=(s|7)+1),a}}var rr=class{fn;len;next;val;constructor(t,e,n){this.fn=t,this.len=e,this.next=void 0,this.val=n}};function eo(){}var no=class{head;tail;len;next;constructor(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}},ud=to();function fd(r){return globalThis.Buffer!=null?Nt(r):ud(r)}var Qr=class{len;head;tail;states;constructor(){this.len=0,this.head=new rr(eo,0,0),this.tail=this.head,this.states=null}_push(t,e,n){return this.tail=this.tail.next=new rr(t,e,n),this.len+=e,this}uint32(t){return this.len+=(this.tail=this.tail.next=new so((t=t>>>0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this}int32(t){return t<0?this._push(Xr,10,_t.fromNumber(t)):this.uint32(t)}sint32(t){return this.uint32((t<<1^t>>31)>>>0)}uint64(t){let e=_t.fromBigInt(t);return this._push(Xr,e.length(),e)}uint64Number(t){let e=_t.fromNumber(t);return this._push(Xr,e.length(),e)}uint64String(t){return this.uint64(BigInt(t))}int64(t){return this.uint64(t)}int64Number(t){return this.uint64Number(t)}int64String(t){return this.uint64String(t)}sint64(t){let e=_t.fromBigInt(t).zzEncode();return this._push(Xr,e.length(),e)}sint64Number(t){let e=_t.fromNumber(t).zzEncode();return this._push(Xr,e.length(),e)}sint64String(t){return this.sint64(BigInt(t))}bool(t){return this._push(ro,1,t?1:0)}fixed32(t){return this._push(Jr,4,t>>>0)}sfixed32(t){return this.fixed32(t)}fixed64(t){let e=_t.fromBigInt(t);return this._push(Jr,4,e.lo)._push(Jr,4,e.hi)}fixed64Number(t){let e=_t.fromNumber(t);return this._push(Jr,4,e.lo)._push(Jr,4,e.hi)}fixed64String(t){return this.fixed64(BigInt(t))}sfixed64(t){return this.fixed64(t)}sfixed64Number(t){return this.fixed64Number(t)}sfixed64String(t){return this.fixed64String(t)}float(t){return this._push(dc,4,t)}double(t){return this._push(mc,8,t)}bytes(t){let e=t.length>>>0;return e===0?this._push(ro,1,0):this.uint32(e)._push(dd,e,t)}string(t){let e=bc(t);return e!==0?this.uint32(e)._push(Xi,e,t):this._push(ro,1,0)}fork(){return this.states=new no(this),this.head=this.tail=new rr(eo,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new rr(eo,0,0),this.len=0),this}ldelim(){let t=this.head,e=this.tail,n=this.len;return this.reset().uint32(n),n!==0&&(this.tail.next=t.next,this.tail=e,this.len+=n),this}finish(){let t=this.head.next,e=fd(this.len),n=0;for(;t!=null;)t.fn(t.val,e,n),n+=t.len,t=t.next;return e}};function ro(r,t,e){t[e]=r&255}function hd(r,t,e){for(;r>127;)t[e++]=r&127|128,r>>>=7;t[e]=r}var so=class extends rr{next;constructor(t,e){super(hd,t,e),this.next=void 0}};function Xr(r,t,e){for(;r.hi!==0;)t[e++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)t[e++]=r.lo&127|128,r.lo=r.lo>>>7;t[e++]=r.lo}function Jr(r,t,e){t[e]=r&255,t[e+1]=r>>>8&255,t[e+2]=r>>>16&255,t[e+3]=r>>>24}function dd(r,t,e){t.set(r,e)}globalThis.Buffer!=null&&(Qr.prototype.bytes=function(r){let t=r.length>>>0;return this.uint32(t),t>0&&this._push(pd,t,r),this},Qr.prototype.string=function(r){let t=globalThis.Buffer.byteLength(r);return this.uint32(t),t>0&&this._push(md,t,r),this});function pd(r,t,e){t.set(r,e)}function md(r,t,e){r.length<40?Xi(r,t,e):t.utf8Write!=null?t.utf8Write(r,e):t.set(Q(r),e)}function io(){return new Qr}function Ot(r,t){let e=io();return t.encode(r,e,{lengthDelimited:!1}),e.finish()}var Nr;(function(r){r[r.VARINT=0]="VARINT",r[r.BIT64=1]="BIT64",r[r.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",r[r.START_GROUP=3]="START_GROUP",r[r.END_GROUP=4]="END_GROUP",r[r.BIT32=5]="BIT32"})(Nr||(Nr={}));function Vn(r,t,e,n){return{name:r,type:t,encode:e,decode:n}}function nr(r){function t(s){if(r[s.toString()]==null)throw new Error("Invalid enum value");return r[s]}let e=function(i,o){let a=t(i);o.int32(a)},n=function(i){let o=i.int32();return t(o)};return Vn("enum",Nr.VARINT,e,n)}function Pt(r,t){return Vn("message",Nr.LENGTH_DELIMITED,r,t)}var rt;(function(r){r.RSA="RSA",r.Ed25519="Ed25519",r.Secp256k1="Secp256k1"})(rt||(rt={}));var oo;(function(r){r[r.RSA=0]="RSA",r[r.Ed25519=1]="Ed25519",r[r.Secp256k1=2]="Secp256k1"})(oo||(oo={}));(function(r){r.codec=()=>nr(oo)})(rt||(rt={}));var se;(function(r){let t;r.codec=()=>(t==null&&(t=Pt((e,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),e.Type!=null&&(n.uint32(8),rt.codec().encode(e.Type,n)),e.Data!=null&&(n.uint32(18),n.bytes(e.Data)),s.lengthDelimited!==!1&&n.ldelim()},(e,n)=>{let s={},i=n==null?e.len:e.pos+n;for(;e.pos<i;){let o=e.uint32();switch(o>>>3){case 1:s.Type=rt.codec().decode(e);break;case 2:s.Data=e.bytes();break;default:e.skipType(o&7);break}}return s})),t),r.encode=e=>Ot(e,r.codec()),r.decode=e=>Dt(e,r.codec())})(se||(se={}));var ie;(function(r){let t;r.codec=()=>(t==null&&(t=Pt((e,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),e.Type!=null&&(n.uint32(8),rt.codec().encode(e.Type,n)),e.Data!=null&&(n.uint32(18),n.bytes(e.Data)),s.lengthDelimited!==!1&&n.ldelim()},(e,n)=>{let s={},i=n==null?e.len:e.pos+n;for(;e.pos<i;){let o=e.uint32();switch(o>>>3){case 1:s.Type=rt.codec().decode(e);break;case 2:s.Data=e.bytes();break;default:e.skipType(o&7);break}}return s})),t),r.encode=e=>Ot(e,r.codec()),r.decode=e=>Dt(e,r.codec())})(ie||(ie={}));var tn=class{_key;constructor(t){this._key=_r(t,kr)}verify(t,e){return uc(this._key,e,t)}marshal(){return this._key}get bytes(){return se.encode({Type:rt.Ed25519,Data:this.marshal()}).subarray()}equals(t){return ut(this.bytes,t.bytes)}hash(){let t=pt.digest(this.bytes);return Ft(t)?t.then(({bytes:e})=>e):t.bytes}},sr=class{_key;_publicKey;constructor(t,e){this._key=_r(t,be),this._publicKey=_r(e,kr)}sign(t){return lc(this._key,t)}get public(){return new tn(this._publicKey)}marshal(){return this._key}get bytes(){return ie.encode({Type:rt.Ed25519,Data:this.marshal()}).subarray()}equals(t){return ut(this.bytes,t.bytes)}async hash(){let t=pt.digest(this.bytes),e;return Ft(t)?{bytes:e}=await t:e=t.bytes,e}async id(){let t=_e.digest(this.public.bytes);return dt.encode(t.bytes).substring(1)}async export(t,e="libp2p-key"){if(e==="libp2p-key")return Rr(this.bytes,t);throw new L(`export format '${e}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}};function gd(r){if(r.length>be){r=_r(r,be+kr);let n=r.subarray(0,be),s=r.subarray(be,r.length);return new sr(n,s)}r=_r(r,be);let t=r.subarray(0,be),e=r.subarray(kr);return new sr(t,e)}function yd(r){return r=_r(r,kr),new tn(r)}async function bd(){let{privateKey:r,publicKey:t}=ac();return new sr(r,t)}async function vc(r){let{privateKey:t,publicKey:e}=cc(r);return new sr(t,e)}function _r(r,t){if(r=Uint8Array.from(r??[]),r.length!==t)throw new L(`Key must be a Uint8Array of length ${t}, got ${r.length}`,"ERR_INVALID_KEY_TYPE");return r}function j(r,t="utf8"){let e=An[t];if(e==null)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):e.encoder.encode(r).substring(1)}var bo={};gt(bo,{MAX_RSA_KEY_SIZE:()=>dn,RsaPrivateKey:()=>Or,RsaPublicKey:()=>hn,fromJwk:()=>Gd,generateKeyPair:()=>zd,unmarshalRsaPrivateKey:()=>go,unmarshalRsaPublicKey:()=>$d});function ir(r){if(isNaN(r)||r<=0)throw new L("random bytes length must be a Number bigger than 0","ERR_INVALID_LENGTH");return Br(r)}var $e={};gt($e,{exportToPem:()=>Md,importFromPem:()=>Hd,jwkToPkcs1:()=>Dd,jwkToPkix:()=>Pd,pkcs1ToJwk:()=>Ud,pkixToJwk:()=>Od});var Hn=class extends Er{constructor(t,e){super(),this.finished=!1,this.destroyed=!1,Bn(t);let n=De(e);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let s=this.blockLen,i=new Uint8Array(s);i.set(n.length>s?t.create().update(n).digest():n);for(let o=0;o<i.length;o++)i[o]^=54;this.iHash.update(i),this.oHash=t.create();for(let o=0;o<i.length;o++)i[o]^=106;this.oHash.update(i),i.fill(0)}update(t){return vr(this),this.iHash.update(t),this}digestInto(t){vr(this),Ci(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){let t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));let{oHash:e,iHash:n,finished:s,destroyed:i,blockLen:o,outputLen:a}=this;return t=t,t.finished=s,t.destroyed=i,t.blockLen=o,t.outputLen=a,t.oHash=e._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},en=(r,t,e)=>new Hn(r,t).update(e).digest();en.create=(r,t)=>new Hn(r,t);function wd(r,t,e,n){Bn(r);let s=Ga({dkLen:32,asyncTick:10},n),{c:i,dkLen:o,asyncTick:a}=s;if(xr(i),xr(o),xr(a),i<1)throw new Error("PBKDF2: iterations (c) should be >= 1");let c=De(t),f=De(e),u=new Uint8Array(o),l=en.create(r,c),h=l._cloneInto().update(f);return{c:i,dkLen:o,asyncTick:a,DK:u,PRF:l,PRFSalt:h}}function xd(r,t,e,n,s){return r.destroy(),t.destroy(),n&&n.destroy(),s.fill(0),e}async function co(r,t,e,n){let{c:s,dkLen:i,asyncTick:o,DK:a,PRF:c,PRFSalt:f}=wd(r,t,e,n),u,l=new Uint8Array(4),h=Ar(l),b=new Uint8Array(c.outputLen);for(let m=1,d=0;d<i;m++,d+=c.outputLen){let p=a.subarray(d,d+c.outputLen);h.setInt32(0,m,!1),(u=f._cloneInto(u)).update(l).digestInto(b),p.set(b.subarray(0,p.length)),await $a(s-1,o,()=>{c._cloneInto(u).update(b).digestInto(b);for(let y=0;y<p.length;y++)p[y]^=b[y]})}return xd(c,f,a,u,b)}var K=ma(Ec());function or(r,t){let e=0;if(r.length===1)return r[0];for(let n=r.length-1;n>=0;n--)e+=r[r.length-1-n]*Math.pow(2,t*n);return e}function Fe(r,t,e=-1){let n=e,s=r,i=0,o=Math.pow(2,t);for(let a=1;a<8;a++){if(r<o){let c;if(n<0)c=new ArrayBuffer(a),i=a;else{if(n<a)return new ArrayBuffer(0);c=new ArrayBuffer(n),i=n}let f=new Uint8Array(c);for(let u=a-1;u>=0;u--){let l=Math.pow(2,u*t);f[i-u-1]=Math.floor(s/l),s-=f[i-u-1]*l}return c}o*=Math.pow(2,t)}return new ArrayBuffer(0)}function qn(...r){let t=0,e=0;for(let i of r)t+=i.length;let n=new ArrayBuffer(t),s=new Uint8Array(n);for(let i of r)s.set(i,e),e+=i.length;return s}function uo(){let r=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){let a=r[0]===255&&r[1]&128,c=r[0]===0&&(r[1]&128)===0;(a||c)&&this.warnings.push("Needlessly long format")}let t=new ArrayBuffer(this.valueHex.byteLength),e=new Uint8Array(t);for(let a=0;a<this.valueHex.byteLength;a++)e[a]=0;e[0]=r[0]&128;let n=or(e,8),s=new ArrayBuffer(this.valueHex.byteLength),i=new Uint8Array(s);for(let a=0;a<this.valueHex.byteLength;a++)i[a]=r[a];return i[0]&=127,or(i,8)-n}function Ac(r){let t=r<0?r*-1:r,e=128;for(let n=1;n<8;n++){if(t<=e){if(r<0){let o=e-t,a=Fe(o,8,n),c=new Uint8Array(a);return c[0]|=128,a}let s=Fe(t,8,n),i=new Uint8Array(s);if(i[0]&128){let o=s.slice(0),a=new Uint8Array(o);s=new ArrayBuffer(s.byteLength+1),i=new Uint8Array(s);for(let c=0;c<o.byteLength;c++)i[c+1]=a[c];i[0]=0}return s}e*=Math.pow(2,8)}return new ArrayBuffer(0)}function Bc(r,t){if(r.byteLength!==t.byteLength)return!1;let e=new Uint8Array(r),n=new Uint8Array(t);for(let s=0;s<e.length;s++)if(e[s]!==n[s])return!1;return!0}function Lt(r,t){let e=r.toString(10);if(t<e.length)return"";let n=t-e.length,s=new Array(n);for(let o=0;o<n;o++)s[o]="0";return s.join("").concat(e)}var ly=Math.log(2);function $n(){if(typeof BigInt>"u")throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function fo(r){let t=0,e=0;for(let s=0;s<r.length;s++){let i=r[s];t+=i.byteLength}let n=new Uint8Array(t);for(let s=0;s<r.length;s++){let i=r[s];n.set(new Uint8Array(i),e),e+=i.byteLength}return n.buffer}function Ae(r,t,e,n){return t instanceof Uint8Array?t.byteLength?e<0?(r.error="Wrong parameter: inputOffset less than zero",!1):n<0?(r.error="Wrong parameter: inputLength less than zero",!1):t.byteLength-e-n<0?(r.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):!0:(r.error="Wrong parameter: inputBuffer has zero length",!1):(r.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}var nn=class{constructor(){this.items=[]}write(t){this.items.push(t)}final(){return fo(this.items)}},rn=[new Uint8Array([1])],Sc="0123456789";var Ur="",Qt=new ArrayBuffer(0),ho=new Uint8Array(0),sn="EndOfContent",Ic="OCTET STRING",kc="BIT STRING";function Be(r){var t;return t=class extends r{constructor(...n){var s;super(...n);let i=n[0]||{};this.isHexOnly=(s=i.isHexOnly)!==null&&s!==void 0?s:!1,this.valueHexView=i.valueHex?K.BufferSourceConverter.toUint8Array(i.valueHex):ho}get valueHex(){return this.valueHexView.slice().buffer}set valueHex(n){this.valueHexView=new Uint8Array(n)}fromBER(n,s,i){let o=n instanceof ArrayBuffer?new Uint8Array(n):n;if(!Ae(this,o,s,i))return-1;let a=s+i;return this.valueHexView=o.subarray(s,a),this.valueHexView.length?(this.blockLength=i,a):(this.warnings.push("Zero buffer length"),s)}toBER(n=!1){return this.isHexOnly?n?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",Qt)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:K.Convert.ToHex(this.valueHexView)}}},t.NAME="hexBlock",t}var xe=class{constructor({blockLength:t=0,error:e=Ur,warnings:n=[],valueBeforeDecode:s=ho}={}){this.blockLength=t,this.error=e,this.warnings=n,this.valueBeforeDecodeView=K.BufferSourceConverter.toUint8Array(s)}static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(t){this.valueBeforeDecodeView=new Uint8Array(t)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:K.Convert.ToHex(this.valueBeforeDecodeView)}}};xe.NAME="baseBlock";var At=class extends xe{fromBER(t,e,n){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(t,e){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}};At.NAME="valueBlock";var Gn=class extends Be(xe){constructor({idBlock:t={}}={}){var e,n,s,i;super(),t?(this.isHexOnly=(e=t.isHexOnly)!==null&&e!==void 0?e:!1,this.valueHexView=t.valueHex?K.BufferSourceConverter.toUint8Array(t.valueHex):ho,this.tagClass=(n=t.tagClass)!==null&&n!==void 0?n:-1,this.tagNumber=(s=t.tagNumber)!==null&&s!==void 0?s:-1,this.isConstructed=(i=t.isConstructed)!==null&&i!==void 0?i:!1):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(t=!1){let e=0;switch(this.tagClass){case 1:e|=0;break;case 2:e|=64;break;case 3:e|=128;break;case 4:e|=192;break;default:return this.error="Unknown tag class",Qt}if(this.isConstructed&&(e|=32),this.tagNumber<31&&!this.isHexOnly){let s=new Uint8Array(1);if(!t){let i=this.tagNumber;i&=31,e|=i,s[0]=e}return s.buffer}if(!this.isHexOnly){let s=Fe(this.tagNumber,7),i=new Uint8Array(s),o=s.byteLength,a=new Uint8Array(o+1);if(a[0]=e|31,!t){for(let c=0;c<o-1;c++)a[c+1]=i[c]|128;a[o]=i[o-1]}return a.buffer}let n=new Uint8Array(this.valueHexView.byteLength+1);if(n[0]=e|31,!t){let s=this.valueHexView;for(let i=0;i<s.length-1;i++)n[i+1]=s[i]|128;n[this.valueHexView.byteLength]=s[s.length-1]}return n.buffer}fromBER(t,e,n){let s=K.BufferSourceConverter.toUint8Array(t);if(!Ae(this,s,e,n))return-1;let i=s.subarray(e,e+n);if(i.length===0)return this.error="Zero buffer length",-1;switch(i[0]&192){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=(i[0]&32)===32,this.isHexOnly=!1;let a=i[0]&31;if(a!==31)this.tagNumber=a,this.blockLength=1;else{let c=1,f=this.valueHexView=new Uint8Array(255),u=255;for(;i[c]&128;){if(f[c-1]=i[c]&127,c++,c>=i.length)return this.error="End of input reached before message was fully decoded",-1;if(c===u){u+=255;let h=new Uint8Array(u);for(let b=0;b<f.length;b++)h[b]=f[b];f=this.valueHexView=new Uint8Array(u)}}this.blockLength=c+1,f[c-1]=i[c]&127;let l=new Uint8Array(c);for(let h=0;h<c;h++)l[h]=f[h];f=this.valueHexView=new Uint8Array(c),f.set(l),this.blockLength<=9?this.tagNumber=or(f,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(this.tagClass===1&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return e+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}};Gn.NAME="identificationBlock";var zn=class extends xe{constructor({lenBlock:t={}}={}){var e,n,s;super(),this.isIndefiniteForm=(e=t.isIndefiniteForm)!==null&&e!==void 0?e:!1,this.longFormUsed=(n=t.longFormUsed)!==null&&n!==void 0?n:!1,this.length=(s=t.length)!==null&&s!==void 0?s:0}fromBER(t,e,n){let s=K.BufferSourceConverter.toUint8Array(t);if(!Ae(this,s,e,n))return-1;let i=s.subarray(e,e+n);if(i.length===0)return this.error="Zero buffer length",-1;if(i[0]===255)return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=i[0]===128,this.isIndefiniteForm)return this.blockLength=1,e+this.blockLength;if(this.longFormUsed=!!(i[0]&128),this.longFormUsed===!1)return this.length=i[0],this.blockLength=1,e+this.blockLength;let o=i[0]&127;if(o>8)return this.error="Too big integer",-1;if(o+1>i.length)return this.error="End of input reached before message was fully decoded",-1;let a=e+1,c=s.subarray(a,a+o);return c[o-1]===0&&this.warnings.push("Needlessly long encoded length"),this.length=or(c,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=o+1,e+this.blockLength}toBER(t=!1){let e,n;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return e=new ArrayBuffer(1),t===!1&&(n=new Uint8Array(e),n[0]=128),e;if(this.longFormUsed){let s=Fe(this.length,8);if(s.byteLength>127)return this.error="Too big length",Qt;if(e=new ArrayBuffer(s.byteLength+1),t)return e;let i=new Uint8Array(s);n=new Uint8Array(e),n[0]=s.byteLength|128;for(let o=0;o<s.byteLength;o++)n[o+1]=i[o];return e}return e=new ArrayBuffer(1),t===!1&&(n=new Uint8Array(e),n[0]=this.length),e}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}};zn.NAME="lengthBlock";var T={},xt=class extends xe{constructor({name:t=Ur,optional:e=!1,primitiveSchema:n,...s}={},i){super(s),this.name=t,this.optional=e,n&&(this.primitiveSchema=n),this.idBlock=new Gn(s),this.lenBlock=new zn(s),this.valueBlock=i?new i(s):new At(s)}fromBER(t,e,n){let s=this.valueBlock.fromBER(t,e,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return s===-1?(this.error=this.valueBlock.error,s):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),s)}toBER(t,e){let n=e||new nn;e||Rc(this);let s=this.idBlock.toBER(t);if(n.write(s),this.lenBlock.isIndefiniteForm)n.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(t,n),n.write(new ArrayBuffer(2));else{let i=this.valueBlock.toBER(t);this.lenBlock.length=i.byteLength;let o=this.lenBlock.toBER(t);n.write(o),n.write(i)}return e?Qt:n.final()}toJSON(){let t={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(t.primitiveSchema=this.primitiveSchema.toJSON()),t}toString(t="ascii"){return t==="ascii"?this.onAsciiEncoding():K.Convert.ToHex(this.toBER())}onAsciiEncoding(){return`${this.constructor.NAME} : ${K.Convert.ToHex(this.valueBlock.valueBeforeDecodeView)}`}isEqual(t){if(this===t)return!0;if(!(t instanceof this.constructor))return!1;let e=this.toBER(),n=t.toBER();return Bc(e,n)}};xt.NAME="BaseBlock";function Rc(r){if(r instanceof T.Constructed)for(let t of r.valueBlock.value)Rc(t)&&(r.lenBlock.isIndefiniteForm=!0);return!!r.lenBlock.isIndefiniteForm}var jn=class extends xt{constructor({value:t=Ur,...e}={},n){super(e,n),t&&this.fromString(t)}getValue(){return this.valueBlock.value}setValue(t){this.valueBlock.value=t}fromBER(t,e,n){let s=this.valueBlock.fromBER(t,e,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return s===-1?(this.error=this.valueBlock.error,s):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),s)}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}};jn.NAME="BaseStringBlock";var Wn=class extends Be(At){constructor({isHexOnly:t=!0,...e}={}){super(e),this.isHexOnly=t}};Wn.NAME="PrimitiveValueBlock";var Nc,Yn=class extends xt{constructor(t={}){super(t,Wn),this.idBlock.isConstructed=!1}};Nc=Yn;T.Primitive=Nc;Yn.NAME="PRIMITIVE";function Rd(r,t){if(r instanceof t)return r;let e=new t;return e.idBlock=r.idBlock,e.lenBlock=r.lenBlock,e.warnings=r.warnings,e.valueBeforeDecodeView=r.valueBeforeDecodeView,e}function ks(r,t=0,e=r.length){let n=t,s=new xt({},At),i=new xe;if(!Ae(i,r,t,e))return s.error=i.error,{offset:-1,result:s};if(!r.subarray(t,t+e).length)return s.error="Zero buffer length",{offset:-1,result:s};let a=s.idBlock.fromBER(r,t,e);if(s.idBlock.warnings.length&&s.warnings.concat(s.idBlock.warnings),a===-1)return s.error=s.idBlock.error,{offset:-1,result:s};if(t=a,e-=s.idBlock.blockLength,a=s.lenBlock.fromBER(r,t,e),s.lenBlock.warnings.length&&s.warnings.concat(s.lenBlock.warnings),a===-1)return s.error=s.lenBlock.error,{offset:-1,result:s};if(t=a,e-=s.lenBlock.blockLength,!s.idBlock.isConstructed&&s.lenBlock.isIndefiniteForm)return s.error="Indefinite length form used for primitive encoding form",{offset:-1,result:s};let c=xt;switch(s.idBlock.tagClass){case 1:if(s.idBlock.tagNumber>=37&&s.idBlock.isHexOnly===!1)return s.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:s};switch(s.idBlock.tagNumber){case 0:if(s.idBlock.isConstructed&&s.lenBlock.length>0)return s.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:s};c=T.EndOfContent;break;case 1:c=T.Boolean;break;case 2:c=T.Integer;break;case 3:c=T.BitString;break;case 4:c=T.OctetString;break;case 5:c=T.Null;break;case 6:c=T.ObjectIdentifier;break;case 10:c=T.Enumerated;break;case 12:c=T.Utf8String;break;case 13:c=T.RelativeObjectIdentifier;break;case 14:c=T.TIME;break;case 15:return s.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:s};case 16:c=T.Sequence;break;case 17:c=T.Set;break;case 18:c=T.NumericString;break;case 19:c=T.PrintableString;break;case 20:c=T.TeletexString;break;case 21:c=T.VideotexString;break;case 22:c=T.IA5String;break;case 23:c=T.UTCTime;break;case 24:c=T.GeneralizedTime;break;case 25:c=T.GraphicString;break;case 26:c=T.VisibleString;break;case 27:c=T.GeneralString;break;case 28:c=T.UniversalString;break;case 29:c=T.CharacterString;break;case 30:c=T.BmpString;break;case 31:c=T.DATE;break;case 32:c=T.TimeOfDay;break;case 33:c=T.DateTime;break;case 34:c=T.Duration;break;default:{let f=s.idBlock.isConstructed?new T.Constructed:new T.Primitive;f.idBlock=s.idBlock,f.lenBlock=s.lenBlock,f.warnings=s.warnings,s=f}}break;case 2:case 3:case 4:default:c=s.idBlock.isConstructed?T.Constructed:T.Primitive}return s=Rd(s,c),a=s.fromBER(r,t,s.lenBlock.isIndefiniteForm?e:s.lenBlock.length),s.valueBeforeDecodeView=r.subarray(n,n+s.blockLength),{offset:a,result:s}}function Dr(r){if(!r.byteLength){let t=new xt({},At);return t.error="Input buffer has zero length",{offset:-1,result:t}}return ks(K.BufferSourceConverter.toUint8Array(r).slice(),0,r.byteLength)}function Nd(r,t){return r?1:t}var oe=class extends At{constructor({value:t=[],isIndefiniteForm:e=!1,...n}={}){super(n),this.value=t,this.isIndefiniteForm=e}fromBER(t,e,n){let s=K.BufferSourceConverter.toUint8Array(t);if(!Ae(this,s,e,n))return-1;if(this.valueBeforeDecodeView=s.subarray(e,e+n),this.valueBeforeDecodeView.length===0)return this.warnings.push("Zero buffer length"),e;let i=e;for(;Nd(this.isIndefiniteForm,n)>0;){let o=ks(s,i,n);if(o.offset===-1)return this.error=o.result.error,this.warnings.concat(o.result.warnings),-1;if(i=o.offset,this.blockLength+=o.result.blockLength,n-=o.result.blockLength,this.value.push(o.result),this.isIndefiniteForm&&o.result.constructor.NAME===sn)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===sn?this.value.pop():this.warnings.push("No EndOfContent block encoded")),i}toBER(t,e){let n=e||new nn;for(let s=0;s<this.value.length;s++)this.value[s].toBER(t,n);return e?Qt:n.final()}toJSON(){let t={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(let e of this.value)t.value.push(e.toJSON());return t}};oe.NAME="ConstructedValueBlock";var _c,Ke=class extends xt{constructor(t={}){super(t,oe),this.idBlock.isConstructed=!0}fromBER(t,e,n){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;let s=this.valueBlock.fromBER(t,e,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return s===-1?(this.error=this.valueBlock.error,s):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),s)}onAsciiEncoding(){let t=[];for(let n of this.valueBlock.value)t.push(n.toString("ascii").split(`
`).map(s=>`  ${s}`).join(`
`));let e=this.idBlock.tagClass===3?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return t.length?`${e} :
${t.join(`
`)}`:`${e} :`}};_c=Ke;T.Constructed=_c;Ke.NAME="CONSTRUCTED";var Zn=class extends At{fromBER(t,e,n){return e}toBER(t){return Qt}};Zn.override="EndOfContentValueBlock";var Lc,Xn=class extends xt{constructor(t={}){super(t,Zn),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}};Lc=Xn;T.EndOfContent=Lc;Xn.NAME=sn;var Cc,qe=class extends xt{constructor(t={}){super(t,At),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(t,e,n){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=n,e+n>t.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):e+n}toBER(t,e){let n=new ArrayBuffer(2);if(!t){let s=new Uint8Array(n);s[0]=5,s[1]=0}return e&&e.write(n),n}onAsciiEncoding(){return`${this.constructor.NAME}`}};Cc=qe;T.Null=Cc;qe.NAME="NULL";var Jn=class extends Be(At){constructor({value:t,...e}={}){super(e),e.valueHex?this.valueHexView=K.BufferSourceConverter.toUint8Array(e.valueHex):this.valueHexView=new Uint8Array(1),t&&(this.value=t)}get value(){for(let t of this.valueHexView)if(t>0)return!0;return!1}set value(t){this.valueHexView[0]=t?255:0}fromBER(t,e,n){let s=K.BufferSourceConverter.toUint8Array(t);return Ae(this,s,e,n)?(this.valueHexView=s.subarray(e,e+n),n>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,uo.call(this),this.blockLength=n,e+n):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}};Jn.NAME="BooleanValueBlock";var Uc,Qn=class extends xt{constructor(t={}){super(t,Jn),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}getValue(){return this.valueBlock.value}setValue(t){this.valueBlock.value=t}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}};Uc=Qn;T.Boolean=Uc;Qn.NAME="BOOLEAN";var ts=class extends Be(oe){constructor({isConstructed:t=!1,...e}={}){super(e),this.isConstructed=t}fromBER(t,e,n){let s=0;if(this.isConstructed){if(this.isHexOnly=!1,s=oe.prototype.fromBER.call(this,t,e,n),s===-1)return s;for(let i=0;i<this.value.length;i++){let o=this.value[i].constructor.NAME;if(o===sn){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(o!==Ic)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,s=super.fromBER(t,e,n),this.blockLength=n;return s}toBER(t,e){return this.isConstructed?oe.prototype.toBER.call(this,t,e):t?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}};ts.NAME="OctetStringValueBlock";var Dc,ve=class r extends xt{constructor({idBlock:t={},lenBlock:e={},...n}={}){var s,i;(s=n.isConstructed)!==null&&s!==void 0||(n.isConstructed=!!(!((i=n.value)===null||i===void 0)&&i.length)),super({idBlock:{isConstructed:n.isConstructed,...t},lenBlock:{...e,isIndefiniteForm:!!n.isIndefiniteForm},...n},ts),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(t,e,n){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,n===0)return this.idBlock.error.length===0&&(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length===0&&(this.blockLength+=this.lenBlock.blockLength),e;if(!this.valueBlock.isConstructed){let i=(t instanceof ArrayBuffer?new Uint8Array(t):t).subarray(e,e+n);try{if(i.byteLength){let o=ks(i,0,i.byteLength);o.offset!==-1&&o.offset===n&&(this.valueBlock.value=[o.result])}}catch{}}return super.fromBER(t,e,n)}onAsciiEncoding(){return this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length?Ke.prototype.onAsciiEncoding.call(this):`${this.constructor.NAME} : ${K.Convert.ToHex(this.valueBlock.valueHexView)}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;let t=[];for(let e of this.valueBlock.value)e instanceof r&&t.push(e.valueBlock.valueHexView);return K.BufferSourceConverter.concat(t)}};Dc=ve;T.OctetString=Dc;ve.NAME=Ic;var es=class extends Be(oe){constructor({unusedBits:t=0,isConstructed:e=!1,...n}={}){super(n),this.unusedBits=t,this.isConstructed=e,this.blockLength=this.valueHexView.byteLength}fromBER(t,e,n){if(!n)return e;let s=-1;if(this.isConstructed){if(s=oe.prototype.fromBER.call(this,t,e,n),s===-1)return s;for(let a of this.value){let c=a.constructor.NAME;if(c===sn){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(c!==kc)return this.error="BIT STRING may consists of BIT STRINGs only",-1;let f=a.valueBlock;if(this.unusedBits>0&&f.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=f.unusedBits}return s}let i=K.BufferSourceConverter.toUint8Array(t);if(!Ae(this,i,e,n))return-1;let o=i.subarray(e,e+n);if(this.unusedBits=o[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){let a=o.subarray(1);try{if(a.byteLength){let c=ks(a,0,a.byteLength);c.offset!==-1&&c.offset===n-1&&(this.value=[c.result])}}catch{}}return this.valueHexView=o.subarray(1),this.blockLength=o.length,e+n}toBER(t,e){if(this.isConstructed)return oe.prototype.toBER.call(this,t,e);if(t)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return Qt;let n=new Uint8Array(this.valueHexView.length+1);return n[0]=this.unusedBits,n.set(this.valueHexView,1),n.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}};es.NAME="BitStringValueBlock";var Oc,Cr=class extends xt{constructor({idBlock:t={},lenBlock:e={},...n}={}){var s,i;(s=n.isConstructed)!==null&&s!==void 0||(n.isConstructed=!!(!((i=n.value)===null||i===void 0)&&i.length)),super({idBlock:{isConstructed:n.isConstructed,...t},lenBlock:{...e,isIndefiniteForm:!!n.isIndefiniteForm},...n},es),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(t,e,n){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(t,e,n)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return Ke.prototype.onAsciiEncoding.call(this);{let t=[],e=this.valueBlock.valueHexView;for(let s of e)t.push(s.toString(2).padStart(8,"0"));let n=t.join("");return`${this.constructor.NAME} : ${n.substring(0,n.length-this.valueBlock.unusedBits)}`}}};Oc=Cr;T.BitString=Oc;Cr.NAME=kc;var Pc;function _d(r,t){let e=new Uint8Array([0]),n=new Uint8Array(r),s=new Uint8Array(t),i=n.slice(0),o=i.length-1,a=s.slice(0),c=a.length-1,f=0,u=c<o?o:c,l=0;for(let h=u;h>=0;h--,l++){switch(!0){case l<a.length:f=i[o-l]+a[c-l]+e[0];break;default:f=i[o-l]+e[0]}switch(e[0]=f/10,!0){case l>=i.length:i=qn(new Uint8Array([f%10]),i);break;default:i[o-l]=f%10}}return e[0]>0&&(i=qn(e,i)),i}function Tc(r){if(r>=rn.length)for(let t=rn.length;t<=r;t++){let e=new Uint8Array([0]),n=rn[t-1].slice(0);for(let s=n.length-1;s>=0;s--){let i=new Uint8Array([(n[s]<<1)+e[0]]);e[0]=i[0]/10,n[s]=i[0]%10}e[0]>0&&(n=qn(e,n)),rn.push(n)}return rn[r]}function Ld(r,t){let e=0,n=new Uint8Array(r),s=new Uint8Array(t),i=n.slice(0),o=i.length-1,a=s.slice(0),c=a.length-1,f,u=0;for(let l=c;l>=0;l--,u++)switch(f=i[o-u]-a[c-u]-e,!0){case f<0:e=1,i[o-u]=f+10;break;default:e=0,i[o-u]=f}if(e>0)for(let l=o-c+1;l>=0;l--,u++)if(f=i[o-u]-e,f<0)e=1,i[o-u]=f+10;else{e=0,i[o-u]=f;break}return i.slice()}var on=class extends Be(At){constructor({value:t,...e}={}){super(e),this._valueDec=0,e.valueHex&&this.setValueHex(),t!==void 0&&(this.valueDec=t)}setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=uo.call(this)))}set valueDec(t){this._valueDec=t,this.isHexOnly=!1,this.valueHexView=new Uint8Array(Ac(t))}get valueDec(){return this._valueDec}fromDER(t,e,n,s=0){let i=this.fromBER(t,e,n);if(i===-1)return i;let o=this.valueHexView;return o[0]===0&&o[1]&128?this.valueHexView=o.subarray(1):s!==0&&o.length<s&&(s-o.length>1&&(s=o.length+1),this.valueHexView=o.subarray(s-o.length)),i}toDER(t=!1){let e=this.valueHexView;switch(!0){case(e[0]&128)!==0:{let n=new Uint8Array(this.valueHexView.length+1);n[0]=0,n.set(e,1),this.valueHexView=n}break;case(e[0]===0&&(e[1]&128)===0):this.valueHexView=this.valueHexView.subarray(1);break}return this.toBER(t)}fromBER(t,e,n){let s=super.fromBER(t,e,n);return s===-1||this.setValueHex(),s}toBER(t){return t?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){let t=this.valueHexView.length*8-1,e=new Uint8Array(this.valueHexView.length*8/3),n=0,s,i=this.valueHexView,o="",a=!1;for(let c=i.byteLength-1;c>=0;c--){s=i[c];for(let f=0;f<8;f++){if((s&1)===1)switch(n){case t:e=Ld(Tc(n),e),o="-";break;default:e=_d(e,Tc(n))}n++,s>>=1}}for(let c=0;c<e.length;c++)e[c]&&(a=!0),a&&(o+=Sc.charAt(e[c]));return a===!1&&(o+=Sc.charAt(0)),o}};Pc=on;on.NAME="IntegerValueBlock";Object.defineProperty(Pc.prototype,"valueHex",{set:function(r){this.valueHexView=new Uint8Array(r),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});var Vc,ft=class r extends xt{constructor(t={}){super(t,on),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return $n(),BigInt(this.valueBlock.toString())}static fromBigInt(t){$n();let e=BigInt(t),n=new nn,s=e.toString(16).replace(/^-/,""),i=new Uint8Array(K.Convert.FromHex(s));if(e<0){let a=new Uint8Array(i.length+(i[0]&128?1:0));a[0]|=128;let f=BigInt(`0x${K.Convert.ToHex(a)}`)+e,u=K.BufferSourceConverter.toUint8Array(K.Convert.FromHex(f.toString(16)));u[0]|=128,n.write(u)}else i[0]&128&&n.write(new Uint8Array([0])),n.write(i);return new r({valueHex:n.final()})}convertToDER(){let t=new r({valueHex:this.valueBlock.valueHexView});return t.valueBlock.toDER(),t}convertFromDER(){return new r({valueHex:this.valueBlock.valueHexView[0]===0?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}};Vc=ft;T.Integer=Vc;ft.NAME="INTEGER";var Mc,rs=class extends ft{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}};Mc=rs;T.Enumerated=Mc;rs.NAME="ENUMERATED";var an=class extends Be(At){constructor({valueDec:t=-1,isFirstSid:e=!1,...n}={}){super(n),this.valueDec=t,this.isFirstSid=e}fromBER(t,e,n){if(!n)return e;let s=K.BufferSourceConverter.toUint8Array(t);if(!Ae(this,s,e,n))return-1;let i=s.subarray(e,e+n);this.valueHexView=new Uint8Array(n);for(let a=0;a<n&&(this.valueHexView[a]=i[a]&127,this.blockLength++,!!(i[a]&128));a++);let o=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)o[a]=this.valueHexView[a];return this.valueHexView=o,i[this.blockLength-1]&128?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=or(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),e+this.blockLength)}set valueBigInt(t){$n();let e=BigInt(t).toString(2);for(;e.length%7;)e="0"+e;let n=new Uint8Array(e.length/7);for(let s=0;s<n.length;s++)n[s]=parseInt(e.slice(s*7,s*7+7),2)+(s+1<n.length?128:0);this.fromBER(n.buffer,0,n.length)}toBER(t){if(this.isHexOnly){if(t)return new ArrayBuffer(this.valueHexView.byteLength);let s=this.valueHexView,i=new Uint8Array(this.blockLength);for(let o=0;o<this.blockLength-1;o++)i[o]=s[o]|128;return i[this.blockLength-1]=s[this.blockLength-1],i.buffer}let e=Fe(this.valueDec,7);if(e.byteLength===0)return this.error="Error during encoding SID value",Qt;let n=new Uint8Array(e.byteLength);if(!t){let s=new Uint8Array(e),i=e.byteLength-1;for(let o=0;o<i;o++)n[o]=s[o]|128;n[i]=s[i]}return n}toString(){let t="";if(this.isHexOnly)t=K.Convert.ToHex(this.valueHexView);else if(this.isFirstSid){let e=this.valueDec;this.valueDec<=39?t="0.":this.valueDec<=79?(t="1.",e-=40):(t="2.",e-=80),t+=e.toString()}else t=this.valueDec.toString();return t}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}};an.NAME="sidBlock";var ns=class extends At{constructor({value:t=Ur,...e}={}){super(e),this.value=[],t&&this.fromString(t)}fromBER(t,e,n){let s=e;for(;n>0;){let i=new an;if(s=i.fromBER(t,s,n),s===-1)return this.blockLength=0,this.error=i.error,s;this.value.length===0&&(i.isFirstSid=!0),this.blockLength+=i.blockLength,n-=i.blockLength,this.value.push(i)}return s}toBER(t){let e=[];for(let n=0;n<this.value.length;n++){let s=this.value[n].toBER(t);if(s.byteLength===0)return this.error=this.value[n].error,Qt;e.push(s)}return fo(e)}fromString(t){this.value=[];let e=0,n=0,s="",i=!1;do if(n=t.indexOf(".",e),n===-1?s=t.substring(e):s=t.substring(e,n),e=n+1,i){let o=this.value[0],a=0;switch(o.valueDec){case 0:break;case 1:a=40;break;case 2:a=80;break;default:this.value=[];return}let c=parseInt(s,10);if(isNaN(c))return;o.valueDec=c+a,i=!1}else{let o=new an;if(s>Number.MAX_SAFE_INTEGER){$n();let a=BigInt(s);o.valueBigInt=a}else if(o.valueDec=parseInt(s,10),isNaN(o.valueDec))return;this.value.length||(o.isFirstSid=!0,i=!0),this.value.push(o)}while(n!==-1)}toString(){let t="",e=!1;for(let n=0;n<this.value.length;n++){e=this.value[n].isHexOnly;let s=this.value[n].toString();n!==0&&(t=`${t}.`),e?(s=`{${s}}`,this.value[n].isFirstSid?t=`2.{${s} - 80}`:t+=s):t+=s}return t}toJSON(){let t={...super.toJSON(),value:this.toString(),sidArray:[]};for(let e=0;e<this.value.length;e++)t.sidArray.push(this.value[e].toJSON());return t}};ns.NAME="ObjectIdentifierValueBlock";var Hc,Jt=class extends xt{constructor(t={}){super(t,ns),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}getValue(){return this.valueBlock.toString()}setValue(t){this.valueBlock.fromString(t)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}};Hc=Jt;T.ObjectIdentifier=Hc;Jt.NAME="OBJECT IDENTIFIER";var cn=class extends Be(xe){constructor({valueDec:t=0,...e}={}){super(e),this.valueDec=t}fromBER(t,e,n){if(n===0)return e;let s=K.BufferSourceConverter.toUint8Array(t);if(!Ae(this,s,e,n))return-1;let i=s.subarray(e,e+n);this.valueHexView=new Uint8Array(n);for(let a=0;a<n&&(this.valueHexView[a]=i[a]&127,this.blockLength++,!!(i[a]&128));a++);let o=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)o[a]=this.valueHexView[a];return this.valueHexView=o,i[this.blockLength-1]&128?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=or(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),e+this.blockLength)}toBER(t){if(this.isHexOnly){if(t)return new ArrayBuffer(this.valueHexView.byteLength);let s=this.valueHexView,i=new Uint8Array(this.blockLength);for(let o=0;o<this.blockLength-1;o++)i[o]=s[o]|128;return i[this.blockLength-1]=s[this.blockLength-1],i.buffer}let e=Fe(this.valueDec,7);if(e.byteLength===0)return this.error="Error during encoding SID value",Qt;let n=new Uint8Array(e.byteLength);if(!t){let s=new Uint8Array(e),i=e.byteLength-1;for(let o=0;o<i;o++)n[o]=s[o]|128;n[i]=s[i]}return n.buffer}toString(){let t="";return this.isHexOnly?t=K.Convert.ToHex(this.valueHexView):t=this.valueDec.toString(),t}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}};cn.NAME="relativeSidBlock";var ss=class extends At{constructor({value:t=Ur,...e}={}){super(e),this.value=[],t&&this.fromString(t)}fromBER(t,e,n){let s=e;for(;n>0;){let i=new cn;if(s=i.fromBER(t,s,n),s===-1)return this.blockLength=0,this.error=i.error,s;this.blockLength+=i.blockLength,n-=i.blockLength,this.value.push(i)}return s}toBER(t,e){let n=[];for(let s=0;s<this.value.length;s++){let i=this.value[s].toBER(t);if(i.byteLength===0)return this.error=this.value[s].error,Qt;n.push(i)}return fo(n)}fromString(t){this.value=[];let e=0,n=0,s="";do{n=t.indexOf(".",e),n===-1?s=t.substring(e):s=t.substring(e,n),e=n+1;let i=new cn;if(i.valueDec=parseInt(s,10),isNaN(i.valueDec))return!0;this.value.push(i)}while(n!==-1);return!0}toString(){let t="",e=!1;for(let n=0;n<this.value.length;n++){e=this.value[n].isHexOnly;let s=this.value[n].toString();n!==0&&(t=`${t}.`),e&&(s=`{${s}}`),t+=s}return t}toJSON(){let t={...super.toJSON(),value:this.toString(),sidArray:[]};for(let e=0;e<this.value.length;e++)t.sidArray.push(this.value[e].toJSON());return t}};ss.NAME="RelativeObjectIdentifierValueBlock";var Fc,is=class extends xt{constructor(t={}){super(t,ss),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}getValue(){return this.valueBlock.toString()}setValue(t){this.valueBlock.fromString(t)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}};Fc=is;T.RelativeObjectIdentifier=Fc;is.NAME="RelativeObjectIdentifier";var Kc,yt=class extends Ke{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}};Kc=yt;T.Sequence=Kc;yt.NAME="SEQUENCE";var qc,os=class extends Ke{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}};qc=os;T.Set=qc;os.NAME="SET";var as=class extends Be(At){constructor({...t}={}){super(t),this.isHexOnly=!0,this.value=Ur}toJSON(){return{...super.toJSON(),value:this.value}}};as.NAME="StringValueBlock";var cs=class extends as{};cs.NAME="SimpleStringValueBlock";var It=class extends jn{constructor({...t}={}){super(t,cs)}fromBuffer(t){this.valueBlock.value=String.fromCharCode.apply(null,K.BufferSourceConverter.toUint8Array(t))}fromString(t){let e=t.length,n=this.valueBlock.valueHexView=new Uint8Array(e);for(let s=0;s<e;s++)n[s]=t.charCodeAt(s);this.valueBlock.value=t}};It.NAME="SIMPLE STRING";var ls=class extends It{fromBuffer(t){this.valueBlock.valueHexView=K.BufferSourceConverter.toUint8Array(t);try{this.valueBlock.value=K.Convert.ToUtf8String(t)}catch(e){this.warnings.push(`Error during "decodeURIComponent": ${e}, using raw string`),this.valueBlock.value=K.Convert.ToBinary(t)}}fromString(t){this.valueBlock.valueHexView=new Uint8Array(K.Convert.FromUtf8String(t)),this.valueBlock.value=t}};ls.NAME="Utf8StringValueBlock";var $c,Ee=class extends ls{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}};$c=Ee;T.Utf8String=$c;Ee.NAME="UTF8String";var us=class extends It{fromBuffer(t){this.valueBlock.value=K.Convert.ToUtf16String(t),this.valueBlock.valueHexView=K.BufferSourceConverter.toUint8Array(t)}fromString(t){this.valueBlock.value=t,this.valueBlock.valueHexView=new Uint8Array(K.Convert.FromUtf16String(t))}};us.NAME="BmpStringValueBlock";var Gc,fs=class extends us{constructor({...t}={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}};Gc=fs;T.BmpString=Gc;fs.NAME="BMPString";var hs=class extends It{fromBuffer(t){let e=ArrayBuffer.isView(t)?t.slice().buffer:t.slice(0),n=new Uint8Array(e);for(let s=0;s<n.length;s+=4)n[s]=n[s+3],n[s+1]=n[s+2],n[s+2]=0,n[s+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(e))}fromString(t){let e=t.length,n=this.valueBlock.valueHexView=new Uint8Array(e*4);for(let s=0;s<e;s++){let i=Fe(t.charCodeAt(s),8),o=new Uint8Array(i);if(o.length>4)continue;let a=4-o.length;for(let c=o.length-1;c>=0;c--)n[s*4+c+a]=o[c]}this.valueBlock.value=t}};hs.NAME="UniversalStringValueBlock";var zc,ds=class extends hs{constructor({...t}={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}};zc=ds;T.UniversalString=zc;ds.NAME="UniversalString";var jc,ps=class extends It{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}};jc=ps;T.NumericString=jc;ps.NAME="NumericString";var Wc,ms=class extends It{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}};Wc=ms;T.PrintableString=Wc;ms.NAME="PrintableString";var Yc,gs=class extends It{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}};Yc=gs;T.TeletexString=Yc;gs.NAME="TeletexString";var Zc,ys=class extends It{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}};Zc=ys;T.VideotexString=Zc;ys.NAME="VideotexString";var Xc,bs=class extends It{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}};Xc=bs;T.IA5String=Xc;bs.NAME="IA5String";var Jc,ws=class extends It{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}};Jc=ws;T.GraphicString=Jc;ws.NAME="GraphicString";var Qc,ln=class extends It{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}};Qc=ln;T.VisibleString=Qc;ln.NAME="VisibleString";var tl,xs=class extends It{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}};tl=xs;T.GeneralString=tl;xs.NAME="GeneralString";var el,vs=class extends It{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}};el=vs;T.CharacterString=el;vs.NAME="CharacterString";var rl,un=class extends ln{constructor({value:t,valueDate:e,...n}={}){if(super(n),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,t){this.fromString(t),this.valueBlock.valueHexView=new Uint8Array(t.length);for(let s=0;s<t.length;s++)this.valueBlock.valueHexView[s]=t.charCodeAt(s)}e&&(this.fromDate(e),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(t){this.fromString(String.fromCharCode.apply(null,K.BufferSourceConverter.toUint8Array(t)))}toBuffer(){let t=this.toString(),e=new ArrayBuffer(t.length),n=new Uint8Array(e);for(let s=0;s<t.length;s++)n[s]=t.charCodeAt(s);return e}fromDate(t){this.year=t.getUTCFullYear(),this.month=t.getUTCMonth()+1,this.day=t.getUTCDate(),this.hour=t.getUTCHours(),this.minute=t.getUTCMinutes(),this.second=t.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(t){let n=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/ig.exec(t);if(n===null){this.error="Wrong input string for conversion";return}let s=parseInt(n[1],10);s>=50?this.year=1900+s:this.year=2e3+s,this.month=parseInt(n[2],10),this.day=parseInt(n[3],10),this.hour=parseInt(n[4],10),this.minute=parseInt(n[5],10),this.second=parseInt(n[6],10)}toString(t="iso"){if(t==="iso"){let e=new Array(7);return e[0]=Lt(this.year<2e3?this.year-1900:this.year-2e3,2),e[1]=Lt(this.month,2),e[2]=Lt(this.day,2),e[3]=Lt(this.hour,2),e[4]=Lt(this.minute,2),e[5]=Lt(this.second,2),e[6]="Z",e.join("")}return super.toString(t)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}};rl=un;T.UTCTime=rl;un.NAME="UTCTime";var nl,Es=class extends un{constructor(t={}){var e;super(t),(e=this.millisecond)!==null&&e!==void 0||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(t){super.fromDate(t),this.millisecond=t.getUTCMilliseconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond))}fromString(t){let e=!1,n="",s="",i=0,o,a=0,c=0;if(t[t.length-1]==="Z")n=t.substring(0,t.length-1),e=!0;else{let l=new Number(t[t.length-1]);if(isNaN(l.valueOf()))throw new Error("Wrong input string for conversion");n=t}if(e){if(n.indexOf("+")!==-1)throw new Error("Wrong input string for conversion");if(n.indexOf("-")!==-1)throw new Error("Wrong input string for conversion")}else{let l=1,h=n.indexOf("+"),b="";if(h===-1&&(h=n.indexOf("-"),l=-1),h!==-1){if(b=n.substring(h+1),n=n.substring(0,h),b.length!==2&&b.length!==4)throw new Error("Wrong input string for conversion");let m=parseInt(b.substring(0,2),10);if(isNaN(m.valueOf()))throw new Error("Wrong input string for conversion");if(a=l*m,b.length===4){if(m=parseInt(b.substring(2,4),10),isNaN(m.valueOf()))throw new Error("Wrong input string for conversion");c=l*m}}}let f=n.indexOf(".");if(f===-1&&(f=n.indexOf(",")),f!==-1){let l=new Number(`0${n.substring(f)}`);if(isNaN(l.valueOf()))throw new Error("Wrong input string for conversion");i=l.valueOf(),s=n.substring(0,f)}else s=n;switch(!0){case s.length===8:if(o=/(\d{4})(\d{2})(\d{2})/ig,f!==-1)throw new Error("Wrong input string for conversion");break;case s.length===10:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})/ig,f!==-1){let l=60*i;this.minute=Math.floor(l),l=60*(l-this.minute),this.second=Math.floor(l),l=1e3*(l-this.second),this.millisecond=Math.floor(l)}break;case s.length===12:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/ig,f!==-1){let l=60*i;this.second=Math.floor(l),l=1e3*(l-this.second),this.millisecond=Math.floor(l)}break;case s.length===14:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/ig,f!==-1){let l=1e3*i;this.millisecond=Math.floor(l)}break;default:throw new Error("Wrong input string for conversion")}let u=o.exec(s);if(u===null)throw new Error("Wrong input string for conversion");for(let l=1;l<u.length;l++)switch(l){case 1:this.year=parseInt(u[l],10);break;case 2:this.month=parseInt(u[l],10);break;case 3:this.day=parseInt(u[l],10);break;case 4:this.hour=parseInt(u[l],10)+a;break;case 5:this.minute=parseInt(u[l],10)+c;break;case 6:this.second=parseInt(u[l],10);break;default:throw new Error("Wrong input string for conversion")}if(e===!1){let l=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=l.getUTCFullYear(),this.month=l.getUTCMonth(),this.day=l.getUTCDay(),this.hour=l.getUTCHours(),this.minute=l.getUTCMinutes(),this.second=l.getUTCSeconds(),this.millisecond=l.getUTCMilliseconds()}}toString(t="iso"){if(t==="iso"){let e=[];return e.push(Lt(this.year,4)),e.push(Lt(this.month,2)),e.push(Lt(this.day,2)),e.push(Lt(this.hour,2)),e.push(Lt(this.minute,2)),e.push(Lt(this.second,2)),this.millisecond!==0&&(e.push("."),e.push(Lt(this.millisecond,3))),e.push("Z"),e.join("")}return super.toString(t)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}};nl=Es;T.GeneralizedTime=nl;Es.NAME="GeneralizedTime";var sl,As=class extends Ee{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}};sl=As;T.DATE=sl;As.NAME="DATE";var il,Bs=class extends Ee{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}};il=Bs;T.TimeOfDay=il;Bs.NAME="TimeOfDay";var ol,Ss=class extends Ee{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}};ol=Ss;T.DateTime=ol;Ss.NAME="DateTime";var al,Ts=class extends Ee{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}};al=Ts;T.Duration=al;Ts.NAME="Duration";var cl,Is=class extends Ee{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}};cl=Is;T.TIME=cl;Is.NAME="TIME";function Ud(r){let{result:t}=Dr(r),e=t.valueBlock.value;return{n:j(ae(e[1].toBigInt()),"base64url"),e:j(ae(e[2].toBigInt()),"base64url"),d:j(ae(e[3].toBigInt()),"base64url"),p:j(ae(e[4].toBigInt()),"base64url"),q:j(ae(e[5].toBigInt()),"base64url"),dp:j(ae(e[6].toBigInt()),"base64url"),dq:j(ae(e[7].toBigInt()),"base64url"),qi:j(ae(e[8].toBigInt()),"base64url"),kty:"RSA",alg:"RS256"}}function Dd(r){if(r.n==null||r.e==null||r.d==null||r.p==null||r.q==null||r.dp==null||r.dq==null||r.qi==null)throw new L("JWK was missing components","ERR_INVALID_PARAMETERS");let e=new yt({value:[new ft({value:0}),ft.fromBigInt(ce(Q(r.n,"base64url"))),ft.fromBigInt(ce(Q(r.e,"base64url"))),ft.fromBigInt(ce(Q(r.d,"base64url"))),ft.fromBigInt(ce(Q(r.p,"base64url"))),ft.fromBigInt(ce(Q(r.q,"base64url"))),ft.fromBigInt(ce(Q(r.dp,"base64url"))),ft.fromBigInt(ce(Q(r.dq,"base64url"))),ft.fromBigInt(ce(Q(r.qi,"base64url")))]}).toBER();return new Uint8Array(e,0,e.byteLength)}function Od(r){let{result:t}=Dr(r),e=t.valueBlock.value[1].valueBlock.value[0].valueBlock.value;return{kty:"RSA",n:j(ae(e[0].toBigInt()),"base64url"),e:j(ae(e[1].toBigInt()),"base64url")}}function Pd(r){if(r.n==null||r.e==null)throw new L("JWK was missing components","ERR_INVALID_PARAMETERS");let e=new yt({value:[new yt({value:[new Jt({value:"1.2.840.113549.1.1.1"}),new qe]}),new Cr({valueHex:new yt({value:[ft.fromBigInt(ce(Q(r.n,"base64url"))),ft.fromBigInt(ce(Q(r.e,"base64url")))]}).toBER()})]}).toBER();return new Uint8Array(e,0,e.byteLength)}function ae(r){let t=r.toString(16);t.length%2>0&&(t=`0${t}`);let e=t.length/2,n=new Uint8Array(e),s=0,i=0;for(;s<e;)n[s]=parseInt(t.slice(i,i+2),16),s+=1,i+=2;return n}function ce(r){let t=[];return r.forEach(function(e){let n=e.toString(16);n.length%2>0&&(n=`0${n}`),t.push(n)}),BigInt("0x"+t.join(""))}var Vd=16,po=32,mo=1e4;async function Md(r,t){let e=Tt.get(),s=new yt({value:[new ft({value:0}),new yt({value:[new Jt({value:"1.2.840.113549.1.1.1"}),new qe]}),new ve({valueHex:r.marshal()})]}).toBER(),i=new Uint8Array(s,0,s.byteLength),o=ir(Vd),a=await co(Tr,t,o,{c:mo,dkLen:po}),c=ir(16),f=await e.subtle.importKey("raw",a,"AES-CBC",!1,["encrypt"]),u=await e.subtle.encrypt({name:"AES-CBC",iv:c},f,i),l=new yt({value:[new ve({valueHex:o}),new ft({value:mo}),new ft({value:po}),new yt({value:[new Jt({value:"1.2.840.113549.2.11"}),new qe]})]}),h=new yt({value:[new Jt({value:"1.2.840.113549.1.5.13"}),new yt({value:[new yt({value:[new Jt({value:"1.2.840.113549.1.5.12"}),l]}),new yt({value:[new Jt({value:"2.16.840.1.101.3.4.1.42"}),new ve({valueHex:c})]})]})]}),m=new yt({value:[h,new ve({valueHex:u})]}).toBER(),d=new Uint8Array(m,0,m.byteLength);return["-----BEGIN ENCRYPTED PRIVATE KEY-----",...j(d,"base64pad").split(/(.{64})/).filter(Boolean),"-----END ENCRYPTED PRIVATE KEY-----"].join(`
`)}async function Hd(r,t){let e=Tt.get(),n;if(r.includes("-----BEGIN ENCRYPTED PRIVATE KEY-----")){let s=Q(r.replace("-----BEGIN ENCRYPTED PRIVATE KEY-----","").replace("-----END ENCRYPTED PRIVATE KEY-----","").replace(/\n/g,"").trim(),"base64pad"),{result:i}=Dr(s),{iv:o,salt:a,iterations:c,keySize:f,cipherText:u}=Fd(i),l=await co(Tr,t,a,{c,dkLen:f}),h=await e.subtle.importKey("raw",l,"AES-CBC",!1,["decrypt"]),b=fn(await e.subtle.decrypt({name:"AES-CBC",iv:o},h,u)),{result:m}=Dr(b);n=ll(m)}else if(r.includes("-----BEGIN PRIVATE KEY-----")){let s=Q(r.replace("-----BEGIN PRIVATE KEY-----","").replace("-----END PRIVATE KEY-----","").replace(/\n/g,"").trim(),"base64pad"),{result:i}=Dr(s);n=ll(i)}else throw new L("Could not parse private key from PEM data","ERR_INVALID_PARAMETERS");return go(n)}function Fd(r){let t=r.valueBlock.value[0];if(t.valueBlock.value[0].toString()!=="OBJECT IDENTIFIER : 1.2.840.113549.1.5.13")throw new L("Only pkcs5PBES2 encrypted private keys are supported","ERR_INVALID_PARAMS");let n=t.valueBlock.value[1].valueBlock.value[0];if(n.valueBlock.value[0].toString()!=="OBJECT IDENTIFIER : 1.2.840.113549.1.5.12")throw new L("Only pkcs5PBKDF2 key derivation functions are supported","ERR_INVALID_PARAMS");let i=n.valueBlock.value[1],o=fn(i.valueBlock.value[0].getValue()),a=mo,c=po;if(i.valueBlock.value.length===3)a=Number(i.valueBlock.value[1].toBigInt()),c=Number(i.valueBlock.value[2].toBigInt());else if(i.valueBlock.value.length===2)throw new L("Could not derive key size and iterations from PEM file - please use @libp2p/rsa to re-import your key","ERR_INVALID_PARAMS");let f=t.valueBlock.value[1].valueBlock.value[1],u=f.valueBlock.value[0].toString();if(u!=="OBJECT IDENTIFIER : 1.2.840.113549.3.7"){if(u!=="OBJECT IDENTIFIER : 1.3.14.3.2.7"){if(u!=="OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.2"){if(u!=="OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.22"){if(u!=="OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.42")throw new L("Only AES-CBC encryption schemes are supported","ERR_INVALID_PARAMS")}}}}let l=fn(f.valueBlock.value[1].getValue());return{cipherText:fn(r.valueBlock.value[1].getValue()),salt:o,iterations:a,keySize:c,iv:l}}function ll(r){return fn(r.valueBlock.value[2].getValue())}function fn(r){return new Uint8Array(r,0,r.byteLength)}async function ul(r){let t=await Tt.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:r,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),e=await dl(t);return{privateKey:e[0],publicKey:e[1]}}async function yo(r){let e=[await Tt.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await Kd(r)],n=await dl({privateKey:e[0],publicKey:e[1]});return{privateKey:n[0],publicKey:n[1]}}async function fl(r,t){let e=await Tt.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await Tt.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},e,t instanceof Uint8Array?t:t.subarray());return new Uint8Array(n,0,n.byteLength)}async function hl(r,t,e){let n=await Tt.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return Tt.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,t,e instanceof Uint8Array?e:e.subarray())}async function dl(r){if(r.privateKey==null||r.publicKey==null)throw new L("Private and public key are required","ERR_INVALID_PARAMETERS");return Promise.all([Tt.get().subtle.exportKey("jwk",r.privateKey),Tt.get().subtle.exportKey("jwk",r.publicKey)])}async function Kd(r){return Tt.get().subtle.importKey("jwk",{kty:r.kty,n:r.n,e:r.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function Rs(r){if(r.kty!=="RSA")throw new L("invalid key type","ERR_INVALID_KEY_TYPE");if(r.n==null)throw new L("invalid key modulus","ERR_INVALID_KEY_MODULUS");return Q(r.n,"base64url").length*8}var dn=8192,hn=class{_key;constructor(t){this._key=t}verify(t,e){return hl(this._key,e,t)}marshal(){return $e.jwkToPkix(this._key)}get bytes(){return se.encode({Type:rt.RSA,Data:this.marshal()}).subarray()}equals(t){return ut(this.bytes,t.bytes)}hash(){let t=pt.digest(this.bytes);return Ft(t)?t.then(({bytes:e})=>e):t.bytes}},Or=class{_key;_publicKey;constructor(t,e){this._key=t,this._publicKey=e}genSecret(){return ir(16)}sign(t){return fl(this._key,t)}get public(){if(this._publicKey==null)throw new L("public key not provided","ERR_PUBKEY_NOT_PROVIDED");return new hn(this._publicKey)}marshal(){return $e.jwkToPkcs1(this._key)}get bytes(){return ie.encode({Type:rt.RSA,Data:this.marshal()}).subarray()}equals(t){return ut(this.bytes,t.bytes)}hash(){let t=pt.digest(this.bytes);return Ft(t)?t.then(({bytes:e})=>e):t.bytes}async id(){let t=await this.public.hash();return j(t,"base58btc")}async export(t,e="pkcs-8"){if(e==="pkcs-8")return $e.exportToPem(this,t);if(e==="libp2p-key")return Rr(this.bytes,t);throw new L(`export format '${e}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}};async function go(r){let t=$e.pkcs1ToJwk(r);if(Rs(t)>dn)throw new L("key size is too large","ERR_KEY_SIZE_TOO_LARGE");let e=await yo(t);return new Or(e.privateKey,e.publicKey)}function $d(r){let t=$e.pkixToJwk(r);if(Rs(t)>dn)throw new L("key size is too large","ERR_KEY_SIZE_TOO_LARGE");return new hn(t)}async function Gd(r){if(Rs(r)>dn)throw new L("key size is too large","ERR_KEY_SIZE_TOO_LARGE");let t=await yo(r);return new Or(t.privateKey,t.publicKey)}async function zd(r){if(r>dn)throw new L("key size is too large","ERR_KEY_SIZE_TOO_LARGE");let t=await ul(r);return new Or(t.privateKey,t.publicKey)}var Ao={};gt(Ao,{Secp256k1PrivateKey:()=>mn,Secp256k1PublicKey:()=>pn,generateKeyPair:()=>ap,unmarshalSecp256k1PrivateKey:()=>ip,unmarshalSecp256k1PublicKey:()=>op});var jd=(r,t,e)=>r&t^~r&e,Wd=(r,t,e)=>r&t^r&e^t&e,Yd=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ge=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ze=new Uint32Array(64),wo=class extends Sr{constructor(){super(64,32,8,!1),this.A=Ge[0]|0,this.B=Ge[1]|0,this.C=Ge[2]|0,this.D=Ge[3]|0,this.E=Ge[4]|0,this.F=Ge[5]|0,this.G=Ge[6]|0,this.H=Ge[7]|0}get(){let{A:t,B:e,C:n,D:s,E:i,F:o,G:a,H:c}=this;return[t,e,n,s,i,o,a,c]}set(t,e,n,s,i,o,a,c){this.A=t|0,this.B=e|0,this.C=n|0,this.D=s|0,this.E=i|0,this.F=o|0,this.G=a|0,this.H=c|0}process(t,e){for(let l=0;l<16;l++,e+=4)ze[l]=t.getUint32(e,!1);for(let l=16;l<64;l++){let h=ze[l-15],b=ze[l-2],m=Wt(h,7)^Wt(h,18)^h>>>3,d=Wt(b,17)^Wt(b,19)^b>>>10;ze[l]=d+ze[l-7]+m+ze[l-16]|0}let{A:n,B:s,C:i,D:o,E:a,F:c,G:f,H:u}=this;for(let l=0;l<64;l++){let h=Wt(a,6)^Wt(a,11)^Wt(a,25),b=u+h+jd(a,c,f)+Yd[l]+ze[l]|0,d=(Wt(n,2)^Wt(n,13)^Wt(n,22))+Wd(n,s,i)|0;u=f,f=c,c=a,a=o+b|0,o=i,i=s,s=n,n=b+d|0}n=n+this.A|0,s=s+this.B|0,i=i+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,f=f+this.G|0,u=u+this.H|0,this.set(n,s,i,o,a,c,f,u)}roundClean(){ze.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var pl=In(()=>new wo);function Zd(r){let t=Zr(r);ne(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});let{endo:e,Fp:n,a:s}=t;if(e){if(!n.eql(s,n.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof e!="object"||typeof e.beta!="bigint"||typeof e.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}var{bytesToNumberBE:Xd,hexToBytes:Jd}=Nn,ar={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(r){let{Err:t}=ar;if(r.length<2||r[0]!==2)throw new t("Invalid signature integer tag");let e=r[1],n=r.subarray(2,e+2);if(!e||n.length!==e)throw new t("Invalid signature integer: wrong length");if(n[0]&128)throw new t("Invalid signature integer: negative");if(n[0]===0&&!(n[1]&128))throw new t("Invalid signature integer: unnecessary leading zero");return{d:Xd(n),l:r.subarray(e+2)}},toSig(r){let{Err:t}=ar,e=typeof r=="string"?Jd(r):r;if(!Yt(e))throw new Error("ui8a expected");let n=e.length;if(n<2||e[0]!=48)throw new t("Invalid signature tag");if(e[1]!==n-2)throw new t("Invalid signature: incorrect length");let{d:s,l:i}=ar._parseInt(e.subarray(2)),{d:o,l:a}=ar._parseInt(i);if(a.length)throw new t("Invalid signature: left bytes after parsing");return{r:s,s:o}},hexFromSig(r){let t=f=>Number.parseInt(f[0],16)&8?"00"+f:f,e=f=>{let u=f.toString(16);return u.length&1?`0${u}`:u},n=t(e(r.s)),s=t(e(r.r)),i=n.length/2,o=s.length/2,a=e(i),c=e(o);return`30${e(o+i+4)}02${c}${s}02${a}${n}`}},Se=BigInt(0),qt=BigInt(1),Dy=BigInt(2),ml=BigInt(3),Oy=BigInt(4);function Qd(r){let t=Zd(r),{Fp:e}=t,n=t.toBytes||((m,d,p)=>{let y=d.toAffine();return ge(Uint8Array.from([4]),e.toBytes(y.x),e.toBytes(y.y))}),s=t.fromBytes||(m=>{let d=m.subarray(1),p=e.fromBytes(d.subarray(0,e.BYTES)),y=e.fromBytes(d.subarray(e.BYTES,2*e.BYTES));return{x:p,y}});function i(m){let{a:d,b:p}=t,y=e.sqr(m),A=e.mul(y,m);return e.add(e.add(A,e.mul(m,d)),p)}if(!e.eql(e.sqr(t.Gy),i(t.Gx)))throw new Error("bad generator point: equation left != right");function o(m){return typeof m=="bigint"&&Se<m&&m<t.n}function a(m){if(!o(m))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(m){let{allowedPrivateKeyLengths:d,nByteLength:p,wrapPrivateKey:y,n:A}=t;if(d&&typeof m!="bigint"){if(Yt(m)&&(m=pe(m)),typeof m!="string"||!d.includes(m.length))throw new Error("Invalid key");m=m.padStart(p*2,"0")}let w;try{w=typeof m=="bigint"?m:me(it("private key",m,p))}catch{throw new Error(`private key must be ${p} bytes, hex or bigint, not ${typeof m}`)}return y&&(w=X(w,A)),a(w),w}let f=new Map;function u(m){if(!(m instanceof l))throw new Error("ProjectivePoint expected")}class l{constructor(d,p,y){if(this.px=d,this.py=p,this.pz=y,d==null||!e.isValid(d))throw new Error("x required");if(p==null||!e.isValid(p))throw new Error("y required");if(y==null||!e.isValid(y))throw new Error("z required")}static fromAffine(d){let{x:p,y}=d||{};if(!d||!e.isValid(p)||!e.isValid(y))throw new Error("invalid affine point");if(d instanceof l)throw new Error("projective point not allowed");let A=w=>e.eql(w,e.ZERO);return A(p)&&A(y)?l.ZERO:new l(p,y,e.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(d){let p=e.invertBatch(d.map(y=>y.pz));return d.map((y,A)=>y.toAffine(p[A])).map(l.fromAffine)}static fromHex(d){let p=l.fromAffine(s(it("pointHex",d)));return p.assertValidity(),p}static fromPrivateKey(d){return l.BASE.multiply(c(d))}_setWindowSize(d){this._WINDOW_SIZE=d,f.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!e.is0(this.py))return;throw new Error("bad point: ZERO")}let{x:d,y:p}=this.toAffine();if(!e.isValid(d)||!e.isValid(p))throw new Error("bad point: x or y not FE");let y=e.sqr(p),A=i(d);if(!e.eql(y,A))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){let{y:d}=this.toAffine();if(e.isOdd)return!e.isOdd(d);throw new Error("Field doesn't support isOdd")}equals(d){u(d);let{px:p,py:y,pz:A}=this,{px:w,py:_,pz:x}=d,S=e.eql(e.mul(p,x),e.mul(w,A)),R=e.eql(e.mul(y,x),e.mul(_,A));return S&&R}negate(){return new l(this.px,e.neg(this.py),this.pz)}double(){let{a:d,b:p}=t,y=e.mul(p,ml),{px:A,py:w,pz:_}=this,x=e.ZERO,S=e.ZERO,R=e.ZERO,N=e.mul(A,A),z=e.mul(w,w),$=e.mul(_,_),P=e.mul(A,w);return P=e.add(P,P),R=e.mul(A,_),R=e.add(R,R),x=e.mul(d,R),S=e.mul(y,$),S=e.add(x,S),x=e.sub(z,S),S=e.add(z,S),S=e.mul(x,S),x=e.mul(P,x),R=e.mul(y,R),$=e.mul(d,$),P=e.sub(N,$),P=e.mul(d,P),P=e.add(P,R),R=e.add(N,N),N=e.add(R,N),N=e.add(N,$),N=e.mul(N,P),S=e.add(S,N),$=e.mul(w,_),$=e.add($,$),N=e.mul($,P),x=e.sub(x,N),R=e.mul($,z),R=e.add(R,R),R=e.add(R,R),new l(x,S,R)}add(d){u(d);let{px:p,py:y,pz:A}=this,{px:w,py:_,pz:x}=d,S=e.ZERO,R=e.ZERO,N=e.ZERO,z=t.a,$=e.mul(t.b,ml),P=e.mul(p,w),ct=e.mul(y,_),ot=e.mul(A,x),Ht=e.add(p,y),v=e.add(w,_);Ht=e.mul(Ht,v),v=e.add(P,ct),Ht=e.sub(Ht,v),v=e.add(p,A);let k=e.add(w,x);return v=e.mul(v,k),k=e.add(P,ot),v=e.sub(v,k),k=e.add(y,A),S=e.add(_,x),k=e.mul(k,S),S=e.add(ct,ot),k=e.sub(k,S),N=e.mul(z,v),S=e.mul($,ot),N=e.add(S,N),S=e.sub(ct,N),N=e.add(ct,N),R=e.mul(S,N),ct=e.add(P,P),ct=e.add(ct,P),ot=e.mul(z,ot),v=e.mul($,v),ct=e.add(ct,ot),ot=e.sub(P,ot),ot=e.mul(z,ot),v=e.add(v,ot),P=e.mul(ct,v),R=e.add(R,P),P=e.mul(k,v),S=e.mul(Ht,S),S=e.sub(S,P),P=e.mul(Ht,ct),N=e.mul(k,N),N=e.add(N,P),new l(S,R,N)}subtract(d){return this.add(d.negate())}is0(){return this.equals(l.ZERO)}wNAF(d){return b.wNAFCached(this,f,d,p=>{let y=e.invertBatch(p.map(A=>A.pz));return p.map((A,w)=>A.toAffine(y[w])).map(l.fromAffine)})}multiplyUnsafe(d){let p=l.ZERO;if(d===Se)return p;if(a(d),d===qt)return this;let{endo:y}=t;if(!y)return b.unsafeLadder(this,d);let{k1neg:A,k1:w,k2neg:_,k2:x}=y.splitScalar(d),S=p,R=p,N=this;for(;w>Se||x>Se;)w&qt&&(S=S.add(N)),x&qt&&(R=R.add(N)),N=N.double(),w>>=qt,x>>=qt;return A&&(S=S.negate()),_&&(R=R.negate()),R=new l(e.mul(R.px,y.beta),R.py,R.pz),S.add(R)}multiply(d){a(d);let p=d,y,A,{endo:w}=t;if(w){let{k1neg:_,k1:x,k2neg:S,k2:R}=w.splitScalar(p),{p:N,f:z}=this.wNAF(x),{p:$,f:P}=this.wNAF(R);N=b.constTimeNegate(_,N),$=b.constTimeNegate(S,$),$=new l(e.mul($.px,w.beta),$.py,$.pz),y=N.add($),A=z.add(P)}else{let{p:_,f:x}=this.wNAF(p);y=_,A=x}return l.normalizeZ([y,A])[0]}multiplyAndAddUnsafe(d,p,y){let A=l.BASE,w=(x,S)=>S===Se||S===qt||!x.equals(A)?x.multiplyUnsafe(S):x.multiply(S),_=w(this,p).add(w(d,y));return _.is0()?void 0:_}toAffine(d){let{px:p,py:y,pz:A}=this,w=this.is0();d==null&&(d=w?e.ONE:e.inv(A));let _=e.mul(p,d),x=e.mul(y,d),S=e.mul(A,d);if(w)return{x:e.ZERO,y:e.ZERO};if(!e.eql(S,e.ONE))throw new Error("invZ was invalid");return{x:_,y:x}}isTorsionFree(){let{h:d,isTorsionFree:p}=t;if(d===qt)return!0;if(p)return p(l,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h:d,clearCofactor:p}=t;return d===qt?this:p?p(l,this):this.multiplyUnsafe(t.h)}toRawBytes(d=!0){return this.assertValidity(),n(l,this,d)}toHex(d=!0){return pe(this.toRawBytes(d))}}l.BASE=new l(t.Gx,t.Gy,e.ONE),l.ZERO=new l(e.ZERO,e.ONE,e.ZERO);let h=t.nBitLength,b=Cn(l,t.endo?Math.ceil(h/2):h);return{CURVE:t,ProjectivePoint:l,normPrivateKeyToScalar:c,weierstrassEquation:i,isWithinCurveOrder:o}}function tp(r){let t=Zr(r);return ne(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function gl(r){let t=tp(r),{Fp:e,n}=t,s=e.BYTES+1,i=2*e.BYTES+1;function o(v){return Se<v&&v<e.ORDER}function a(v){return X(v,n)}function c(v){return _n(v,n)}let{ProjectivePoint:f,normPrivateKeyToScalar:u,weierstrassEquation:l,isWithinCurveOrder:h}=Qd({...t,toBytes(v,k,V){let E=k.toAffine(),g=e.toBytes(E.x),I=ge;return V?I(Uint8Array.from([k.hasEvenY()?2:3]),g):I(Uint8Array.from([4]),g,e.toBytes(E.y))},fromBytes(v){let k=v.length,V=v[0],E=v.subarray(1);if(k===s&&(V===2||V===3)){let g=me(E);if(!o(g))throw new Error("Point is not on curve");let I=l(g),C=e.sqrt(I),D=(C&qt)===qt;return(V&1)===1!==D&&(C=e.neg(C)),{x:g,y:C}}else if(k===i&&V===4){let g=e.fromBytes(E.subarray(0,e.BYTES)),I=e.fromBytes(E.subarray(e.BYTES,2*e.BYTES));return{x:g,y:I}}else throw new Error(`Point of length ${k} was invalid. Expected ${s} compressed bytes or ${i} uncompressed bytes`)}}),b=v=>pe(Me(v,t.nByteLength));function m(v){let k=n>>qt;return v>k}function d(v){return m(v)?a(-v):v}let p=(v,k,V)=>me(v.slice(k,V));class y{constructor(k,V,E){this.r=k,this.s=V,this.recovery=E,this.assertValidity()}static fromCompact(k){let V=t.nByteLength;return k=it("compactSignature",k,V*2),new y(p(k,0,V),p(k,V,2*V))}static fromDER(k){let{r:V,s:E}=ar.toSig(it("DER",k));return new y(V,E)}assertValidity(){if(!h(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!h(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(k){return new y(this.r,this.s,k)}recoverPublicKey(k){let{r:V,s:E,recovery:g}=this,I=R(it("msgHash",k));if(g==null||![0,1,2,3].includes(g))throw new Error("recovery id invalid");let C=g===2||g===3?V+t.n:V;if(C>=e.ORDER)throw new Error("recovery id 2 or 3 invalid");let D=g&1?"03":"02",M=f.fromHex(D+b(C)),F=c(C),Y=a(-I*F),q=a(E*F),G=f.BASE.multiplyAndAddUnsafe(M,Y,q);if(!G)throw new Error("point at infinify");return G.assertValidity(),G}hasHighS(){return m(this.s)}normalizeS(){return this.hasHighS()?new y(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return Je(this.toDERHex())}toDERHex(){return ar.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Je(this.toCompactHex())}toCompactHex(){return b(this.r)+b(this.s)}}let A={isValidPrivateKey(v){try{return u(v),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{let v=qi(t.n);return rc(t.randomBytes(v),t.n)},precompute(v=8,k=f.BASE){return k._setWindowSize(v),k.multiply(BigInt(3)),k}};function w(v,k=!0){return f.fromPrivateKey(v).toRawBytes(k)}function _(v){let k=Yt(v),V=typeof v=="string",E=(k||V)&&v.length;return k?E===s||E===i:V?E===2*s||E===2*i:v instanceof f}function x(v,k,V=!0){if(_(v))throw new Error("first arg must be private key");if(!_(k))throw new Error("second arg must be public key");return f.fromHex(k).multiply(u(v)).toRawBytes(V)}let S=t.bits2int||function(v){let k=me(v),V=v.length*8-t.nBitLength;return V>0?k>>BigInt(V):k},R=t.bits2int_modN||function(v){return a(S(v))},N=Yr(t.nBitLength);function z(v){if(typeof v!="bigint")throw new Error("bigint expected");if(!(Se<=v&&v<N))throw new Error(`bigint expected < 2^${t.nBitLength}`);return Me(v,t.nByteLength)}function $(v,k,V=P){if(["recovered","canonical"].some(nt=>nt in V))throw new Error("sign() legacy options not supported");let{hash:E,randomBytes:g}=t,{lowS:I,prehash:C,extraEntropy:D}=V;I==null&&(I=!0),v=it("msgHash",v),C&&(v=it("prehashed msgHash",E(v)));let M=R(v),F=u(k),Y=[z(F),z(M)];if(D!=null){let nt=D===!0?g(e.BYTES):D;Y.push(it("extraEntropy",nt))}let q=ge(...Y),G=M;function lt(nt){let bt=S(nt);if(!h(bt))return;let wt=c(bt),ht=f.BASE.multiply(bt).toAffine(),vt=a(ht.x);if(vt===Se)return;let le=a(wt*a(G+vt*F));if(le===Se)return;let Ye=(ht.x===vt?0:2)|Number(ht.y&qt),qr=le;return I&&m(le)&&(qr=d(le),Ye^=1),new y(vt,qr,Ye)}return{seed:q,k2sig:lt}}let P={lowS:t.lowS,prehash:!1},ct={lowS:t.lowS,prehash:!1};function ot(v,k,V=P){let{seed:E,k2sig:g}=$(v,k,V),I=t;return Mi(I.hash.outputLen,I.nByteLength,I.hmac)(E,g)}f.BASE._setWindowSize(8);function Ht(v,k,V,E=ct){let g=v;if(k=it("msgHash",k),V=it("publicKey",V),"strict"in E)throw new Error("options.strict was renamed to lowS");let{lowS:I,prehash:C}=E,D,M;try{if(typeof g=="string"||Yt(g))try{D=y.fromDER(g)}catch(ht){if(!(ht instanceof ar.Err))throw ht;D=y.fromCompact(g)}else if(typeof g=="object"&&typeof g.r=="bigint"&&typeof g.s=="bigint"){let{r:ht,s:vt}=g;D=new y(ht,vt)}else throw new Error("PARSE");M=f.fromHex(V)}catch(ht){if(ht.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(I&&D.hasHighS())return!1;C&&(k=t.hash(k));let{r:F,s:Y}=D,q=R(k),G=c(Y),lt=a(q*G),nt=a(F*G),bt=f.BASE.multiplyAndAddUnsafe(M,lt,nt)?.toAffine();return bt?a(bt.x)===F:!1}return{CURVE:t,getPublicKey:w,getSharedSecret:x,sign:ot,verify:Ht,ProjectivePoint:f,Signature:y,utils:A}}function ep(r){return{hash:r,hmac:(t,...e)=>en(r,t,Tn(...e)),randomBytes:Br}}function yl(r,t){let e=n=>gl({...r,...ep(n)});return Object.freeze({...e(t),create:e})}var xl=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),bl=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),rp=BigInt(1),xo=BigInt(2),wl=(r,t)=>(r+t/xo)/t;function np(r){let t=xl,e=BigInt(3),n=BigInt(6),s=BigInt(11),i=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),f=r*r*r%t,u=f*f*r%t,l=et(u,e,t)*u%t,h=et(l,e,t)*u%t,b=et(h,xo,t)*f%t,m=et(b,s,t)*b%t,d=et(m,i,t)*m%t,p=et(d,a,t)*d%t,y=et(p,c,t)*p%t,A=et(y,a,t)*d%t,w=et(A,e,t)*u%t,_=et(w,o,t)*m%t,x=et(_,n,t)*f%t,S=et(x,xo,t);if(!vo.eql(vo.sqr(S),r))throw new Error("Cannot find square root");return S}var vo=Ln(xl,void 0,void 0,{sqrt:np}),te=yl({a:BigInt(0),b:BigInt(7),Fp:vo,n:bl,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:r=>{let t=bl,e=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-rp*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=e,o=BigInt("0x100000000000000000000000000000000"),a=wl(i*r,t),c=wl(-n*r,t),f=X(r-a*e-c*s,t),u=X(-a*n-c*i,t),l=f>o,h=u>o;if(l&&(f=t-f),h&&(u=t-u),f>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+r);return{k1neg:l,k1:f,k2neg:h,k2:u}}}},pl),Gy=BigInt(0);var zy=te.ProjectivePoint;function vl(){return te.utils.randomPrivateKey()}function El(r,t){let e=pt.digest(t instanceof Uint8Array?t:t.subarray());if(Ft(e))return e.then(({digest:n})=>te.sign(n,r).toDERRawBytes()).catch(n=>{throw new L(String(n),"ERR_INVALID_INPUT")});try{return te.sign(e.digest,r).toDERRawBytes()}catch(n){throw new L(String(n),"ERR_INVALID_INPUT")}}function Al(r,t,e){let n=pt.digest(e instanceof Uint8Array?e:e.subarray());if(Ft(n))return n.then(({digest:s})=>te.verify(t,s,r)).catch(s=>{throw new L(String(s),"ERR_INVALID_INPUT")});try{return te.verify(t,n.digest,r)}catch(s){throw new L(String(s),"ERR_INVALID_INPUT")}}function Bl(r){return te.ProjectivePoint.fromHex(r).toRawBytes(!0)}function Sl(r){try{te.getPublicKey(r,!0)}catch(t){throw new L(String(t),"ERR_INVALID_PRIVATE_KEY")}}function Eo(r){try{te.ProjectivePoint.fromHex(r)}catch(t){throw new L(String(t),"ERR_INVALID_PUBLIC_KEY")}}function Tl(r){try{return te.getPublicKey(r,!0)}catch(t){throw new L(String(t),"ERR_INVALID_PRIVATE_KEY")}}var pn=class{_key;constructor(t){Eo(t),this._key=t}verify(t,e){return Al(this._key,e,t)}marshal(){return Bl(this._key)}get bytes(){return se.encode({Type:rt.Secp256k1,Data:this.marshal()}).subarray()}equals(t){return ut(this.bytes,t.bytes)}async hash(){let t=pt.digest(this.bytes),e;return Ft(t)?{bytes:e}=await t:e=t.bytes,e}},mn=class{_key;_publicKey;constructor(t,e){this._key=t,this._publicKey=e??Tl(t),Sl(this._key),Eo(this._publicKey)}sign(t){return El(this._key,t)}get public(){return new pn(this._publicKey)}marshal(){return this._key}get bytes(){return ie.encode({Type:rt.Secp256k1,Data:this.marshal()}).subarray()}equals(t){return ut(this.bytes,t.bytes)}hash(){let t=pt.digest(this.bytes);return Ft(t)?t.then(({bytes:e})=>e):t.bytes}async id(){let t=await this.public.hash();return j(t,"base58btc")}async export(t,e="libp2p-key"){if(e==="libp2p-key")return Rr(this.bytes,t);throw new L(`export format '${e}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}};function ip(r){return new mn(r)}function op(r){return new pn(r)}async function ap(){let r=vl();return new mn(r)}var cr={rsa:bo,ed25519:ao,secp256k1:Ao};function Il(r){let t=Object.keys(cr).join(" / ");return new L(`invalid or unsupported key type ${r}. Must be ${t}`,"ERR_UNSUPPORTED_KEY_TYPE")}function kl(r){let t=se.decode(r),e=t.Data??new Uint8Array;switch(t.Type){case rt.RSA:return cr.rsa.unmarshalRsaPublicKey(e);case rt.Ed25519:return cr.ed25519.unmarshalEd25519PublicKey(e);case rt.Secp256k1:return cr.secp256k1.unmarshalSecp256k1PublicKey(e);default:throw Il(t.Type??"unknown")}}async function Rl(r){let t=ie.decode(r),e=t.Data??new Uint8Array;switch(t.Type){case rt.RSA:return cr.rsa.unmarshalRsaPrivateKey(e);case rt.Ed25519:return cr.ed25519.unmarshalEd25519PrivateKey(e);case rt.Secp256k1:return cr.secp256k1.unmarshalSecp256k1PrivateKey(e);default:throw Il(t.Type??"RSA")}}var cp=Math.pow(2,7),lp=Math.pow(2,14),up=Math.pow(2,21),Bo=Math.pow(2,28),So=Math.pow(2,35),To=Math.pow(2,42),Io=Math.pow(2,49),W=128,Bt=127;function $t(r){if(r<cp)return 1;if(r<lp)return 2;if(r<up)return 3;if(r<Bo)return 4;if(r<So)return 5;if(r<To)return 6;if(r<Io)return 7;if(Number.MAX_SAFE_INTEGER!=null&&r>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function fp(r,t,e=0){switch($t(r)){case 8:t[e++]=r&255|W,r/=128;case 7:t[e++]=r&255|W,r/=128;case 6:t[e++]=r&255|W,r/=128;case 5:t[e++]=r&255|W,r/=128;case 4:t[e++]=r&255|W,r>>>=7;case 3:t[e++]=r&255|W,r>>>=7;case 2:t[e++]=r&255|W,r>>>=7;case 1:{t[e++]=r&255,r>>>=7;break}default:throw new Error("unreachable")}return t}function hp(r,t,e=0){switch($t(r)){case 8:t.set(e++,r&255|W),r/=128;case 7:t.set(e++,r&255|W),r/=128;case 6:t.set(e++,r&255|W),r/=128;case 5:t.set(e++,r&255|W),r/=128;case 4:t.set(e++,r&255|W),r>>>=7;case 3:t.set(e++,r&255|W),r>>>=7;case 2:t.set(e++,r&255|W),r>>>=7;case 1:{t.set(e++,r&255),r>>>=7;break}default:throw new Error("unreachable")}return t}function dp(r,t){let e=r[t],n=0;if(n+=e&Bt,e<W||(e=r[t+1],n+=(e&Bt)<<7,e<W)||(e=r[t+2],n+=(e&Bt)<<14,e<W)||(e=r[t+3],n+=(e&Bt)<<21,e<W)||(e=r[t+4],n+=(e&Bt)*Bo,e<W)||(e=r[t+5],n+=(e&Bt)*So,e<W)||(e=r[t+6],n+=(e&Bt)*To,e<W)||(e=r[t+7],n+=(e&Bt)*Io,e<W))return n;throw new RangeError("Could not decode varint")}function pp(r,t){let e=r.get(t),n=0;if(n+=e&Bt,e<W||(e=r.get(t+1),n+=(e&Bt)<<7,e<W)||(e=r.get(t+2),n+=(e&Bt)<<14,e<W)||(e=r.get(t+3),n+=(e&Bt)<<21,e<W)||(e=r.get(t+4),n+=(e&Bt)*Bo,e<W)||(e=r.get(t+5),n+=(e&Bt)*So,e<W)||(e=r.get(t+6),n+=(e&Bt)*To,e<W)||(e=r.get(t+7),n+=(e&Bt)*Io,e<W))return n;throw new RangeError("Could not decode varint")}function Gt(r,t,e=0){return t==null&&(t=Nt($t(r))),t instanceof Uint8Array?fp(r,t,e):hp(r,t,e)}function Te(r,t=0){return r instanceof Uint8Array?dp(r,t):pp(r,t)}var _l=Symbol.for("@achingbrain/uint8arraylist");function Nl(r,t){if(t==null||t<0)throw new RangeError("index is out of bounds");let e=0;for(let n of r){let s=e+n.byteLength;if(t<s)return{buf:n,index:t-e};e=s}throw new RangeError("index is out of bounds")}function _s(r){return!!r?.[_l]}var ee=class r{bufs;length;[_l]=!0;constructor(...t){this.bufs=[],this.length=0,t.length>0&&this.appendAll(t)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...t){this.appendAll(t)}appendAll(t){let e=0;for(let n of t)if(n instanceof Uint8Array)e+=n.byteLength,this.bufs.push(n);else if(_s(n))e+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=e}prepend(...t){this.prependAll(t)}prependAll(t){let e=0;for(let n of t.reverse())if(n instanceof Uint8Array)e+=n.byteLength,this.bufs.unshift(n);else if(_s(n))e+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=e}get(t){let e=Nl(this.bufs,t);return e.buf[e.index]}set(t,e){let n=Nl(this.bufs,t);n.buf[n.index]=e}write(t,e=0){if(t instanceof Uint8Array)for(let n=0;n<t.length;n++)this.set(e+n,t[n]);else if(_s(t))for(let n=0;n<t.length;n++)this.set(e+n,t.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(t){if(t=Math.trunc(t),!(Number.isNaN(t)||t<=0)){if(t===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(t>=this.bufs[0].byteLength)t-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(t),this.length-=t;break}}}slice(t,e){let{bufs:n,length:s}=this._subList(t,e);return St(n,s)}subarray(t,e){let{bufs:n,length:s}=this._subList(t,e);return n.length===1?n[0]:St(n,s)}sublist(t,e){let{bufs:n,length:s}=this._subList(t,e),i=new r;return i.length=s,i.bufs=[...n],i}_subList(t,e){if(t=t??0,e=e??this.length,t<0&&(t=this.length+t),e<0&&(e=this.length+e),t<0||e>this.length)throw new RangeError("index is out of bounds");if(t===e)return{bufs:[],length:0};if(t===0&&e===this.length)return{bufs:this.bufs,length:this.length};let n=[],s=0;for(let i=0;i<this.bufs.length;i++){let o=this.bufs[i],a=s,c=a+o.byteLength;if(s=c,t>=c)continue;let f=t>=a&&t<c,u=e>a&&e<=c;if(f&&u){if(t===a&&e===c){n.push(o);break}let l=t-a;n.push(o.subarray(l,l+(e-t)));break}if(f){if(t===0){n.push(o);continue}n.push(o.subarray(t-a));continue}if(u){if(e===c){n.push(o);break}n.push(o.subarray(0,e-a));break}n.push(o)}return{bufs:n,length:e-t}}indexOf(t,e=0){if(!_s(t)&&!(t instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');let n=t instanceof Uint8Array?t:t.subarray();if(e=Number(e??0),isNaN(e)&&(e=0),e<0&&(e=this.length+e),e<0&&(e=0),t.length===0)return e>this.length?this.length:e;let s=n.byteLength;if(s===0)throw new TypeError("search must be at least 1 byte long");let i=256,o=new Int32Array(i);for(let l=0;l<i;l++)o[l]=-1;for(let l=0;l<s;l++)o[n[l]]=l;let a=o,c=this.byteLength-n.byteLength,f=n.byteLength-1,u;for(let l=e;l<=c;l+=u){u=0;for(let h=f;h>=0;h--){let b=this.get(l+h);if(n[h]!==b){u=Math.max(1,h-a[b]);break}}if(u===0)return l}return-1}getInt8(t){let e=this.subarray(t,t+1);return new DataView(e.buffer,e.byteOffset,e.byteLength).getInt8(0)}setInt8(t,e){let n=Nt(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,e),this.write(n,t)}getInt16(t,e){let n=this.subarray(t,t+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,e)}setInt16(t,e,n){let s=he(2);new DataView(s.buffer,s.byteOffset,s.byteLength).setInt16(0,e,n),this.write(s,t)}getInt32(t,e){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,e)}setInt32(t,e,n){let s=he(4);new DataView(s.buffer,s.byteOffset,s.byteLength).setInt32(0,e,n),this.write(s,t)}getBigInt64(t,e){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,e)}setBigInt64(t,e,n){let s=he(8);new DataView(s.buffer,s.byteOffset,s.byteLength).setBigInt64(0,e,n),this.write(s,t)}getUint8(t){let e=this.subarray(t,t+1);return new DataView(e.buffer,e.byteOffset,e.byteLength).getUint8(0)}setUint8(t,e){let n=Nt(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,e),this.write(n,t)}getUint16(t,e){let n=this.subarray(t,t+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,e)}setUint16(t,e,n){let s=he(2);new DataView(s.buffer,s.byteOffset,s.byteLength).setUint16(0,e,n),this.write(s,t)}getUint32(t,e){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,e)}setUint32(t,e,n){let s=he(4);new DataView(s.buffer,s.byteOffset,s.byteLength).setUint32(0,e,n),this.write(s,t)}getBigUint64(t,e){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,e)}setBigUint64(t,e,n){let s=he(8);new DataView(s.buffer,s.byteOffset,s.byteLength).setBigUint64(0,e,n),this.write(s,t)}getFloat32(t,e){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,e)}setFloat32(t,e,n){let s=he(4);new DataView(s.buffer,s.byteOffset,s.byteLength).setFloat32(0,e,n),this.write(s,t)}getFloat64(t,e){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,e)}setFloat64(t,e,n){let s=he(8);new DataView(s.buffer,s.byteOffset,s.byteLength).setFloat64(0,e,n),this.write(s,t)}equals(t){if(t==null||!(t instanceof r)||t.bufs.length!==this.bufs.length)return!1;for(let e=0;e<this.bufs.length;e++)if(!ut(this.bufs[e],t.bufs[e]))return!1;return!0}static fromUint8Arrays(t,e){let n=new r;return n.bufs=t,e==null&&(e=t.reduce((s,i)=>s+i.byteLength,0)),n.length=e,n}};var Ll={ERR_SIGNATURE_NOT_VALID:"ERR_SIGNATURE_NOT_VALID"};var gn;(function(r){let t;r.codec=()=>(t==null&&(t=Pt((e,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),e.publicKey!=null&&e.publicKey.byteLength>0&&(n.uint32(10),n.bytes(e.publicKey)),e.payloadType!=null&&e.payloadType.byteLength>0&&(n.uint32(18),n.bytes(e.payloadType)),e.payload!=null&&e.payload.byteLength>0&&(n.uint32(26),n.bytes(e.payload)),e.signature!=null&&e.signature.byteLength>0&&(n.uint32(42),n.bytes(e.signature)),s.lengthDelimited!==!1&&n.ldelim()},(e,n)=>{let s={publicKey:new Uint8Array(0),payloadType:new Uint8Array(0),payload:new Uint8Array(0),signature:new Uint8Array(0)},i=n==null?e.len:e.pos+n;for(;e.pos<i;){let o=e.uint32();switch(o>>>3){case 1:s.publicKey=e.bytes();break;case 2:s.payloadType=e.bytes();break;case 3:s.payload=e.bytes();break;case 5:s.signature=e.bytes();break;default:e.skipType(o&7);break}}return s})),t),r.encode=e=>Ot(e,r.codec()),r.decode=e=>Dt(e,r.codec())})(gn||(gn={}));var yn=class r{static createFromProtobuf=async t=>{let e=gn.decode(t),n=await Ma(e.publicKey);return new r({peerId:n,payloadType:e.payloadType,payload:e.payload,signature:e.signature})};static seal=async(t,e)=>{if(e.privateKey==null)throw new Error("Missing private key");let n=t.domain,s=t.codec,i=t.marshal(),o=Cl(n,s,i),c=await(await Rl(e.privateKey)).sign(o.subarray());return new r({peerId:e,payloadType:s,payload:i,signature:c})};static openAndCertify=async(t,e)=>{let n=await r.createFromProtobuf(t);if(!await n.validate(e))throw new L("envelope signature is not valid for the given domain",Ll.ERR_SIGNATURE_NOT_VALID);return n};peerId;payloadType;payload;signature;marshaled;constructor(t){let{peerId:e,payloadType:n,payload:s,signature:i}=t;this.peerId=e,this.payloadType=n,this.payload=s,this.signature=i}marshal(){if(this.peerId.publicKey==null)throw new Error("Missing public key");return this.marshaled==null&&(this.marshaled=gn.encode({publicKey:this.peerId.publicKey,payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(t){return ut(this.marshal(),t.marshal())}async validate(t){let e=Cl(t,this.payloadType,this.payload);if(this.peerId.publicKey==null)throw new Error("Missing public key");return kl(this.peerId.publicKey).verify(e.subarray(),this.signature)}},Cl=(r,t,e)=>{let n=Q(r),s=Gt(n.byteLength),i=Gt(t.length),o=Gt(e.length);return new ee(s,n,i,t,o,e)};var Ls=class{index=0;input="";new(t){return this.index=0,this.input=t,this}readAtomically(t){let e=this.index,n=t();return n===void 0&&(this.index=e),n}parseWith(t){let e=t();if(this.index===this.input.length)return e}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(t){return this.readAtomically(()=>{let e=this.readChar();if(e===t)return e})}readSeparator(t,e,n){return this.readAtomically(()=>{if(!(e>0&&this.readGivenChar(t)===void 0))return n()})}readNumber(t,e,n,s){return this.readAtomically(()=>{let i=0,o=0,a=this.peekChar();if(a===void 0)return;let c=a==="0",f=2**(8*s)-1;for(;;){let u=this.readAtomically(()=>{let l=this.readChar();if(l===void 0)return;let h=Number.parseInt(l,t);if(!Number.isNaN(h))return h});if(u===void 0)break;if(i*=t,i+=u,i>f||(o+=1,e!==void 0&&o>e))return}if(o!==0)return!n&&c&&o>1?void 0:i})}readIPv4Addr(){return this.readAtomically(()=>{let t=new Uint8Array(4);for(let e=0;e<t.length;e++){let n=this.readSeparator(".",e,()=>this.readNumber(10,3,!1,1));if(n===void 0)return;t[e]=n}return t})}readIPv6Addr(){let t=e=>{for(let n=0;n<e.length/2;n++){let s=n*2;if(n<e.length-3){let o=this.readSeparator(":",n,()=>this.readIPv4Addr());if(o!==void 0)return e[s]=o[0],e[s+1]=o[1],e[s+2]=o[2],e[s+3]=o[3],[s+4,!0]}let i=this.readSeparator(":",n,()=>this.readNumber(16,4,!0,2));if(i===void 0)return[s,!1];e[s]=i>>8,e[s+1]=i&255}return[e.length,!1]};return this.readAtomically(()=>{let e=new Uint8Array(16),[n,s]=t(e);if(n===16)return e;if(s||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;let i=new Uint8Array(14),o=16-(n+2),[a]=t(i.subarray(0,o));return e.set(i.subarray(0,a),16-a),e})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}};var Ul=45,mp=15,Pr=new Ls;function ko(r){if(!(r.length>mp))return Pr.new(r).parseWith(()=>Pr.readIPv4Addr())}function Ro(r){if(r.includes("%")&&(r=r.split("%")[0]),!(r.length>Ul))return Pr.new(r).parseWith(()=>Pr.readIPv6Addr())}function Cs(r){if(r.includes("%")&&(r=r.split("%")[0]),!(r.length>Ul))return Pr.new(r).parseWith(()=>Pr.readIPAddr())}var Lb=parseInt("0xFFFF",16),Cb=new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255]);function Pl(r){return!!ko(r)}function Vl(r){return!!Ro(r)}function Us(r){return!!Cs(r)}var Ml=Pl,xp=Vl,No=function(r){let t=0;if(r=r.toString().trim(),Ml(r)){let e=new Uint8Array(t+4);return r.split(/\./g).forEach(n=>{e[t++]=parseInt(n,10)&255}),e}if(xp(r)){let e=r.split(":",8),n;for(n=0;n<e.length;n++){let i=Ml(e[n]),o;i&&(o=No(e[n]),e[n]=j(o.slice(0,2),"base16")),o!=null&&++n<8&&e.splice(n,0,j(o.slice(2,4),"base16"))}if(e[0]==="")for(;e.length<8;)e.unshift("0");else if(e[e.length-1]==="")for(;e.length<8;)e.push("0");else if(e.length<8){for(n=0;n<e.length&&e[n]!=="";n++);let i=[n,1];for(n=9-e.length;n>0;n--)i.push("0");e.splice.apply(e,i)}let s=new Uint8Array(t+16);for(n=0;n<e.length;n++){let i=parseInt(e[n],16);s[t++]=i>>8&255,s[t++]=i&255}return s}throw new Error("invalid ip address")},Hl=function(r,t=0,e){t=~~t,e=e??r.length-t;let n=new DataView(r.buffer);if(e===4){let s=[];for(let i=0;i<e;i++)s.push(r[t+i]);return s.join(".")}if(e===16){let s=[];for(let i=0;i<e;i+=2)s.push(n.getUint16(t+i).toString(16));return s.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""};var Vr={},_o={},Ep=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,-1,"ip6zone"],[43,8,"ipcidr"],[53,-1,"dns",!0],[54,-1,"dns4",!0],[55,-1,"dns6",!0],[56,-1,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,-1,"unix",!1,!0],[421,-1,"ipfs"],[421,-1,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,-1,"garlic64"],[448,0,"tls"],[449,-1,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,-1,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,-1,"memory"]];Ep.forEach(r=>{let t=Ap(...r);_o[t.code]=t,Vr[t.name]=t});function Ap(r,t,e,n,s){return{code:r,size:t,name:e,resolvable:!!n,path:!!s}}function J(r){if(typeof r=="number"){if(_o[r]!=null)return _o[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(Vr[r]!=null)return Vr[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}var gw=J("ip4"),yw=J("ip6"),bw=J("ipcidr");function Co(r,t){switch(J(r).code){case 4:case 41:return Sp(t);case 42:return ql(t);case 6:case 273:case 33:case 132:return Gl(t).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return ql(t);case 421:return Rp(t);case 444:return $l(t);case 445:return $l(t);case 466:return kp(t);default:return j(t,"base16")}}function Uo(r,t){switch(J(r).code){case 4:return Fl(t);case 41:return Fl(t);case 42:return Kl(t);case 6:case 273:case 33:case 132:return Do(parseInt(t,10));case 53:case 54:case 55:case 56:case 400:case 449:case 777:return Kl(t);case 421:return Tp(t);case 444:return Np(t);case 445:return _p(t);case 466:return Ip(t);default:return Q(t,"base16")}}var Lo=Object.values(Le).map(r=>r.decoder),Bp=function(){let r=Lo[0].or(Lo[1]);return Lo.slice(2).forEach(t=>r=r.or(t)),r}();function Fl(r){if(!Us(r))throw new Error("invalid ip address");return No(r)}function Sp(r){let t=Hl(r,0,r.length);if(t==null)throw new Error("ipBuff is required");if(!Us(t))throw new Error("invalid ip address");return t}function Do(r){let t=new ArrayBuffer(2);return new DataView(t).setUint16(0,r),new Uint8Array(t)}function Gl(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function Kl(r){let t=Q(r),e=Uint8Array.from(Gt(t.length));return St([e,t],e.length+t.length)}function ql(r){let t=Te(r);if(r=r.slice($t(t)),r.length!==t)throw new Error("inconsistent lengths");return j(r)}function Tp(r){let t;r[0]==="Q"||r[0]==="1"?t=Ze(dt.decode(`z${r}`)).bytes:t=Ct.parse(r).multihash.bytes;let e=Uint8Array.from(Gt(t.length));return St([e,t],e.length+t.length)}function Ip(r){let t=Bp.decode(r),e=Uint8Array.from(Gt(t.length));return St([e,t],e.length+t.length)}function kp(r){let t=Te(r),e=r.slice($t(t));if(e.length!==t)throw new Error("inconsistent lengths");return"u"+j(e,"base64url")}function Rp(r){let t=Te(r),e=r.slice($t(t));if(e.length!==t)throw new Error("inconsistent lengths");return j(e,"base58btc")}function Np(r){let t=r.split(":");if(t.length!==2)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(t[0].length!==16)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion address.`);let e=fe.decode("b"+t[0]),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let s=Do(n);return St([e,s],e.length+s.length)}function _p(r){let t=r.split(":");if(t.length!==2)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(t[0].length!==56)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion3 address.`);let e=fe.decode(`b${t[0]}`),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let s=Do(n);return St([e,s],e.length+s.length)}function $l(r){let t=r.slice(0,r.length-2),e=r.slice(r.length-2),n=j(t,"base32"),s=Gl(e);return`${n}:${s}`}function zl(r){r=Oo(r);let t=[],e=[],n=null,s=r.split("/").slice(1);if(s.length===1&&s[0]==="")return{bytes:new Uint8Array,string:"/",tuples:[],stringTuples:[],path:null};for(let i=0;i<s.length;i++){let o=s[i],a=J(o);if(a.size===0){t.push([a.code]),e.push([a.code]);continue}if(i++,i>=s.length)throw Wl("invalid address: "+r);if(a.path===!0){n=Oo(s.slice(i).join("/")),t.push([a.code,Uo(a.code,n)]),e.push([a.code,n]);break}let c=Uo(a.code,s[i]);t.push([a.code,c]),e.push([a.code,Co(a.code,c)])}return{string:jl(e),bytes:Vo(t),tuples:t,stringTuples:e,path:n}}function Po(r){let t=[],e=[],n=null,s=0;for(;s<r.length;){let i=Te(r,s),o=$t(i),a=J(i),c=Lp(a,r.slice(s+o));if(c===0){t.push([i]),e.push([i]),s+=o;continue}let f=r.slice(s+o,s+o+c);if(s+=c+o,s>r.length)throw Wl("Invalid address Uint8Array: "+j(r,"base16"));t.push([i,f]);let u=Co(i,f);if(e.push([i,u]),a.path===!0){n=u;break}}return{bytes:Uint8Array.from(r),string:jl(e),tuples:t,stringTuples:e,path:n}}function jl(r){let t=[];return r.map(e=>{let n=J(e[0]);return t.push(n.name),e.length>1&&e[1]!=null&&t.push(e[1]),null}),Oo(t.join("/"))}function Vo(r){return St(r.map(t=>{let e=J(t[0]),n=Uint8Array.from(Gt(e.code));return t.length>1&&t[1]!=null&&(n=St([n,t[1]])),n}))}function Lp(r,t){if(r.size>0)return r.size/8;if(r.size===0)return 0;{let e=Te(t instanceof Uint8Array?t:Uint8Array.from(t));return e+$t(e)}}function Oo(r){return"/"+r.trim().split("/").filter(t=>t).join("/")}function Wl(r){return new Error("Error parsing address: "+r)}var Cp=Symbol.for("nodejs.util.inspect.custom"),Mo=Symbol.for("@multiformats/js-multiaddr/multiaddr"),Up=[J("dns").code,J("dns4").code,J("dns6").code,J("dnsaddr").code],Ds=class r{bytes;#t;#e;#r;#n;[Mo]=!0;constructor(t){t==null&&(t="");let e;if(t instanceof Uint8Array)e=Po(t);else if(typeof t=="string"){if(t.length>0&&t.charAt(0)!=="/")throw new Error(`multiaddr "${t}" must start with a "/"`);e=zl(t)}else if(Zl(t))e=Po(t.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr");this.bytes=e.bytes,this.#t=e.string,this.#e=e.tuples,this.#r=e.stringTuples,this.#n=e.path}toString(){return this.#t}toJSON(){return this.toString()}toOptions(){let t,e,n,s,i="",o=J("tcp"),a=J("udp"),c=J("ip4"),f=J("ip6"),u=J("dns6"),l=J("ip6zone");for(let[b,m]of this.stringTuples())b===l.code&&(i=`%${m??""}`),Up.includes(b)&&(e=o.name,s=443,n=`${m??""}${i}`,t=b===u.code?6:4),(b===o.code||b===a.code)&&(e=J(b).name,s=parseInt(m??"")),(b===c.code||b===f.code)&&(e=J(b).name,n=`${m??""}${i}`,t=b===f.code?6:4);if(t==null||e==null||n==null||s==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:t,host:n,transport:e,port:s}}protos(){return this.#e.map(([t])=>Object.assign({},J(t)))}protoCodes(){return this.#e.map(([t])=>t)}protoNames(){return this.#e.map(([t])=>J(t).name)}tuples(){return this.#e}stringTuples(){return this.#r}encapsulate(t){return t=new r(t),new r(this.toString()+t.toString())}decapsulate(t){let e=t.toString(),n=this.toString(),s=n.lastIndexOf(e);if(s<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${t.toString()}`);return new r(n.slice(0,s))}decapsulateCode(t){let e=this.tuples();for(let n=e.length-1;n>=0;n--)if(e[n][0]===t)return new r(Vo(e.slice(0,n)));return this}getPeerId(){try{let t=[];this.stringTuples().forEach(([n,s])=>{n===Vr.p2p.code&&t.push([n,s]),n===Vr["p2p-circuit"].code&&(t=[])});let e=t.pop();if(e?.[1]!=null){let n=e[1];return n[0]==="Q"||n[0]==="1"?j(dt.decode(`z${n}`),"base58btc"):j(Ct.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){return this.#n}equals(t){return ut(this.bytes,t.bytes)}async resolve(t){let e=this.protos().find(i=>i.resolvable);if(e==null)return[this];let n=Yl.get(e.name);if(n==null)throw new L(`no available resolver for ${e.name}`,"ERR_NO_AVAILABLE_RESOLVER");return(await n(this,t)).map(i=>new r(i))}nodeAddress(){let t=this.toOptions();if(t.transport!=="tcp"&&t.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${t.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:t.family,address:t.host,port:t.port}}isThinWaistAddress(t){let e=(t??this).protos();return!(e.length!==2||e[0].code!==4&&e[0].code!==41||e[1].code!==6&&e[1].code!==273)}[Cp](){return`Multiaddr(${this.#t})`}};var Yl=new Map;function Zl(r){return!!r?.[Mo]}function kt(r){return new Ds(r)}function Vt(){let r={};return r.promise=new Promise((t,e)=>{r.resolve=t,r.reject=e}),r}var Os=class extends Error{type;code;constructor(t,e){super(t??"The operation was aborted"),this.type="aborted",this.name="AbortError",this.code=e??"ABORT_ERR"}};async function Ps(r,t,e){if(t==null)return r;if(t.aborted)return Promise.reject(new Os(e?.errorMessage,e?.errorCode));let n,s=new Os(e?.errorMessage,e?.errorCode);try{return await Promise.race([r,new Promise((i,o)=>{n=()=>{o(s)},t.addEventListener("abort",n)})])}finally{n!=null&&t.removeEventListener("abort",n)}}var Ho=class{needNext;haveNext;ended;nextResult;constructor(){this.ended=!1,this.needNext=Vt(),this.haveNext=Vt()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("Have next but next was undefined");let t=this.nextResult;return this.nextResult=void 0,this.needNext.resolve(),this.needNext=Vt(),t}async throw(t){return this.ended=!0,t!=null&&this.haveNext.reject(t),{done:!0,value:void 0}}async return(){let t={done:!0,value:void 0};return await this._push(void 0),t}async push(t,e){await this._push(t,e)}async end(t,e){t!=null?await this.throw(t):await this._push(void 0,e)}async _push(t,e){if(t!=null&&this.ended)throw new Error("Cannot push value onto an ended pushable");this.nextResult!=null&&await this.needNext.promise,t!=null?this.nextResult={done:!1,value:t}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=Vt(),await Ps(this.needNext.promise,e?.signal,e)}};function Xl(){return new Ho}var Vs=class extends Error{code;constructor(t,e){super(t),this.code=e}},Fo=class extends Vs{type;constructor(t){super(t,"ABORT_ERR"),this.type="aborted"}};function Jl(r,t){let e=Xl();r.sink(e).catch(async o=>{await e.end(o)}),r.sink=async o=>{for await(let a of o)await e.push(a);await e.end()};let n=r.source;r.source[Symbol.iterator]!=null?n=r.source[Symbol.iterator]():r.source[Symbol.asyncIterator]!=null&&(n=r.source[Symbol.asyncIterator]());let s=new ee;return{read:async(o,a)=>{a?.signal?.throwIfAborted();let c,f=new Promise((u,l)=>{c=()=>{l(new Fo("Read aborted"))},a?.signal?.addEventListener("abort",c)});try{if(o==null){let{done:l,value:h}=await Promise.race([n.next(),f]);return l===!0?new ee:h}for(;s.byteLength<o;){let{value:l,done:h}=await Promise.race([n.next(),f]);if(h===!0)throw new Vs("unexpected end of input","ERR_UNEXPECTED_EOF");s.append(l)}let u=s.sublist(0,o);return s.consume(o),u}finally{c!=null&&a?.signal?.removeEventListener("abort",c)}},write:async(o,a)=>{a?.signal?.throwIfAborted(),o instanceof Uint8Array?await e.push(o,a):await e.push(o.subarray(),a)},unwrap:()=>{if(s.byteLength>0){let o=r.source;r.source=async function*(){t?.yieldBytes===!1?yield s:yield*s,yield*o}()}return r}}}var Ms=class extends Error{code;constructor(t,e){super(t),this.code=e}};function Ql(r,t={}){let e=Jl(r,t);t.maxDataLength!=null&&t.maxLengthLength==null&&(t.maxLengthLength=$t(t.maxDataLength));let n=t?.lengthDecoder??Te,s=t?.lengthEncoder??Gt;return{read:async o=>{let a=-1,c=new ee;for(;;){c.append(await e.read(1,o));try{a=n(c)}catch(f){if(f instanceof RangeError)continue;throw f}if(t?.maxLengthLength!=null&&c.byteLength>t.maxLengthLength)throw new Ms("message length length too long","ERR_MSG_LENGTH_TOO_LONG");if(a>-1)break}if(t?.maxDataLength!=null&&a>t.maxDataLength)throw new Ms("message length too long","ERR_MSG_DATA_TOO_LONG");return e.read(a,o)},write:async(o,a)=>{await e.write(new ee(s(o.byteLength),o),a)},writeV:async(o,a)=>{let c=new ee(...o.flatMap(f=>[s(f.byteLength),f]));await e.write(c,a)},unwrap:()=>e.unwrap()}}function je(r,t){let e=Ql(r,t),n={read:async(s,i)=>{let o=await e.read(i);return s.decode(o)},write:async(s,i,o)=>{await e.write(i.encode(s),o)},writeV:async(s,i,o)=>{await e.writeV(s.map(a=>i.encode(a)),o)},pb:s=>({read:async i=>n.read(s,i),write:async(i,o)=>n.write(i,s,o),writeV:async(i,o)=>n.writeV(i,s,o),unwrap:()=>n}),unwrap:()=>e.unwrap()};return n}var Hs="/libp2p/relay";var tu="circuit-relay-source",eu="circuit-relay-relay";var ru=BigInt(131072),zt="/libp2p/circuit/relay/0.2.0/hop",lr="/libp2p/circuit/relay/0.2.0/stop",nu=30*1e3,su=30*1e3,bn=300,iu="ERR_NO_ROUTERS_AVAILABLE",Ko="ERR_RELAYED_DIAL",ou="ERR_HOP_REQUEST_FAILED",Fs="ERR_TRANSFER_LIMIT_EXCEEDED";var Z;(function(r){let t;(function(s){s.RESERVE="RESERVE",s.CONNECT="CONNECT",s.STATUS="STATUS"})(t=r.Type||(r.Type={}));let e;(function(s){s[s.RESERVE=0]="RESERVE",s[s.CONNECT=1]="CONNECT",s[s.STATUS=2]="STATUS"})(e||(e={})),function(s){s.codec=()=>nr(e)}(t=r.Type||(r.Type={}));let n;r.codec=()=>(n==null&&(n=Pt((s,i,o={})=>{o.lengthDelimited!==!1&&i.fork(),s.type!=null&&(i.uint32(8),r.Type.codec().encode(s.type,i)),s.peer!=null&&(i.uint32(18),Mr.codec().encode(s.peer,i)),s.reservation!=null&&(i.uint32(26),Ks.codec().encode(s.reservation,i)),s.limit!=null&&(i.uint32(34),Hr.codec().encode(s.limit,i)),s.status!=null&&(i.uint32(40),H.codec().encode(s.status,i)),o.lengthDelimited!==!1&&i.ldelim()},(s,i)=>{let o={},a=i==null?s.len:s.pos+i;for(;s.pos<a;){let c=s.uint32();switch(c>>>3){case 1:o.type=r.Type.codec().decode(s);break;case 2:o.peer=Mr.codec().decode(s,s.uint32());break;case 3:o.reservation=Ks.codec().decode(s,s.uint32());break;case 4:o.limit=Hr.codec().decode(s,s.uint32());break;case 5:o.status=H.codec().decode(s);break;default:s.skipType(c&7);break}}return o})),n),r.encode=s=>Ot(s,r.codec()),r.decode=s=>Dt(s,r.codec())})(Z||(Z={}));var Mt;(function(r){let t;(function(s){s.CONNECT="CONNECT",s.STATUS="STATUS"})(t=r.Type||(r.Type={}));let e;(function(s){s[s.CONNECT=0]="CONNECT",s[s.STATUS=1]="STATUS"})(e||(e={})),function(s){s.codec=()=>nr(e)}(t=r.Type||(r.Type={}));let n;r.codec=()=>(n==null&&(n=Pt((s,i,o={})=>{o.lengthDelimited!==!1&&i.fork(),s.type!=null&&(i.uint32(8),r.Type.codec().encode(s.type,i)),s.peer!=null&&(i.uint32(18),Mr.codec().encode(s.peer,i)),s.limit!=null&&(i.uint32(26),Hr.codec().encode(s.limit,i)),s.status!=null&&(i.uint32(32),H.codec().encode(s.status,i)),o.lengthDelimited!==!1&&i.ldelim()},(s,i)=>{let o={},a=i==null?s.len:s.pos+i;for(;s.pos<a;){let c=s.uint32();switch(c>>>3){case 1:o.type=r.Type.codec().decode(s);break;case 2:o.peer=Mr.codec().decode(s,s.uint32());break;case 3:o.limit=Hr.codec().decode(s,s.uint32());break;case 4:o.status=H.codec().decode(s);break;default:s.skipType(c&7);break}}return o})),n),r.encode=s=>Ot(s,r.codec()),r.decode=s=>Dt(s,r.codec())})(Mt||(Mt={}));var Mr;(function(r){let t;r.codec=()=>(t==null&&(t=Pt((e,n,s={})=>{if(s.lengthDelimited!==!1&&n.fork(),e.id!=null&&e.id.byteLength>0&&(n.uint32(10),n.bytes(e.id)),e.addrs!=null)for(let i of e.addrs)n.uint32(18),n.bytes(i);s.lengthDelimited!==!1&&n.ldelim()},(e,n)=>{let s={id:new Uint8Array(0),addrs:[]},i=n==null?e.len:e.pos+n;for(;e.pos<i;){let o=e.uint32();switch(o>>>3){case 1:s.id=e.bytes();break;case 2:s.addrs.push(e.bytes());break;default:e.skipType(o&7);break}}return s})),t),r.encode=e=>Ot(e,r.codec()),r.decode=e=>Dt(e,r.codec())})(Mr||(Mr={}));var Ks;(function(r){let t;r.codec=()=>(t==null&&(t=Pt((e,n,s={})=>{if(s.lengthDelimited!==!1&&n.fork(),e.expire!=null&&e.expire!==0n&&(n.uint32(8),n.uint64(e.expire)),e.addrs!=null)for(let i of e.addrs)n.uint32(18),n.bytes(i);e.voucher!=null&&(n.uint32(26),n.bytes(e.voucher)),s.lengthDelimited!==!1&&n.ldelim()},(e,n)=>{let s={expire:0n,addrs:[]},i=n==null?e.len:e.pos+n;for(;e.pos<i;){let o=e.uint32();switch(o>>>3){case 1:s.expire=e.uint64();break;case 2:s.addrs.push(e.bytes());break;case 3:s.voucher=e.bytes();break;default:e.skipType(o&7);break}}return s})),t),r.encode=e=>Ot(e,r.codec()),r.decode=e=>Dt(e,r.codec())})(Ks||(Ks={}));var Hr;(function(r){let t;r.codec=()=>(t==null&&(t=Pt((e,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),e.duration!=null&&(n.uint32(8),n.uint32(e.duration)),e.data!=null&&(n.uint32(16),n.uint64(e.data)),s.lengthDelimited!==!1&&n.ldelim()},(e,n)=>{let s={},i=n==null?e.len:e.pos+n;for(;e.pos<i;){let o=e.uint32();switch(o>>>3){case 1:s.duration=e.uint32();break;case 2:s.data=e.uint64();break;default:e.skipType(o&7);break}}return s})),t),r.encode=e=>Ot(e,r.codec()),r.decode=e=>Dt(e,r.codec())})(Hr||(Hr={}));var H;(function(r){r.UNUSED="UNUSED",r.OK="OK",r.RESERVATION_REFUSED="RESERVATION_REFUSED",r.RESOURCE_LIMIT_EXCEEDED="RESOURCE_LIMIT_EXCEEDED",r.PERMISSION_DENIED="PERMISSION_DENIED",r.CONNECTION_FAILED="CONNECTION_FAILED",r.NO_RESERVATION="NO_RESERVATION",r.MALFORMED_MESSAGE="MALFORMED_MESSAGE",r.UNEXPECTED_MESSAGE="UNEXPECTED_MESSAGE"})(H||(H={}));var qo;(function(r){r[r.UNUSED=0]="UNUSED",r[r.OK=100]="OK",r[r.RESERVATION_REFUSED=200]="RESERVATION_REFUSED",r[r.RESOURCE_LIMIT_EXCEEDED=201]="RESOURCE_LIMIT_EXCEEDED",r[r.PERMISSION_DENIED=202]="PERMISSION_DENIED",r[r.CONNECTION_FAILED=203]="CONNECTION_FAILED",r[r.NO_RESERVATION=204]="NO_RESERVATION",r[r.MALFORMED_MESSAGE=400]="MALFORMED_MESSAGE",r[r.UNEXPECTED_MESSAGE=401]="UNEXPECTED_MESSAGE"})(qo||(qo={}));(function(r){r.codec=()=>nr(qo)})(H||(H={}));var qs;(function(r){let t;r.codec=()=>(t==null&&(t=Pt((e,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),e.relay!=null&&e.relay.byteLength>0&&(n.uint32(10),n.bytes(e.relay)),e.peer!=null&&e.peer.byteLength>0&&(n.uint32(18),n.bytes(e.peer)),e.expiration!=null&&e.expiration!==0n&&(n.uint32(24),n.uint64(e.expiration)),s.lengthDelimited!==!1&&n.ldelim()},(e,n)=>{let s={relay:new Uint8Array(0),peer:new Uint8Array(0),expiration:0n},i=n==null?e.len:e.pos+n;for(;e.pos<i;){let o=e.uint32();switch(o>>>3){case 1:s.relay=e.bytes();break;case 2:s.peer=e.bytes();break;case 3:s.expiration=e.uint64();break;default:e.skipType(o&7);break}}return s})),t),r.encode=e=>Ot(e,r.codec()),r.decode=e=>Dt(e,r.codec())})(qs||(qs={}));function au(r){let t=new globalThis.AbortController;function e(){t.abort();for(let i of r)i?.removeEventListener!=null&&i.removeEventListener("abort",e)}for(let i of r){if(i?.aborted===!0){e();break}i?.addEventListener!=null&&i.addEventListener("abort",e)}function n(){for(let i of r)i?.removeEventListener!=null&&i.removeEventListener("abort",e)}let s=t.signal;return s.clear=n,s}async function*cu(r,t,e){let n=t.remaining;for await(let s of r){let i=BigInt(s.byteLength);if(t.remaining-i<0){let o=Number(t.remaining);t.remaining=0n;try{o!==0&&(yield s.subarray(0,o))}catch(a){e.log.error(a)}throw new L(`data limit of ${n} bytes exceeded`,Fs)}t.remaining-=i,yield s}}function lu(r,t,e,n,s){function i(l){r.abort(l),t.abort(l)}let o=[e];n?.duration!=null&&o.push(AbortSignal.timeout(n.duration));let a=au(o),c=!1,f=!1,u;n?.data!=null&&(u={remaining:n.data}),queueMicrotask(()=>{let l=()=>{t.abort(new L(`duration limit of ${n?.duration} ms exceeded`,Fs))};a.addEventListener("abort",l,{once:!0}),t.sink(u==null?r.source:cu(r.source,u,s)).catch(h=>{s.log.error("error while relaying streams src -> dst",h),i(h)}).finally(()=>{c=!0,f&&(a.removeEventListener("abort",l),a.clear())})}),queueMicrotask(()=>{let l=()=>{r.abort(new L(`duration limit of ${n?.duration} ms exceeded`,Fs))};a.addEventListener("abort",l,{once:!0}),r.sink(u==null?t.source:cu(t.source,u,s)).catch(h=>{s.log.error("error while relaying streams dst -> src",h),i(h)}).finally(()=>{f=!0,c&&(a.removeEventListener("abort",l),a.clear())})})}async function $s(r){let t=new TextEncoder().encode(r),e=await pt.digest(t);return Ct.createV0(e)}function $o(r){let t=r*BigInt(1e3),e=new Date().getTime();return Number(t-BigInt(e))}var gu=ma(pu(),1);var Op=Object.prototype.toString,Pp=r=>Op.call(r)==="[object Error]",Vp=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Load failed","Network request failed","fetch failed"]);function Go(r){return r&&Pp(r)&&r.name==="TypeError"&&typeof r.message=="string"?r.message==="Load failed"?r.stack===void 0:Vp.has(r.message):!1}var zo=class extends Error{constructor(t){super(),t instanceof Error?(this.originalError=t,{message:t}=t):(this.originalError=new Error(t),this.originalError.stack=this.stack),this.name="AbortError",this.message=t}},mu=(r,t,e)=>{let n=e.retries-(t-1);return r.attemptNumber=t,r.retriesLeft=n,r};async function jo(r,t){return new Promise((e,n)=>{t={onFailedAttempt(){},retries:10,shouldRetry:()=>!0,...t};let s=gu.default.operation(t),i=()=>{s.stop(),n(t.signal?.reason)};t.signal&&!t.signal.aborted&&t.signal.addEventListener("abort",i,{once:!0});let o=()=>{t.signal?.removeEventListener("abort",i),s.stop()};s.attempt(async a=>{try{let c=await r(a);o(),e(c)}catch(c){try{if(!(c instanceof Error))throw new TypeError(`Non-error was thrown: "${c}". You should only throw errors.`);if(c instanceof zo)throw c.originalError;if(c instanceof TypeError&&!Go(c))throw c;if(mu(c,a,t),await t.shouldRetry(c)||(s.stop(),n(c)),await t.onFailedAttempt(c),!s.retry(c))throw s.mainError()}catch(f){mu(f,a,t),o(),n(f)}}})})}var Gs=class extends Rt{contentRouting;timeout;started;bootDelay;log;constructor(t,e){super(),this.log=t.logger.forComponent("libp2p:circuit-relay:advert-service"),this.contentRouting=t.contentRouting,this.bootDelay=e?.bootDelay??su,this.started=!1}isStarted(){return this.started}start(){this.started||(this.timeout=setTimeout(()=>{this._advertiseService().catch(t=>{this.log.error("could not advertise service",t)})},this.bootDelay),this.started=!0)}stop(){try{clearTimeout(this.timeout)}catch{}this.started=!1}async _advertiseService(){await jo(async()=>{try{let t=await $s(Hs);await this.contentRouting.provide(t),this.safeDispatchEvent("advert:success",{detail:void 0})}catch(t){if(this.safeDispatchEvent("advert:error",{detail:t}),t.code===iu){this.log.error("a content router, such as a DHT, must be provided in order to advertise the relay service",t),this.stop();return}throw this.log.error("could not advertise service",t),t}})}};function Wo(r,t){let e={[Symbol.iterator]:()=>e,next:()=>{let n=r.next(),s=n.value;return n.done===!0||s==null?{done:!0,value:void 0}:{done:!1,value:t(s)}}};return e}var Ie=class{map;constructor(t){if(this.map=new Map,t!=null)for(let[e,n]of t.entries())this.map.set(e.toString(),n)}[Symbol.iterator](){return this.entries()}clear(){this.map.clear()}delete(t){return this.map.delete(t.toString())}entries(){return Wo(this.map.entries(),t=>[Ce(t[0]),t[1]])}forEach(t){this.map.forEach((e,n)=>{t(e,Ce(n),this)})}get(t){return this.map.get(t.toString())}has(t){return this.map.has(t.toString())}set(t,e){this.map.set(t.toString(),e)}keys(){return Wo(this.map.keys(),t=>Ce(t))}values(){return this.map.values()}get size(){return this.map.size}};var zs=class{reservations=new Ie;_started=!1;interval;maxReservations;reservationClearInterval;applyDefaultLimit;reservationTtl;defaultDurationLimit;defaultDataLimit;constructor(t={}){this.maxReservations=t.maxReservations??15,this.reservationClearInterval=t.reservationClearInterval??3e5,this.applyDefaultLimit=t.applyDefaultLimit!==!1,this.reservationTtl=t.reservationTtl??72e5,this.defaultDurationLimit=t.defaultDurationLimit??12e4,this.defaultDataLimit=t.defaultDataLimit??ru}isStarted(){return this._started}start(){this._started||(this._started=!0,this.interval=setInterval(()=>{let t=new Date().getTime();this.reservations.forEach((e,n)=>{e.expire.getTime()<t&&this.reservations.delete(n)})},this.reservationClearInterval))}stop(){clearInterval(this.interval)}reserve(t,e,n){if(this.reservations.size>=this.maxReservations&&!this.reservations.has(t))return{status:H.RESERVATION_REFUSED};let s=new Date(Date.now()+this.reservationTtl),i;return this.applyDefaultLimit&&(i=n??{data:this.defaultDataLimit,duration:this.defaultDurationLimit}),this.reservations.set(t,{addr:e,expire:s,limit:i}),{status:H.OK,expire:Math.round(s.getTime()/1e3)}}removeReservation(t){this.reservations.delete(t)}hasReservation(t){return this.reservations.has(t)}get(t){return this.reservations.get(t)}};var js=class r{domain="libp2p-relay-rsvp";codec=new Uint8Array([3,2]);relay;peer;expiration;constructor({relay:t,peer:e,expiration:n}){this.relay=t,this.peer=e,this.expiration=n}marshal(){return qs.encode({relay:this.relay.toBytes(),peer:this.peer.toBytes(),expiration:BigInt(this.expiration)})}equals(t){return!(!(t instanceof r)||!this.peer.equals(t.peer)||!this.relay.equals(t.relay)||this.expiration!==t.expiration)}};var yu=r=>r.protoCodes().includes(290),qp={maxOutboundStopStreams:bn},Yo=class extends Rt{registrar;peerStore;addressManager;peerId;connectionManager;connectionGater;reservationStore;advertService;started;hopTimeout;shutdownController;maxInboundHopStreams;maxOutboundHopStreams;maxOutboundStopStreams;log;constructor(t,e={}){super(),this.log=t.logger.forComponent("libp2p:circuit-relay:server"),this.registrar=t.registrar,this.peerStore=t.peerStore,this.addressManager=t.addressManager,this.peerId=t.peerId,this.connectionManager=t.connectionManager,this.connectionGater=t.connectionGater,this.started=!1,this.hopTimeout=e?.hopTimeout??nu,this.shutdownController=new AbortController,this.maxInboundHopStreams=e.maxInboundHopStreams,this.maxOutboundHopStreams=e.maxOutboundHopStreams,this.maxOutboundStopStreams=e.maxOutboundStopStreams??qp.maxOutboundStopStreams,vn(1/0,this.shutdownController.signal),e.advertise!=null&&e.advertise!==!1&&(this.advertService=new Gs(t,e.advertise===!0?void 0:e.advertise),this.advertService.addEventListener("advert:success",()=>{this.safeDispatchEvent("relay:advert:success",{})}),this.advertService.addEventListener("advert:error",n=>{this.safeDispatchEvent("relay:advert:error",{detail:n.detail})})),this.reservationStore=new zs(e.reservations)}isStarted(){return this.started}async start(){this.started||(this.advertService?.start(),await this.registrar.handle(zt,t=>{this.onHop(t).catch(e=>{this.log.error(e)})},{maxInboundStreams:this.maxInboundHopStreams,maxOutboundStreams:this.maxOutboundHopStreams,runOnTransientConnection:!0}),this.reservationStore.start(),this.started=!0)}async stop(){this.advertService?.stop(),this.reservationStore.stop(),this.shutdownController.abort(),await this.registrar.unhandle(zt),this.started=!1}async onHop({connection:t,stream:e}){this.log("received circuit v2 hop protocol stream from %p",t.remotePeer);let n=Vt(),s=setTimeout(()=>{n.reject("timed out")},this.hopTimeout),i=je(e);try{let o=await Promise.race([i.pb(Z).read(),n.promise]);if(o?.type==null)throw new Error("request was invalid, could not read from stream");this.log("received",o.type),await Promise.race([this.handleHopProtocol({connection:t,stream:i,request:o}),n.promise])}catch(o){this.log.error("error while handling hop",o),await i.pb(Z).write({type:Z.Type.STATUS,status:H.MALFORMED_MESSAGE}),e.abort(o)}finally{clearTimeout(s)}}async handleHopProtocol({stream:t,request:e,connection:n}){switch(this.log("received hop message"),e.type){case Z.Type.RESERVE:await this.handleReserve({stream:t,request:e,connection:n});break;case Z.Type.CONNECT:await this.handleConnect({stream:t,request:e,connection:n});break;default:this.log.error("invalid hop request type %s via peer %p",e.type,n.remotePeer),await t.pb(Z).write({type:Z.Type.STATUS,status:H.UNEXPECTED_MESSAGE})}}async handleReserve({stream:t,request:e,connection:n}){let s=t.pb(Z);if(this.log("hop reserve request from %p",n.remotePeer),yu(n.remoteAddr)){this.log.error("relay reservation over circuit connection denied for peer: %p",n.remotePeer),await s.write({type:Z.Type.STATUS,status:H.PERMISSION_DENIED});return}if(await this.connectionGater.denyInboundRelayReservation?.(n.remotePeer)===!0){this.log.error("reservation for %p denied by connection gater",n.remotePeer),await s.write({type:Z.Type.STATUS,status:H.PERMISSION_DENIED});return}let i=this.reservationStore.reserve(n.remotePeer,n.remoteAddr);if(i.status!==H.OK){await s.write({type:Z.Type.STATUS,status:i.status});return}try{if(i.expire!=null){let o=i.expire*1e3-Date.now();await this.peerStore.merge(n.remotePeer,{tags:{[tu]:{value:1,ttl:o}}})}await s.write({type:Z.Type.STATUS,status:H.OK,reservation:await this.makeReservation(n.remotePeer,BigInt(i.expire??0)),limit:this.reservationStore.get(n.remotePeer)?.limit}),this.log("sent confirmation response to %s",n.remotePeer)}catch(o){this.log.error("failed to send confirmation response to %p",n.remotePeer,o),this.reservationStore.removeReservation(n.remotePeer)}}async makeReservation(t,e){let n=[];for(let i of this.addressManager.getAddresses())i.toString().includes("/p2p-circuit")||n.push(i.bytes);let s=await yn.seal(new js({peer:t,relay:this.peerId,expiration:Number(e)}),this.peerId);return{addrs:n,expire:e,voucher:s.marshal()}}async handleConnect({stream:t,request:e,connection:n}){let s=t.pb(Z);if(yu(n.remoteAddr)){this.log.error("relay reservation over circuit connection denied for peer: %p",n.remotePeer),await s.write({type:Z.Type.STATUS,status:H.PERMISSION_DENIED});return}this.log("hop connect request from %p",n.remotePeer);let i;try{if(e.peer==null)throw this.log.error("no peer info in hop connect request"),new Error("no peer info in request");e.peer.addrs.forEach(kt),i=Wr(e.peer.id)}catch(l){this.log.error("invalid hop connect request via peer %p %s",n.remotePeer,l),await s.write({type:Z.Type.STATUS,status:H.MALFORMED_MESSAGE});return}if(!this.reservationStore.hasReservation(i)){this.log.error("hop connect denied for destination peer %p not having a reservation for %p with status %s",i,n.remotePeer,H.NO_RESERVATION),await s.write({type:Z.Type.STATUS,status:H.NO_RESERVATION});return}if(await this.connectionGater.denyOutboundRelayedConnection?.(n.remotePeer,i)===!0){this.log.error("hop connect for %p to %p denied by connection gater",n.remotePeer,i),await s.write({type:Z.Type.STATUS,status:H.PERMISSION_DENIED});return}let o=this.connectionManager.getConnections(i);if(o.length===0){this.log("hop connect denied for destination peer %p not having a connection for %p as there is no destination connection",i,n.remotePeer),await s.write({type:Z.Type.STATUS,status:H.NO_RESERVATION});return}let a=o[0],c=await this.stopHop({connection:a,request:{type:Mt.Type.CONNECT,peer:{id:n.remotePeer.toBytes(),addrs:[]}}});if(c==null){this.log.error("failed to open stream to destination peer %p",a?.remotePeer),await s.write({type:Z.Type.STATUS,status:H.CONNECTION_FAILED});return}await s.write({type:Z.Type.STATUS,status:H.OK});let f=t.unwrap();this.log("connection from %p to %p established - merging streams",n.remotePeer,i);let u=this.reservationStore.get(i)?.limit;lu(f,c,this.shutdownController.signal,u,{log:this.log})}async stopHop({connection:t,request:e}){this.log("starting circuit relay v2 stop request to %s",t.remotePeer);let n=await t.newStream([lr],{maxOutboundStreams:this.maxOutboundStopStreams,runOnTransientConnection:!0}),s=je(n),i=s.pb(Mt);await i.write(e);let o;try{o=await i.read()}catch{this.log.error("error parsing stop message response from %p",t.remotePeer)}if(o==null){this.log.error("could not read response from %p",t.remotePeer),await n.close();return}if(o.status===H.OK)return this.log("stop request to %p was successful",t.remotePeer),s.unwrap();this.log("stop request failed with code %d",o.status),await n.close()}get reservations(){return this.reservationStore.reservations}};function bu(r={}){return t=>new Yo(t,r)}var Ws=class extends Rt{peerId;peerStore;contentRouting;registrar;started;topologyId;log;constructor(t){super(),this.log=t.logger.forComponent("libp2p:circuit-relay:discover-relays"),this.started=!1,this.peerId=t.peerId,this.peerStore=t.peerStore,this.contentRouting=t.contentRouting,this.registrar=t.registrar}isStarted(){return this.started}async start(){this.topologyId=await this.registrar.register(zt,{notifyOnTransient:!0,onConnect:t=>{this.safeDispatchEvent("relay:discover",{detail:t})}}),this.started=!0}afterStart(){this.discover().catch(t=>{this.log.error("error discovering relays",t)})}stop(){this.topologyId!=null&&this.registrar.unregister(this.topologyId),this.started=!1}async discover(){this.log("searching peer store for relays");let t=await this.peerStore.all({filters:[e=>e.protocols.includes(zt)],orders:[()=>Math.random()<.5?1:-1]});for(let e of t)this.log("found relay peer %p in content peer store",e.id),this.safeDispatchEvent("relay:discover",{detail:e.id});this.log("found %d relay peers in peer store",t.length);try{this.log("searching content routing for relays");let e=await $s(Hs),n=0;for await(let s of this.contentRouting.findProviders(e))if(s.multiaddrs.length>0&&!s.id.equals(this.peerId)){let i=s.id;n++,await this.peerStore.merge(i,{multiaddrs:s.multiaddrs}),this.log("found relay peer %p in content routing",i),this.safeDispatchEvent("relay:discover",{detail:i})}this.log("found %d relay peers in content routing",n)}catch(e){this.log.error("failed when finding relays on the network",e)}}};var Ys=class{buffer;mask;top;btm;next;constructor(t){if(!(t>0)||t-1&t)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(t),this.mask=t-1,this.top=0,this.btm=0,this.next=null}push(t){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=t,this.top=this.top+1&this.mask,!0)}shift(){let t=this.buffer[this.btm];if(t!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,t}isEmpty(){return this.buffer[this.btm]===void 0}},Fr=class{size;hwm;head;tail;constructor(t={}){this.hwm=t.splitLimit??16,this.head=new Ys(this.hwm),this.tail=this.head,this.size=0}calculateSize(t){return t?.byteLength!=null?t.byteLength:1}push(t){if(t?.value!=null&&(this.size+=this.calculateSize(t.value)),!this.head.push(t)){let e=this.head;this.head=e.next=new Ys(2*this.head.buffer.length),this.head.push(t)}}shift(){let t=this.tail.shift();if(t===void 0&&this.tail.next!=null){let e=this.tail.next;this.tail.next=null,this.tail=e,t=this.tail.shift()}return t?.value!=null&&(this.size-=this.calculateSize(t.value)),t}isEmpty(){return this.head.isEmpty()}};var Xo=class extends Error{type;code;constructor(t,e){super(t??"The operation was aborted"),this.type="aborted",this.code=e??"ABORT_ERR"}};function wu(r={}){return $p(e=>{let n=e.shift();if(n==null)return{done:!0};if(n.error!=null)throw n.error;return{done:n.done===!0,value:n.value}},r)}function $p(r,t){t=t??{};let e=t.onEnd,n=new Fr,s,i,o,a=Vt(),c=async()=>{try{return n.isEmpty()?o?{done:!0}:await new Promise((p,y)=>{i=A=>{i=null,n.push(A);try{p(r(n))}catch(w){y(w)}return s}}):r(n)}finally{n.isEmpty()&&queueMicrotask(()=>{a.resolve(),a=Vt()})}},f=p=>i!=null?i(p):(n.push(p),s),u=p=>(n=new Fr,i!=null?i({error:p}):(n.push({error:p}),s)),l=p=>{if(o)return s;if(t?.objectMode!==!0&&p?.byteLength==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return f({done:!1,value:p})},h=p=>o?s:(o=!0,p!=null?u(p):f({done:!0})),b=()=>(n=new Fr,h(),{done:!0}),m=p=>(h(p),{done:!0});if(s={[Symbol.asyncIterator](){return this},next:c,return:b,throw:m,push:l,end:h,get readableLength(){return n.size},onEmpty:async p=>{let y=p?.signal;if(y?.throwIfAborted(),n.isEmpty())return;let A,w;y!=null&&(A=new Promise((_,x)=>{w=()=>{x(new Xo)},y.addEventListener("abort",w)}));try{await Promise.race([a.promise,A])}finally{w!=null&&y!=null&&y?.removeEventListener("abort",w)}}},e==null)return s;let d=s;return s={[Symbol.asyncIterator](){return this},next(){return d.next()},throw(p){return d.throw(p),e!=null&&(e(p),e=void 0),{done:!0}},return(){return d.return(),e!=null&&(e(),e=void 0),{done:!0}},push:l,end(p){return d.end(p),e!=null&&(e(p),e=void 0),s},get readableLength(){return d.readableLength},onEmpty:p=>d.onEmpty(p)},s}var Jo=class extends Error{type;code;constructor(t,e){super(t??"The operation was aborted"),this.type="aborted",this.name="AbortError",this.code=e??"ABORT_ERR"}};async function Zs(r,t,e,n){let s=new Jo(n?.errorMessage,n?.errorCode);return e?.aborted===!0?Promise.reject(s):new Promise((i,o)=>{let a=f=>{n?.filter?.(f)!==!1&&(r.removeEventListener(t,a),e?.removeEventListener("abort",c),i(f))},c=()=>{r.removeEventListener(t,a),e?.removeEventListener("abort",c),o(s)};r.addEventListener(t,a),e?.addEventListener("abort",c)})}var Xs=class{deferred;signal;where;constructor(t,e){this.signal=e,this.deferred=Vt(),this.where=t,this.onAbort=this.onAbort.bind(this),this.signal?.addEventListener("abort",this.onAbort)}onAbort(){this.deferred.reject(new Re)}cleanup(){this.signal?.removeEventListener("abort",this.onAbort)}};function Gp(){return`${parseInt(String(Math.random()*1e9),10).toString()}${Date.now()}`}var Js=class{id;fn;options;priority;recipients;status;timeline;controller;constructor(t,e,n=0){this.id=Gp(),this.status="queued",this.fn=t,this.priority=n,this.options=e,this.recipients=[],this.timeline={created:Date.now()},this.controller=new AbortController,vn(1/0,this.controller.signal),this.onAbort=this.onAbort.bind(this)}abort(t){this.controller.abort(t)}onAbort(){this.recipients.reduce((e,n)=>e&&n.signal?.aborted===!0,!0)&&this.controller.abort(new Re)}async join(t={}){let e=new Xs(new Error("where").stack,t.signal);return this.recipients.push(e),t.signal?.addEventListener("abort",this.onAbort),e.deferred.promise}async run(){this.status="running",this.timeline.started=Date.now();try{this.controller.signal.throwIfAborted();let t=await Ps(this.fn({...this.options??{},signal:this.controller.signal}),this.controller.signal);this.recipients.forEach(e=>{e.deferred.resolve(t)}),this.status="complete"}catch(t){this.recipients.forEach(e=>{e.deferred.reject(t)}),this.status="errored"}finally{this.timeline.finished=Date.now(),this.cleanup()}}cleanup(){this.recipients.forEach(t=>{t.signal?.removeEventListener("abort",this.onAbort)})}};function zp(r,t,e){let n=0,s=r.length;for(;s>0;){let i=Math.trunc(s/2),o=n+i;e(r[o],t)<=0?(n=++o,s-=i+1):s=i}return n}var Qs=class extends Rt{concurrency;queue;pending;constructor(t={}){super(),this.concurrency=t.concurrency??Number.POSITIVE_INFINITY,this.pending=0,t.metricName!=null&&t.metrics?.registerMetricGroup(t.metricName,{calculate:()=>({size:this.queue.length,running:this.pending,queued:this.queue.length-this.pending})}),this.queue=[]}tryToStartAnother(){if(this.size===0)return queueMicrotask(()=>{this.safeDispatchEvent("empty")}),this.running===0&&queueMicrotask(()=>{this.safeDispatchEvent("idle")}),!1;if(this.pending<this.concurrency){let t;for(let e of this.queue)if(e.status==="queued"){t=e;break}return t==null?!1:(this.safeDispatchEvent("active"),this.pending++,t.run().finally(()=>{for(let e=0;e<this.queue.length;e++)if(this.queue[e]===t){this.queue.splice(e,1);break}this.pending--,this.tryToStartAnother(),this.safeDispatchEvent("next")}),!0)}return!1}enqueue(t){if(this.queue[this.size-1]?.priority>=t.priority){this.queue.push(t);return}let e=zp(this.queue,t,(n,s)=>s.priority-n.priority);this.queue.splice(e,0,t)}async add(t,e){e?.signal?.throwIfAborted();let n=new Js(t,e,e?.priority),s=n.join(e).then(i=>(this.safeDispatchEvent("completed",{detail:i}),i)).catch(i=>{throw this.safeDispatchEvent("error",{detail:i}),i});return this.enqueue(n),this.safeDispatchEvent("add"),this.tryToStartAnother(),s}clear(){this.queue.splice(0,this.queue.length)}abort(){this.queue.forEach(t=>{t.abort(new Re)}),this.clear()}async onEmpty(t){this.size!==0&&await Zs(this,"empty",t?.signal)}async onSizeLessThan(t,e){this.size<t||await Zs(this,"next",e?.signal,{filter:()=>this.size<t})}async onIdle(t){this.pending===0&&this.size===0||await Zs(this,"idle",t?.signal)}get size(){return this.queue.length}get queued(){return this.queue.length-this.pending}get running(){return this.pending}async*toGenerator(t){t?.signal?.throwIfAborted();let e=wu({objectMode:!0}),n=c=>{c!=null?this.abort():this.clear(),e.end(c)},s=c=>{c.detail!=null&&e.push(c.detail)},i=c=>{n(c.detail)},o=()=>{n()},a=()=>{n(new L("Queue aborted","ERR_QUEUE_ABORTED"))};this.addEventListener("completed",s),this.addEventListener("error",i),this.addEventListener("idle",o),t?.signal?.addEventListener("abort",a);try{yield*e}finally{this.removeEventListener("completed",s),this.removeEventListener("error",i),this.removeEventListener("idle",o),t?.signal?.removeEventListener("abort",a),n()}}};var ti=class extends Qs{has(t){return this.find(t)!=null}find(t){return this.queue.find(e=>t.equals(e.options.peerId))}};var Wp=60*1e3*10,Yp=60*1e3*5,Zp=30*1e3,ei=class extends Rt{peerId;connectionManager;transportManager;peerStore;events;reserveQueue;reservations;maxDiscoveredRelays;maxReservationQueueLength;reservationCompletionTimeout;started;log;constructor(t,e){super(),this.log=t.logger.forComponent("libp2p:circuit-relay:transport:reservation-store"),this.peerId=t.peerId,this.connectionManager=t.connectionManager,this.transportManager=t.transportManager,this.peerStore=t.peerStore,this.events=t.events,this.reservations=new Ie,this.maxDiscoveredRelays=e?.discoverRelays??0,this.maxReservationQueueLength=e?.maxReservationQueueLength??100,this.reservationCompletionTimeout=e?.reservationCompletionTimeout??1e4,this.started=!1,this.reserveQueue=new ti({concurrency:e?.reservationConcurrency??1,metricName:"libp2p_relay_reservation_queue",metrics:t.metrics}),this.events.addEventListener("peer:disconnect",n=>{this.#e(n.detail)})}isStarted(){return this.started}start(){this.started=!0}stop(){this.reserveQueue.clear(),this.reservations.forEach(({timeout:t})=>{clearTimeout(t)}),this.reservations.clear(),this.started=!1}async addRelay(t,e){if(this.peerId.equals(t)){this.log("not trying to use self as relay");return}if(this.reserveQueue.size>this.maxReservationQueueLength){this.log("not adding relay as the queue is full");return}if(this.reserveQueue.has(t)){this.log("relay peer is already in the reservation queue");return}this.log("add relay %p",t),await this.reserveQueue.add(async()=>{try{let n=this.reservations.get(t);if(n!=null){if($o(n.reservation.expire)>Wp){this.log("already have reservation on relay peer %p and it expires in more than 10 minutes",t);return}clearTimeout(n.timeout),this.reservations.delete(t)}if(e==="discovered"&&[...this.reservations.values()].reduce((u,l)=>(l.type==="discovered"&&u++,u),0)>=this.maxDiscoveredRelays){this.log("already have enough discovered relays");return}let s=AbortSignal.timeout(this.reservationCompletionTimeout),i=await this.connectionManager.openConnection(t,{signal:s});if(i.remoteAddr.protoNames().includes("p2p-circuit")){this.log("not creating reservation over relayed connection");return}let o=await this.#t(i,{signal:s});this.log("created reservation on relay peer %p",t);let a=$o(o.expire),c=Math.min(Math.max(a-Yp,Zp),Math.pow(2,31)-1),f=setTimeout(()=>{this.addRelay(t,e).catch(u=>{this.log.error("could not refresh reservation to relay %p",t,u)})},c);this.reservations.set(t,{timeout:f,reservation:o,type:e}),await this.peerStore.merge(t,{tags:{[eu]:{value:1,ttl:a}}}),await this.transportManager.listen([kt(`/p2p/${t.toString()}/p2p-circuit`)])}catch(n){this.log.error("could not reserve slot on %p",t,n);let s=this.reservations.get(t);s!=null&&clearTimeout(s.timeout),this.reservations.delete(t)}},{peerId:t})}hasReservation(t){return this.reservations.has(t)}getReservation(t){return this.reservations.get(t)?.reservation}async#t(t,e){e.signal?.throwIfAborted(),this.log("requesting reservation from %p",t.remotePeer);let n=await t.newStream(zt,e),i=je(n).pb(Z);await i.write({type:Z.Type.RESERVE},e);let o;try{o=await i.read(e)}catch(c){throw this.log.error("error parsing reserve message response from %p because",t.remotePeer,c),n.abort(c),c}finally{await n.close()}if(o.status===H.OK&&o.reservation!=null){let c=!1,f=t.remoteAddr.bytes;for(let u of o.reservation.addrs)if(ut(f,u)){c=!0;break}return c||o.reservation.addrs.push(f),o.reservation}let a=`reservation failed with status ${o.status??"undefined"}`;throw this.log.error(a),new Error(a)}#e(t){let e=this.reservations.get(t);e!=null&&(this.log("connection to relay %p closed, removing reservation from local store",t),clearTimeout(e.timeout),this.reservations.delete(t),this.safeDispatchEvent("relay:removed",{detail:t}),this.reservations.size<this.maxDiscoveredRelays&&(this.log("not enough relays %d/%d",this.reservations.size,this.maxDiscoveredRelays),this.safeDispatchEvent("relay:not-enough-relays",{})))}};function Qo(r){let{stream:t,remoteAddr:e,logger:n}=r,s=n.forComponent("libp2p:stream:converter"),i=!1,o=!1,a=t.close.bind(t);t.close=async h=>{await a(h),l(!0)};let c=t.abort.bind(t);t.abort=h=>{c(h),l(!0)};let f=t.sink.bind(t);t.sink=async h=>{try{await f(h)}catch(b){b.type!=="aborted"&&s.error("%s error in sink",e,b)}finally{o=!0,l()}};let u={log:s,sink:t.sink,source:async function*(){try{for await(let h of t.source)h instanceof Uint8Array?yield h:yield*h}finally{i=!0,l()}}(),remoteAddr:e,timeline:{open:Date.now(),close:void 0},close:t.close,abort:t.abort};function l(h){h===!0&&(i=!0,o=!0),i&&o&&u.timeline.close==null&&(u.timeline.close=Date.now())}return u}var Xp=B("dns4"),Jp=B("dns6"),Qp=B("dnsaddr"),fr=at(B("dns"),Qp,Xp,Jp),si=at(B("ip4"),B("ip6")),Kr=at(U(si,B("tcp")),U(fr,B("tcp"))),ii=U(si,B("udp")),t0=U(ii,B("utp")),e0=U(ii,B("quic")),r0=U(ii,B("quic-v1")),ta=at(U(Kr,B("ws")),U(fr,B("ws"))),ri=at(U(ta,B("p2p")),ta),ea=at(U(Kr,B("wss")),U(fr,B("wss")),U(Kr,B("tls"),B("ws")),U(fr,B("tls"),B("ws"))),ni=at(U(ea,B("p2p")),ea),ra=at(U(Kr,B("http")),U(si,B("http")),U(fr,B("http"))),na=at(U(Kr,B("https")),U(si,B("https")),U(fr,B("https"))),xu=U(ii,B("webrtc-direct"),B("certhash")),Au=at(U(xu,B("p2p")),xu),vu=U(r0,B("webtransport"),B("certhash"),B("certhash")),Bu=at(U(vu,B("p2p")),vu),Su=at(U(ri,B("p2p-webrtc-star"),B("p2p")),U(ni,B("p2p-webrtc-star"),B("p2p")),U(ri,B("p2p-webrtc-star")),U(ni,B("p2p-webrtc-star"))),Cv=at(U(ri,B("p2p-websocket-star"),B("p2p")),U(ni,B("p2p-websocket-star"),B("p2p")),U(ri,B("p2p-websocket-star")),U(ni,B("p2p-websocket-star"))),Tu=at(U(ra,B("p2p-webrtc-direct"),B("p2p")),U(na,B("p2p-webrtc-direct"),B("p2p")),U(ra,B("p2p-webrtc-direct")),U(na,B("p2p-webrtc-direct"))),hr=at(ta,ea,ra,na,Su,Tu,Kr,t0,e0,fr,Au,Bu),Uv=at(U(hr,B("p2p-stardust"),B("p2p")),U(hr,B("p2p-stardust"))),We=at(U(hr,B("p2p")),Su,Tu,Au,Bu,B("p2p")),Eu=at(U(We,B("p2p-circuit"),We),U(We,B("p2p-circuit")),U(B("p2p-circuit"),We),U(hr,B("p2p-circuit")),U(B("p2p-circuit"),hr),B("p2p-circuit")),Iu=()=>at(U(Eu,Iu),Eu),ke=Iu(),Dv=at(U(ke,We,ke),U(We,ke),U(ke,We),ke,We);var Ov=at(U(ke,B("webrtc"),B("p2p")),U(ke,B("webrtc")),U(hr,B("webrtc"),B("p2p")),U(hr,B("webrtc")),B("webrtc"));function ku(r){function t(e){let n;try{n=kt(e)}catch{return!1}let s=r(n.protoNames());return s===null?!1:s===!0||s===!1?s:s.length===0}return t}function U(...r){function t(e){if(e.length<r.length)return null;let n=e;return r.some(s=>(n=typeof s=="function"?s().partialMatch(e):s.partialMatch(e),Array.isArray(n)&&(e=n),n===null)),n}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:ku(t),partialMatch:t}}function at(...r){function t(n){let s=null;return r.some(i=>{let o=typeof i=="function"?i().partialMatch(n):i.partialMatch(n);return o!=null?(s=o,!0):!1}),s}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:ku(t),partialMatch:t}}function B(r){let t=r;function e(s){let i;try{i=kt(s)}catch{return!1}let o=i.protoNames();return o.length===1&&o[0]===t}function n(s){return s.length===0?null:s[0]===t?s.slice(1):null}return{toString:function(){return t},matches:e,partialMatch:n}}var sa=class extends Rt{connectionManager;relayStore;listeningAddrs;log;constructor(t){super(),this.log=t.logger.forComponent("libp2p:circuit-relay:transport:listener"),this.connectionManager=t.connectionManager,this.relayStore=t.relayStore,this.listeningAddrs=new Ie,this.relayStore.addEventListener("relay:removed",this._onRemoveRelayPeer)}_onRemoveRelayPeer=t=>{this.#t(t.detail)};async listen(t){this.log("listen on %a",t);let e=t.decapsulate("/p2p-circuit"),n=await this.connectionManager.openConnection(e);if(!this.relayStore.hasReservation(n.remotePeer)){this.log("making reservation on peer %p",n.remotePeer),await this.relayStore.addRelay(n.remotePeer,"configured");return}let s=this.relayStore.getReservation(n.remotePeer);if(s==null)throw new L("Did not have reservation after making reservation","ERR_NO_RESERVATION");if(this.listeningAddrs.has(n.remotePeer)){this.log("already listening on relay %p",n.remotePeer);return}this.listeningAddrs.set(n.remotePeer,s.addrs.map(i=>kt(i).encapsulate("/p2p-circuit"))),this.safeDispatchEvent("listening",{})}getAddrs(){return[...this.listeningAddrs.values()].flat()}async close(){}#t(t){let e=this.listeningAddrs.has(t);this.log("relay peer removed %p - had reservation",t,e),this.listeningAddrs.delete(t),e&&(this.log.trace("removing relay event listener for peer %p",t),this.relayStore.removeEventListener("relay:removed",this._onRemoveRelayPeer),this.safeDispatchEvent("close",{}))}};function Ru(r){return new sa(r)}var s0=r=>{if(r.peer==null)return!1;try{r.peer.addrs.forEach(kt)}catch{return!1}return!0},ia={maxInboundStopStreams:bn,maxOutboundStopStreams:bn,stopTimeout:3e4},oi=class{discovery;registrar;peerStore;connectionManager;transportManager;peerId;upgrader;addressManager;connectionGater;reservationStore;logger;maxInboundStopStreams;maxOutboundStopStreams;stopTimeout;started;log;constructor(t,e){this.log=t.logger.forComponent("libp2p:circuit-relay:transport"),this.registrar=t.registrar,this.peerStore=t.peerStore,this.connectionManager=t.connectionManager,this.transportManager=t.transportManager,this.logger=t.logger,this.peerId=t.peerId,this.upgrader=t.upgrader,this.addressManager=t.addressManager,this.connectionGater=t.connectionGater,this.maxInboundStopStreams=e.maxInboundStopStreams??ia.maxInboundStopStreams,this.maxOutboundStopStreams=e.maxOutboundStopStreams??ia.maxOutboundStopStreams,this.stopTimeout=e.stopTimeout??ia.stopTimeout,e.discoverRelays!=null&&e.discoverRelays>0&&(this.discovery=new Ws(t),this.discovery.addEventListener("relay:discover",n=>{this.reservationStore.addRelay(n.detail,"discovered").catch(s=>{this.log.error("could not add discovered relay %p",n.detail,s)})})),this.reservationStore=new ei(t,e),this.reservationStore.addEventListener("relay:not-enough-relays",()=>{this.discovery?.discover().catch(n=>{this.log.error("could not discover relays",n)})}),this.started=!1}isStarted(){return this.started}async start(){this.reservationStore.start(),await this.registrar.handle(lr,t=>{this.onStop(t).catch(e=>{this.log.error("error while handling STOP protocol",e),t.stream.abort(e)})},{maxInboundStreams:this.maxInboundStopStreams,maxOutboundStreams:this.maxOutboundStopStreams,runOnTransientConnection:!0}),await this.discovery?.start(),this.started=!0}afterStart(){this.discovery?.afterStart()}async stop(){this.discovery?.stop(),this.reservationStore.stop(),await this.registrar.unhandle(lr),this.started=!1}[ba]=!0;[Symbol.toStringTag]="libp2p/circuit-relay-v2";async dial(t,e={}){if(t.protoCodes().filter(m=>m===290).length!==1){let m="Invalid circuit relay address";throw this.log.error(m,t),new L(m,Ko)}let n=t.toString().split("/p2p-circuit"),s=kt(n[0]),i=kt(n[n.length-1]),o=s.getPeerId(),a=i.getPeerId();if(o==null||a==null){let m=`Circuit relay dial to ${t.toString()} failed as address did not have peer ids`;throw this.log.error(m),new L(m,Ko)}let c=Ce(o),f=Ce(a),u=!1,h=this.connectionManager.getConnections(c)[0];h==null&&(await this.peerStore.merge(c,{multiaddrs:[s]}),h=await this.connectionManager.openConnection(c,e),u=!0);let b;try{return b=await h.newStream(zt),await this.connectV2({stream:b,connection:h,destinationPeer:f,destinationAddr:i,relayAddr:s,ma:t,disconnectOnFailure:u})}catch(m){throw this.log.error("circuit relay dial to destination %p via relay %p failed",f,c,m),b?.abort(m),u&&await h.close(),m}}async connectV2({stream:t,connection:e,destinationPeer:n,destinationAddr:s,relayAddr:i,ma:o,disconnectOnFailure:a}){try{let c=je(t),f=c.pb(Z);await f.write({type:Z.Type.CONNECT,peer:{id:n.toBytes(),addrs:[kt(s).bytes]}});let u=await f.read();if(u.status!==H.OK)throw new L(`failed to connect via relay with status ${u?.status?.toString()??"undefined"}`,ou);let l=Qo({stream:c.unwrap(),remoteAddr:o,localAddr:i.encapsulate(`/p2p-circuit/p2p/${this.peerId.toString()}`),logger:this.logger});return this.log("new outbound transient connection %a",l.remoteAddr),await this.upgrader.upgradeOutbound(l,{transient:!0})}catch(c){throw this.log.error(`Circuit relay dial to destination ${n.toString()} via relay ${e.remotePeer.toString()} failed`,c),a&&await e.close(),c}}createListener(t){return Ru({connectionManager:this.connectionManager,relayStore:this.reservationStore,logger:this.logger})}filter(t){return t=Array.isArray(t)?t:[t],t.filter(e=>ke.matches(e))}async onStop({connection:t,stream:e}){if(!this.reservationStore.hasReservation(t.remotePeer))try{this.log("dialed via relay we did not have a reservation on, start listening on that relay address"),await this.transportManager.listen([t.remoteAddr.encapsulate("/p2p-circuit")])}catch(u){this.log.error("failed to listen on a relay peer we were dialed via but did not have a reservation on",u)}let n=AbortSignal.timeout(this.stopTimeout),s=je(e).pb(Mt),i=await s.read({signal:n});if(this.log("new circuit relay v2 stop stream from %p with type %s",t.remotePeer,i.type),i?.type===void 0){this.log.error("type was missing from circuit v2 stop protocol request from %s",t.remotePeer),await s.write({type:Mt.Type.STATUS,status:H.MALFORMED_MESSAGE},{signal:n}),await e.close();return}if(i.type!==Mt.Type.CONNECT){this.log.error("invalid stop connect request via peer %p",t.remotePeer),await s.write({type:Mt.Type.STATUS,status:H.UNEXPECTED_MESSAGE},{signal:n}),await e.close();return}if(!s0(i)){this.log.error("invalid stop connect request via peer %p",t.remotePeer),await s.write({type:Mt.Type.STATUS,status:H.MALFORMED_MESSAGE},{signal:n}),await e.close();return}let o=Wr(i.peer.id);if(await this.connectionGater.denyInboundRelayedConnection?.(t.remotePeer,o)===!0){this.log.error("connection gater denied inbound relayed connection from %p",t.remotePeer),await s.write({type:Mt.Type.STATUS,status:H.PERMISSION_DENIED},{signal:n}),await e.close();return}this.log.trace("sending success response to %p",t.remotePeer),await s.write({type:Mt.Type.STATUS,status:H.OK},{signal:n});let a=t.remoteAddr.encapsulate(`/p2p-circuit/p2p/${o.toString()}`),c=this.addressManager.getAddresses()[0],f=Qo({stream:s.unwrap().unwrap(),remoteAddr:a,localAddr:c,logger:this.logger});this.log("new inbound transient connection %a",f.remoteAddr),await this.upgrader.upgradeInbound(f,{transient:!0}),this.log("%s connection %a upgraded","inbound",f.remoteAddr)}};function Nu(r={}){return t=>new oi(t,r)}return $u(i0);})();
/*! Bundled license information:

pvtsutils/build/index.js:
  (*!
   * MIT License
   * 
   * Copyright (c) 2017-2022 Peculiar Ventures, LLC
   * 
   * Permission is hereby granted, free of charge, to any person obtaining a copy
   * of this software and associated documentation files (the "Software"), to deal
   * in the Software without restriction, including without limitation the rights
   * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
   * copies of the Software, and to permit persons to whom the Software is
   * furnished to do so, subject to the following conditions:
   * 
   * The above copyright notice and this permission notice shall be included in all
   * copies or substantial portions of the Software.
   * 
   * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
   * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
   * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
   * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
   * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
   * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
   * SOFTWARE.
   * 
   *)

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/utils.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/modular.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/curve.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/edwards.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/ed25519.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

pvutils/build/utils.es.js:
  (*!
   Copyright (c) Peculiar Ventures, LLC
  *)

asn1js/build/index.es.js:
  (*!
   * Copyright (c) 2014, GMO GlobalSign
   * Copyright (c) 2015-2022, Peculiar Ventures
   * All rights reserved.
   * 
   * Author 2014-2019, Yury Strozhevsky
   * 
   * Redistribution and use in source and binary forms, with or without modification,
   * are permitted provided that the following conditions are met:
   * 
   * * Redistributions of source code must retain the above copyright notice, this
   *   list of conditions and the following disclaimer.
   * 
   * * Redistributions in binary form must reproduce the above copyright notice, this
   *   list of conditions and the following disclaimer in the documentation and/or
   *   other materials provided with the distribution.
   * 
   * * Neither the name of the copyright holder nor the names of its
   *   contributors may be used to endorse or promote products derived from
   *   this software without specific prior written permission.
   * 
   * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
   * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
   * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
   * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
   * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
   * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
   * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
   * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
   * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
   * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
   * 
   *)

@noble/curves/esm/abstract/weierstrass.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/_shortw_utils.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/secp256k1.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
return Libp2PCircuitRelayV2}));
